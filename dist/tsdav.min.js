var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function r(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var r=function e(){var r=!1;try{r=this instanceof e}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var n,i={exports:{}};var s=(n||(n=1,function(t,r){var n="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==e&&e,i=function(){function e(){this.fetch=!1,this.DOMException=n.DOMException}return e.prototype=n,new e}();!function(t){!function(r){var n=void 0!==t&&t||"undefined"!=typeof self&&self||void 0!==e&&e||{},i="URLSearchParams"in n,s="Symbol"in n&&"iterator"in Symbol,a="FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(e){return!1}}(),o="FormData"in n,u="ArrayBuffer"in n;if(u)var c=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(e){return e&&c.indexOf(Object.prototype.toString.call(e))>-1};function h(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function d(e){return"string"!=typeof e&&(e=String(e)),e}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return s&&(t[Symbol.iterator]=function(){return t}),t}function p(e){this.map={},e instanceof p?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){if(2!=e.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function m(e){if(!e._noBody)return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function y(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function g(e){var t=new FileReader,r=y(t);return t.readAsArrayBuffer(e),r}function v(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:a&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:o&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:i&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():u&&a&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=v(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):u&&(ArrayBuffer.prototype.isPrototypeOf(e)||l(e))?this._bodyArrayBuffer=v(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var e=m(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=m(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(a)return this.blob().then(g);throw new Error("could not read as ArrayBuffer")},this.text=function(){var e,t,r,n,i,s=m(this);if(s)return s;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=y(t),n=/charset=([A-Za-z0-9_-]+)/.exec(e.type),i=n?n[1]:"utf-8",t.readAsText(e,i),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(T)}),this.json=function(){return this.text().then(JSON.parse)},this}p.prototype.append=function(e,t){e=h(e),t=d(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},p.prototype.delete=function(e){delete this.map[h(e)]},p.prototype.get=function(e){return e=h(e),this.has(e)?this.map[e]:null},p.prototype.has=function(e){return this.map.hasOwnProperty(h(e))},p.prototype.set=function(e,t){this.map[h(e)]=d(t)},p.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},p.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),f(e)},p.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),f(e)},p.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),f(e)},s&&(p.prototype[Symbol.iterator]=p.prototype.entries);var _=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function w(e,t){if(!(this instanceof w))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new p(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new p(t.headers)),this.method=function(e){var t=e.toUpperCase();return _.indexOf(t)>-1?t:e}(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in n)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(r),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var i=/([?&])_=[^&]*/;i.test(this.url)?this.url=this.url.replace(i,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function T(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}})),t}function E(e,t){if(!(this instanceof E))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new p(t.headers),this.url=t.url||"",this._initBody(e)}w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},E.error=function(){var e=new E(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var A=[301,302,303,307,308];E.redirect=function(e,t){if(-1===A.indexOf(t))throw new RangeError("Invalid status code");return new E(null,{status:t,headers:{location:e}})},r.DOMException=n.DOMException;try{new r.DOMException}catch(e){r.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},r.DOMException.prototype=Object.create(Error.prototype),r.DOMException.prototype.constructor=r.DOMException}function D(e,t){return new Promise((function(i,s){var o=new w(e,t);if(o.signal&&o.signal.aborted)return s(new r.DOMException("Aborted","AbortError"));var c=new XMLHttpRequest;function l(){c.abort()}if(c.onload=function(){var e,t,r={statusText:c.statusText,headers:(e=c.getAllResponseHeaders()||"",t=new p,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();try{t.append(n,i)}catch(e){console.warn("Response "+e.message)}}})),t)};0===o.url.indexOf("file://")&&(c.status<200||c.status>599)?r.status=200:r.status=c.status,r.url="responseURL"in c?c.responseURL:r.headers.get("X-Request-URL");var n="response"in c?c.response:c.responseText;setTimeout((function(){i(new E(n,r))}),0)},c.onerror=function(){setTimeout((function(){s(new TypeError("Network request failed"))}),0)},c.ontimeout=function(){setTimeout((function(){s(new TypeError("Network request timed out"))}),0)},c.onabort=function(){setTimeout((function(){s(new r.DOMException("Aborted","AbortError"))}),0)},c.open(o.method,function(e){try{return""===e&&n.location.href?n.location.href:e}catch(t){return e}}(o.url),!0),"include"===o.credentials?c.withCredentials=!0:"omit"===o.credentials&&(c.withCredentials=!1),"responseType"in c&&(a?c.responseType="blob":u&&(c.responseType="arraybuffer")),t&&"object"==typeof t.headers&&!(t.headers instanceof p||n.Headers&&t.headers instanceof n.Headers)){var f=[];Object.getOwnPropertyNames(t.headers).forEach((function(e){f.push(h(e)),c.setRequestHeader(e,d(t.headers[e]))})),o.headers.forEach((function(e,t){-1===f.indexOf(t)&&c.setRequestHeader(t,e)}))}else o.headers.forEach((function(e,t){c.setRequestHeader(t,e)}));o.signal&&(o.signal.addEventListener("abort",l),c.onreadystatechange=function(){4===c.readyState&&o.signal.removeEventListener("abort",l)}),c.send(void 0===o._bodyInit?null:o._bodyInit)}))}D.polyfill=!0,n.fetch||(n.fetch=D,n.Headers=p,n.Request=w,n.Response=E),r.Headers=p,r.Request=w,r.Response=E,r.fetch=D}({})}(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=n.fetch?n:i;(r=s.fetch).default=s.fetch,r.fetch=s.fetch,r.Headers=s.Headers,r.Request=s.Request,r.Response=s.Response,t.exports=r}(i,i.exports)),i.exports),a="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function o(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}var c=o,l=u;function h(e){if(c===setTimeout)return setTimeout(e,0);if((c===o||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}"function"==typeof a.setTimeout&&(c=setTimeout),"function"==typeof a.clearTimeout&&(l=clearTimeout);var d,f=[],p=!1,m=-1;function y(){p&&d&&(p=!1,d.length?f=d.concat(f):m=-1,f.length&&g())}function g(){if(!p){var e=h(y);p=!0;for(var t=f.length;t;){for(d=f,f=[];++m<t;)d&&d[m].run();m=-1,t=f.length}d=null,p=!1,function(e){if(l===clearTimeout)return clearTimeout(e);if((l===u||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}(e)}}function v(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new b(e,t)),1!==f.length||p||h(g)}function b(e,t){this.fun=e,this.array=t}b.prototype.run=function(){this.fun.apply(null,this.array)};function _(){}var w=_,T=_,E=_,A=_,D=_,O=_,C=_;var S=a.performance||{},x=S.now||S.mozNow||S.msNow||S.oNow||S.webkitNow||function(){return(new Date).getTime()};var N=new Date;var I,Y,R,L,P,F={nextTick:v,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:w,addListener:T,once:E,off:A,removeListener:D,removeAllListeners:O,emit:C,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*x.call(S),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-N)/1e3}},k={exports:{}};function U(){if(Y)return I;Y=1;var e=1e3,t=60*e,r=60*t,n=24*r,i=7*n,s=365.25*n;function a(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}return I=function(o,u){u=u||{};var c=typeof o;if("string"===c&&o.length>0)return function(a){if((a=String(a)).length>100)return;var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(!o)return;var u=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return u*s;case"weeks":case"week":case"w":return u*i;case"days":case"day":case"d":return u*n;case"hours":case"hour":case"hrs":case"hr":case"h":return u*r;case"minutes":case"minute":case"mins":case"min":case"m":return u*t;case"seconds":case"second":case"secs":case"sec":case"s":return u*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}(o);if("number"===c&&isFinite(o))return u.long?function(i){var s=Math.abs(i);if(s>=n)return a(i,s,n,"day");if(s>=r)return a(i,s,r,"hour");if(s>=t)return a(i,s,t,"minute");if(s>=e)return a(i,s,e,"second");return i+" ms"}(o):function(i){var s=Math.abs(i);if(s>=n)return Math.round(i/n)+"d";if(s>=r)return Math.round(i/r)+"h";if(s>=t)return Math.round(i/t)+"m";if(s>=e)return Math.round(i/e)+"s";return i+"ms"}(o);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))}}var B,M=(P||(P=1,function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}return!e&&void 0!==F&&"env"in F&&(e=F.env.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=(L||(L=1,R=function(e){function t(e){let n,i,s,a=null;function o(...e){if(!o.enabled)return;const r=o,i=Number(new Date),s=i-(n||i);r.diff=s,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";a++;const s=t.formatters[i];if("function"==typeof s){const t=e[a];n=s.call(r,t),e.splice(a,1),a--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=r,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(i!==t.namespaces&&(i=t.namespaces,s=t.enabled(e)),s),set:e=>{a=e}}),"function"==typeof t.init&&t.init(o),o}function r(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function n(e,t){let r=0,n=0,i=-1,s=0;for(;r<e.length;)if(n<t.length&&(t[n]===e[r]||"*"===t[n]))"*"===t[n]?(i=n,s=r,n++):(r++,n++);else{if(-1===i)return!1;n=i+1,s++,r=s}for(;n<t.length&&"*"===t[n];)n++;return n===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names,...t.skips.map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const e of r)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const r of t.skips)if(n(e,r))return!1;for(const r of t.names)if(n(e,r))return!0;return!1},t.humanize=U(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}),R)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(k,k.exports)),k.exports),V=t(M);!function(e){e.CALENDAR_SERVER="http://calendarserver.org/ns/",e.CALDAV_APPLE="http://apple.com/ns/ical/",e.CALDAV="urn:ietf:params:xml:ns:caldav",e.CARDDAV="urn:ietf:params:xml:ns:carddav",e.DAV="DAV:"}(B||(B={}));const j={[B.CALDAV]:"xmlns:c",[B.CARDDAV]:"xmlns:card",[B.CALENDAR_SERVER]:"xmlns:cs",[B.CALDAV_APPLE]:"xmlns:ca",[B.DAV]:"xmlns:d"};var z,H;!function(e){e.CALDAV="c",e.CARDDAV="card",e.CALENDAR_SERVER="cs",e.CALDAV_APPLE="ca",e.DAV="d"}(z||(z={})),function(e){e.VEVENT="VEVENT",e.VTODO="VTODO",e.VJOURNAL="VJOURNAL",e.VFREEBUSY="VFREEBUSY",e.VTIMEZONE="VTIMEZONE",e.VALARM="VALARM"}(H||(H={}));var $=[],K=[],W="undefined"!=typeof Uint8Array?Uint8Array:Array,q=!1;function G(){q=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)$[t]=e[t],K[e.charCodeAt(t)]=t;K["-".charCodeAt(0)]=62,K["_".charCodeAt(0)]=63}function Z(e,t,r){for(var n,i,s=[],a=t;a<r;a+=3)n=(e[a]<<16)+(e[a+1]<<8)+e[a+2],s.push($[(i=n)>>18&63]+$[i>>12&63]+$[i>>6&63]+$[63&i]);return s.join("")}function J(e){var t;q||G();for(var r=e.length,n=r%3,i="",s=[],a=16383,o=0,u=r-n;o<u;o+=a)s.push(Z(e,o,o+a>u?u:o+a));return 1===n?(t=e[r-1],i+=$[t>>2],i+=$[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=$[t>>10],i+=$[t>>4&63],i+=$[t<<2&63],i+="="),s.push(i),s.join("")}function Q(e,t,r,n,i){var s,a,o=8*i-n-1,u=(1<<o)-1,c=u>>1,l=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,s=f&(1<<-l)-1,f>>=-l,l+=o;l>0;s=256*s+e[t+h],h+=d,l-=8);for(a=s&(1<<-l)-1,s>>=-l,l+=n;l>0;a=256*a+e[t+h],h+=d,l-=8);if(0===s)s=1-c;else{if(s===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=c}return(f?-1:1)*a*Math.pow(2,s-n)}function X(e,t,r,n,i,s){var a,o,u,c=8*s-i-1,l=(1<<c)-1,h=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+h>=1?d/u:d*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=l?(o=0,a=l):a+h>=1?(o=(t*u-1)*Math.pow(2,i),a+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,c+=i;c>0;e[r+f]=255&a,f+=p,a/=256,c-=8);e[r+f-p]|=128*m}var ee={}.toString,te=Array.isArray||function(e){return"[object Array]"==ee.call(e)};function re(){return ie.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function ne(e,t){if(re()<t)throw new RangeError("Invalid typed array length");return ie.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=ie.prototype:(null===e&&(e=new ie(t)),e.length=t),e}function ie(e,t,r){if(!(ie.TYPED_ARRAY_SUPPORT||this instanceof ie))return new ie(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return oe(this,e)}return se(this,e,t,r)}function se(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);ie.TYPED_ARRAY_SUPPORT?(e=t).__proto__=ie.prototype:e=ue(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!ie.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|he(t,r);e=ne(e,n);var i=e.write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(le(t)){var r=0|ce(t.length);return 0===(e=ne(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?ne(e,0):ue(e,t);if("Buffer"===t.type&&te(t.data))return ue(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function ae(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function oe(e,t){if(ae(t),e=ne(e,t<0?0:0|ce(t)),!ie.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function ue(e,t){var r=t.length<0?0:0|ce(t.length);e=ne(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function ce(e){if(e>=re())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+re().toString(16)+" bytes");return 0|e}function le(e){return!(null==e||!e._isBuffer)}function he(e,t){if(le(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return Ue(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Be(e).length;default:if(n)return Ue(e).length;t=(""+t).toLowerCase(),n=!0}}function de(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Ce(this,t,r);case"utf8":case"utf-8":return Ee(this,t,r);case"ascii":return De(this,t,r);case"latin1":case"binary":return Oe(this,t,r);case"base64":return Te(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Se(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function fe(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function pe(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=ie.from(t,n)),le(t))return 0===t.length?-1:me(e,t,r,n,i);if("number"==typeof t)return t&=255,ie.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):me(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function me(e,t,r,n,i){var s,a=1,o=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,o/=2,u/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(s=r;s<o;s++)if(c(e,s)===c(t,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===u)return l*a}else-1!==l&&(s-=s-l),l=-1}else for(r+u>o&&(r=o-u),s=r;s>=0;s--){for(var h=!0,d=0;d<u;d++)if(c(e,s+d)!==c(t,d)){h=!1;break}if(h)return s}return-1}function ye(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o=parseInt(t.substr(2*a,2),16);if(isNaN(o))return a;e[r+a]=o}return a}function ge(e,t,r,n){return Me(Ue(t,e.length-r),e,r,n)}function ve(e,t,r,n){return Me(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function be(e,t,r,n){return ve(e,t,r,n)}function _e(e,t,r,n){return Me(Be(t),e,r,n)}function we(e,t,r,n){return Me(function(e,t){for(var r,n,i,s=[],a=0;a<e.length&&!((t-=2)<0);++a)n=(r=e.charCodeAt(a))>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function Te(e,t,r){return 0===t&&r===e.length?J(e):J(e.slice(t,r))}function Ee(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(s=e[i+1]))&&(u=(31&c)<<6|63&s)>127&&(l=u);break;case 3:s=e[i+1],a=e[i+2],128==(192&s)&&128==(192&a)&&(u=(15&c)<<12|(63&s)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],128==(192&s)&&128==(192&a)&&128==(192&o)&&(u=(15&c)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=h}return function(e){var t=e.length;if(t<=Ae)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=Ae));return r}(n)}ie.TYPED_ARRAY_SUPPORT=void 0===a.TYPED_ARRAY_SUPPORT||a.TYPED_ARRAY_SUPPORT,re(),ie.poolSize=8192,ie._augment=function(e){return e.__proto__=ie.prototype,e},ie.from=function(e,t,r){return se(null,e,t,r)},ie.TYPED_ARRAY_SUPPORT&&(ie.prototype.__proto__=Uint8Array.prototype,ie.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&ie[Symbol.species]),ie.alloc=function(e,t,r){return function(e,t,r,n){return ae(t),t<=0?ne(e,t):void 0!==r?"string"==typeof n?ne(e,t).fill(r,n):ne(e,t).fill(r):ne(e,t)}(null,e,t,r)},ie.allocUnsafe=function(e){return oe(null,e)},ie.allocUnsafeSlow=function(e){return oe(null,e)},ie.isBuffer=function(e){return null!=e&&(!!e._isBuffer||Ve(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&Ve(e.slice(0,0))}(e))},ie.compare=function(e,t){if(!le(e)||!le(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},ie.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},ie.concat=function(e,t){if(!te(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return ie.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=ie.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!le(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},ie.byteLength=he,ie.prototype._isBuffer=!0,ie.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)fe(this,t,t+1);return this},ie.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)fe(this,t,t+3),fe(this,t+1,t+2);return this},ie.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)fe(this,t,t+7),fe(this,t+1,t+6),fe(this,t+2,t+5),fe(this,t+3,t+4);return this},ie.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?Ee(this,0,e):de.apply(this,arguments)},ie.prototype.equals=function(e){if(!le(e))throw new TypeError("Argument must be a Buffer");return this===e||0===ie.compare(this,e)},ie.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},ie.prototype.compare=function(e,t,r,n,i){if(!le(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),o=Math.min(s,a),u=this.slice(n,i),c=e.slice(t,r),l=0;l<o;++l)if(u[l]!==c[l]){s=u[l],a=c[l];break}return s<a?-1:a<s?1:0},ie.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},ie.prototype.indexOf=function(e,t,r){return pe(this,e,t,r,!0)},ie.prototype.lastIndexOf=function(e,t,r){return pe(this,e,t,r,!1)},ie.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return ye(this,e,t,r);case"utf8":case"utf-8":return ge(this,e,t,r);case"ascii":return ve(this,e,t,r);case"latin1":case"binary":return be(this,e,t,r);case"base64":return _e(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return we(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},ie.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Ae=4096;function De(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function Oe(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function Ce(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=ke(e[s]);return i}function Se(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function xe(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function Ne(e,t,r,n,i,s){if(!le(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function Ie(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-r,2);i<s;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function Ye(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-r,4);i<s;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function Re(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function Le(e,t,r,n,i){return i||Re(e,0,r,4),X(e,t,r,n,23,4),r+4}function Pe(e,t,r,n,i){return i||Re(e,0,r,8),X(e,t,r,n,52,8),r+8}ie.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),ie.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=ie.prototype;else{var i=t-e;r=new ie(i,void 0);for(var s=0;s<i;++s)r[s]=this[s+e]}return r},ie.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||xe(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},ie.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||xe(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},ie.prototype.readUInt8=function(e,t){return t||xe(e,1,this.length),this[e]},ie.prototype.readUInt16LE=function(e,t){return t||xe(e,2,this.length),this[e]|this[e+1]<<8},ie.prototype.readUInt16BE=function(e,t){return t||xe(e,2,this.length),this[e]<<8|this[e+1]},ie.prototype.readUInt32LE=function(e,t){return t||xe(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},ie.prototype.readUInt32BE=function(e,t){return t||xe(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},ie.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||xe(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},ie.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||xe(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},ie.prototype.readInt8=function(e,t){return t||xe(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},ie.prototype.readInt16LE=function(e,t){t||xe(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},ie.prototype.readInt16BE=function(e,t){t||xe(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},ie.prototype.readInt32LE=function(e,t){return t||xe(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},ie.prototype.readInt32BE=function(e,t){return t||xe(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},ie.prototype.readFloatLE=function(e,t){return t||xe(e,4,this.length),Q(this,e,!0,23,4)},ie.prototype.readFloatBE=function(e,t){return t||xe(e,4,this.length),Q(this,e,!1,23,4)},ie.prototype.readDoubleLE=function(e,t){return t||xe(e,8,this.length),Q(this,e,!0,52,8)},ie.prototype.readDoubleBE=function(e,t){return t||xe(e,8,this.length),Q(this,e,!1,52,8)},ie.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||Ne(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},ie.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||Ne(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},ie.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||Ne(this,e,t,1,255,0),ie.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},ie.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||Ne(this,e,t,2,65535,0),ie.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Ie(this,e,t,!0),t+2},ie.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||Ne(this,e,t,2,65535,0),ie.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Ie(this,e,t,!1),t+2},ie.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||Ne(this,e,t,4,4294967295,0),ie.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Ye(this,e,t,!0),t+4},ie.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||Ne(this,e,t,4,4294967295,0),ie.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Ye(this,e,t,!1),t+4},ie.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);Ne(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},ie.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);Ne(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},ie.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||Ne(this,e,t,1,127,-128),ie.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},ie.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||Ne(this,e,t,2,32767,-32768),ie.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Ie(this,e,t,!0),t+2},ie.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||Ne(this,e,t,2,32767,-32768),ie.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Ie(this,e,t,!1),t+2},ie.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||Ne(this,e,t,4,2147483647,-2147483648),ie.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Ye(this,e,t,!0),t+4},ie.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||Ne(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),ie.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Ye(this,e,t,!1),t+4},ie.prototype.writeFloatLE=function(e,t,r){return Le(this,e,t,!0,r)},ie.prototype.writeFloatBE=function(e,t,r){return Le(this,e,t,!1,r)},ie.prototype.writeDoubleLE=function(e,t,r){return Pe(this,e,t,!0,r)},ie.prototype.writeDoubleBE=function(e,t,r){return Pe(this,e,t,!1,r)},ie.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,s=n-r;if(this===e&&r<t&&t<n)for(i=s-1;i>=0;--i)e[i+t]=this[i+r];else if(s<1e3||!ie.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+s),t);return s},ie.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!ie.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var a=le(e)?e:Ue(new ie(e,n).toString()),o=a.length;for(s=0;s<r-t;++s)this[s+t]=a[s%o]}return this};var Fe=/[^+\/0-9A-Za-z-_]/g;function ke(e){return e<16?"0"+e.toString(16):e.toString(16)}function Ue(e,t){var r;t=t||1/0;for(var n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function Be(e){return function(e){var t,r,n,i,s,a;q||G();var o=e.length;if(o%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s="="===e[o-2]?2:"="===e[o-1]?1:0,a=new W(3*o/4-s),n=s>0?o-4:o;var u=0;for(t=0,r=0;t<n;t+=4,r+=3)i=K[e.charCodeAt(t)]<<18|K[e.charCodeAt(t+1)]<<12|K[e.charCodeAt(t+2)]<<6|K[e.charCodeAt(t+3)],a[u++]=i>>16&255,a[u++]=i>>8&255,a[u++]=255&i;return 2===s?(i=K[e.charCodeAt(t)]<<2|K[e.charCodeAt(t+1)]>>4,a[u++]=255&i):1===s&&(i=K[e.charCodeAt(t)]<<10|K[e.charCodeAt(t+1)]<<4|K[e.charCodeAt(t+2)]>>2,a[u++]=i>>8&255,a[u++]=255&i),a}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(Fe,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Me(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function Ve(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var je,ze,He={};function $e(){}function Ke(){Ke.init.call(this)}function We(e){return void 0===e._maxListeners?Ke.defaultMaxListeners:e._maxListeners}function qe(e,t,r,n){var i,s,a,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]):(s=e._events=new $e,e._eventsCount=0),a){if("function"==typeof a?a=s[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),!a.warned&&(i=We(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,o=u,"function"==typeof console.warn?console.warn(o):console.log(o)}}else a=s[t]=r,++e._eventsCount;return e}function Ge(e,t,r){var n=!1;function i(){e.removeListener(t,i),n||(n=!0,r.apply(e,arguments))}return i.listener=r,i}function Ze(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function Je(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}$e.prototype=Object.create(null),Ke.EventEmitter=Ke,Ke.usingDomains=!1,Ke.prototype.domain=void 0,Ke.prototype._events=void 0,Ke.prototype._maxListeners=void 0,Ke.defaultMaxListeners=10,Ke.init=function(){this.domain=null,Ke.usingDomains&&(!je.active||this instanceof je.Domain||(this.domain=je.active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new $e,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ke.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Ke.prototype.getMaxListeners=function(){return We(this)},Ke.prototype.emit=function(e){var t,r,n,i,s,a,o,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(o=this.domain,u){if(t=arguments[1],!o){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=o,t.domainThrown=!1,o.emit("error",t),!1}if(!(r=a[e]))return!1;var l="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,i=Je(e,n),s=0;s<n;++s)i[s].call(r)}(r,l,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,s=Je(e,i),a=0;a<i;++a)s[a].call(r,n)}(r,l,this,arguments[1]);break;case 3:!function(e,t,r,n,i){if(t)e.call(r,n,i);else for(var s=e.length,a=Je(e,s),o=0;o<s;++o)a[o].call(r,n,i)}(r,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,i,s){if(t)e.call(r,n,i,s);else for(var a=e.length,o=Je(e,a),u=0;u<a;++u)o[u].call(r,n,i,s)}(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),s=1;s<n;s++)i[s-1]=arguments[s];!function(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,s=Je(e,i),a=0;a<i;++a)s[a].apply(r,n)}(r,l,this,i)}return!0},Ke.prototype.addListener=function(e,t){return qe(this,e,t,!1)},Ke.prototype.on=Ke.prototype.addListener,Ke.prototype.prependListener=function(e,t){return qe(this,e,t,!0)},Ke.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Ge(this,e,t)),this},Ke.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Ge(this,e,t)),this},Ke.prototype.removeListener=function(e,t){var r,n,i,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new $e:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){a=r[s].listener,i=s;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new $e,this;delete n[e]}else!function(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}(r,i);n.removeListener&&this.emit("removeListener",e,a||t)}return this},Ke.prototype.off=function(e,t){return this.removeListener(e,t)},Ke.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new $e,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new $e:delete r[e]),this;if(0===arguments.length){for(var n,i=Object.keys(r),s=0;s<i.length;++s)"removeListener"!==(n=i[s])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new $e,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Ke.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},Ke.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Ze.call(e,t)},Ke.prototype.listenerCount=Ze,Ke.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]},ze="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e};var Qe=/%[sdj%]/g;function Xe(e){if(!ht(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(nt(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,s=String(e).replace(Qe,(function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),a=n[r];r<i;a=n[++r])lt(a)||!pt(a)?s+=" "+a:s+=" "+nt(a);return s}function et(e,t){if(dt(a.process))return function(){return et(e,t).apply(this,arguments)};if(!0===F.noDeprecation)return e;var r=!1;return function(){if(!r){if(F.throwDeprecation)throw new Error(t);F.traceDeprecation?console.trace(t):console.error(t),r=!0}return e.apply(this,arguments)}}var tt,rt={};function nt(e,t){var r={seen:[],stylize:st};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),ct(t)?r.showHidden=t:t&&function(e,t){if(!t||!pt(t))return e;var r=Object.keys(t),n=r.length;for(;n--;)e[r[n]]=t[r[n]]}(r,t),dt(r.showHidden)&&(r.showHidden=!1),dt(r.depth)&&(r.depth=2),dt(r.colors)&&(r.colors=!1),dt(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=it),at(r,e,r.depth)}function it(e,t){var r=nt.styles[t];return r?"["+nt.colors[r][0]+"m"+e+"["+nt.colors[r][1]+"m":e}function st(e,t){return e}function at(e,t,r){if(e.customInspect&&t&&gt(t.inspect)&&t.inspect!==nt&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return ht(n)||(n=at(e,n,r)),n}var i=function(e,t){if(dt(t))return e.stylize("undefined","undefined");if(ht(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(n=t,"number"==typeof n)return e.stylize(""+t,"number");var n;if(ct(t))return e.stylize(""+t,"boolean");if(lt(t))return e.stylize("null","null")}(e,t);if(i)return i;var s=Object.keys(t),a=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),yt(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return ot(t);if(0===s.length){if(gt(t)){var o=t.name?": "+t.name:"";return e.stylize("[Function"+o+"]","special")}if(ft(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(mt(t))return e.stylize(Date.prototype.toString.call(t),"date");if(yt(t))return ot(t)}var u,c,l="",h=!1,d=["{","}"];(u=t,Array.isArray(u)&&(h=!0,d=["[","]"]),gt(t))&&(l=" [Function"+(t.name?": "+t.name:"")+"]");return ft(t)&&(l=" "+RegExp.prototype.toString.call(t)),mt(t)&&(l=" "+Date.prototype.toUTCString.call(t)),yt(t)&&(l=" "+ot(t)),0!==s.length||h&&0!=t.length?r<0?ft(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=h?function(e,t,r,n,i){for(var s=[],a=0,o=t.length;a<o;++a)bt(t,String(a))?s.push(ut(e,t,r,n,String(a),!0)):s.push("");return i.forEach((function(i){i.match(/^\d+$/)||s.push(ut(e,t,r,n,i,!0))})),s}(e,t,r,a,s):s.map((function(n){return ut(e,t,r,a,n,h)})),e.seen.pop(),function(e,t,r){var n=e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);if(n>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(c,l,d)):d[0]+l+d[1]}function ot(e){return"["+Error.prototype.toString.call(e)+"]"}function ut(e,t,r,n,i,s){var a,o,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?o=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(o=e.stylize("[Setter]","special")),bt(n,i)||(a="["+i+"]"),o||(e.seen.indexOf(u.value)<0?(o=lt(r)?at(e,u.value,null):at(e,u.value,r-1)).indexOf("\n")>-1&&(o=s?o.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+o.split("\n").map((function(e){return"   "+e})).join("\n")):o=e.stylize("[Circular]","special")),dt(a)){if(s&&i.match(/^\d+$/))return o;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+o}function ct(e){return"boolean"==typeof e}function lt(e){return null===e}function ht(e){return"string"==typeof e}function dt(e){return void 0===e}function ft(e){return pt(e)&&"[object RegExp]"===vt(e)}function pt(e){return"object"==typeof e&&null!==e}function mt(e){return pt(e)&&"[object Date]"===vt(e)}function yt(e){return pt(e)&&("[object Error]"===vt(e)||e instanceof Error)}function gt(e){return"function"==typeof e}function vt(e){return Object.prototype.toString.call(e)}function bt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function _t(){this.head=null,this.tail=null,this.length=0}nt.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},nt.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},_t.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},_t.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},_t.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},_t.prototype.clear=function(){this.head=this.tail=null,this.length=0},_t.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},_t.prototype.concat=function(e){if(0===this.length)return ie.alloc(0);if(1===this.length)return this.head.data;for(var t=ie.allocUnsafe(e>>>0),r=this.head,n=0;r;)r.data.copy(t,n),n+=r.data.length,r=r.next;return t};var wt=ie.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Tt(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!wt(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=At;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=Dt;break;default:return void(this.write=Et)}this.charBuffer=new ie(6),this.charReceived=0,this.charLength=0}function Et(e){return e.toString(this.encoding)}function At(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function Dt(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}Tt.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";if(e=e.slice(r,e.length),!((i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var n=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,n),n-=this.charReceived);var i;n=(t+=e.toString(this.encoding,0,n)).length-1;if((i=t.charCodeAt(n))>=55296&&i<=56319){var s=this.surrogateSize;return this.charLength+=s,this.charReceived+=s,this.charBuffer.copy(this.charBuffer,s,0,s),e.copy(this.charBuffer,0,0,s),t.substring(0,n)}return t},Tt.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(t<=2&&r>>4==14){this.charLength=3;break}if(t<=3&&r>>3==30){this.charLength=4;break}}this.charReceived=t},Tt.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,n=this.charBuffer,i=this.encoding;t+=n.slice(0,r).toString(i)}return t};var Ot=Object.freeze({__proto__:null,StringDecoder:Tt});xt.ReadableState=St;var Ct=function(e){if(dt(tt)&&(tt=F.env.NODE_DEBUG||""),e=e.toUpperCase(),!rt[e])if(new RegExp("\\b"+e+"\\b","i").test(tt)){rt[e]=function(){var t=Xe.apply(null,arguments);console.error("%s %d: %s",e,0,t)}}else rt[e]=function(){};return rt[e]}("stream");function St(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof nr&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=~~this.highWaterMark,this.buffer=new _t,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new Tt(e.encoding),this.encoding=e.encoding)}function xt(e){if(!(this instanceof xt))return new xt(e);this._readableState=new St(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),Ke.call(this)}function Nt(e,t,r,n,i){var s=function(e,t){var r=null;ie.isBuffer(t)||"string"==typeof t||null==t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));return r}(t,r);if(s)e.emit("error",s);else if(null===r)t.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,Rt(e)}(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!i){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&i){var o=new Error("stream.unshift() after end event");e.emit("error",o)}else{var u;!t.decoder||i||n||(r=t.decoder.write(r),u=!t.objectMode&&0===r.length),i||(t.reading=!1),u||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,i?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&Rt(e))),function(e,t){t.readingMore||(t.readingMore=!0,v(Pt,e,t))}(e,t)}else i||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}ze(xt,Ke),xt.prototype.push=function(e,t){var r=this._readableState;return r.objectMode||"string"!=typeof e||(t=t||r.defaultEncoding)!==r.encoding&&(e=ie.from(e,t),t=""),Nt(this,r,e,t,!1)},xt.prototype.unshift=function(e){return Nt(this,this._readableState,e,"",!0)},xt.prototype.isPaused=function(){return!1===this._readableState.flowing},xt.prototype.setEncoding=function(e){return this._readableState.decoder=new Tt(e),this._readableState.encoding=e,this};var It=8388608;function Yt(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=It?e=It:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function Rt(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(Ct("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?v(Lt,e):Lt(e))}function Lt(e){Ct("emit readable"),e.emit("readable"),Ut(e)}function Pt(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(Ct("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function Ft(e){Ct("readable nexttick read 0"),e.read(0)}function kt(e,t){t.reading||(Ct("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),Ut(e),t.flowing&&!t.reading&&e.read(0)}function Ut(e){var t=e._readableState;for(Ct("flow",t.flowing);t.flowing&&null!==e.read(););}function Bt(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var s=r.data,a=e>s.length?s.length:e;if(a===s.length?i+=s:i+=s.slice(0,e),0===(e-=a)){a===s.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=s.slice(a));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=ie.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var s=n.data,a=e>s.length?s.length:e;if(s.copy(r,r.length-e,0,a),0===(e-=a)){a===s.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(a));break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function Mt(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,v(Vt,t,e))}function Vt(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function jt(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function zt(){}function Ht(e,t,r){this.chunk=e,this.encoding=t,this.callback=r,this.next=null}function $t(e,t){Object.defineProperty(this,"buffer",{get:et((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof nr&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var i=!1===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?v(i,n):i(n);e._writableState.errorEmitted=!0,e.emit("error",n)}(e,r,n,t,i);else{var s=Zt(r);s||r.corked||r.bufferProcessing||!r.bufferedRequest||Gt(e,r),n?v(qt,e,r,s,i):qt(e,r,s,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new Xt(this)}function Kt(e){if(!(this instanceof Kt||this instanceof nr))return new Kt(e);this._writableState=new $t(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),Ke.call(this)}function Wt(e,t,r,n,i,s,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function qt(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),Qt(e,t)}function Gt(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),s=t.corkedRequestsFree;s.entry=r;for(var a=0;r;)i[a]=r,r=r.next,a+=1;Wt(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new Xt(t)}else{for(;r;){var o=r.chunk,u=r.encoding,c=r.callback;if(Wt(e,t,!1,t.objectMode?1:o.length,o,u,c),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}function Zt(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function Jt(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function Qt(e,t){var r=Zt(t);return r&&(0===t.pendingcb?(Jt(e,t),t.finished=!0,e.emit("finish")):Jt(e,t)),r}function Xt(e){var t=this;this.next=null,this.entry=null,this.finish=function(r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}xt.prototype.read=function(e){Ct("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return Ct("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?Mt(this):Rt(this),null;if(0===(e=Yt(e,t))&&t.ended)return 0===t.length&&Mt(this),null;var n,i=t.needReadable;return Ct("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&Ct("length less than watermark",i=!0),t.ended||t.reading?Ct("reading or ended",i=!1):i&&(Ct("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=Yt(r,t))),null===(n=e>0?Bt(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&Mt(this)),null!==n&&this.emit("data",n),n},xt.prototype._read=function(e){this.emit("error",new Error("not implemented"))},xt.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,Ct("pipe count=%d opts=%j",n.pipesCount,t);var i=!t||!1!==t.end?a:c;function s(e){Ct("onunpipe"),e===r&&c()}function a(){Ct("onend"),e.end()}n.endEmitted?v(i):r.once("end",i),e.on("unpipe",s);var o=function(e){return function(){var t=e._readableState;Ct("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,Ut(e))}}(r);e.on("drain",o);var u=!1;function c(){Ct("cleanup"),e.removeListener("close",f),e.removeListener("finish",p),e.removeListener("drain",o),e.removeListener("error",d),e.removeListener("unpipe",s),r.removeListener("end",a),r.removeListener("end",c),r.removeListener("data",h),u=!0,!n.awaitDrain||e._writableState&&!e._writableState.needDrain||o()}var l=!1;function h(t){Ct("ondata"),l=!1,!1!==e.write(t)||l||((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==jt(n.pipes,e))&&!u&&(Ct("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,l=!0),r.pause())}function d(t){var r;Ct("onerror",t),m(),e.removeListener("error",d),0===(r="error",e.listeners(r).length)&&e.emit("error",t)}function f(){e.removeListener("finish",p),m()}function p(){Ct("onfinish"),e.removeListener("close",f),m()}function m(){Ct("unpipe"),r.unpipe(e)}return r.on("data",h),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",d),e.once("close",f),e.once("finish",p),e.emit("pipe",r),n.flowing||(Ct("pipe resume"),r.resume()),e},xt.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<n;i++)r[i].emit("unpipe",this);return this}var s=jt(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},xt.prototype.on=function(e,t){var r=Ke.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&Rt(this):v(Ft,this))}return r},xt.prototype.addListener=xt.prototype.on,xt.prototype.resume=function(){var e=this._readableState;return e.flowing||(Ct("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,v(kt,e,t))}(this,e)),this},xt.prototype.pause=function(){return Ct("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(Ct("pause"),this._readableState.flowing=!1,this.emit("pause")),this},xt.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;for(var i in e.on("end",(function(){if(Ct("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)})),e.on("data",(function(i){(Ct("wrapped data"),t.decoder&&(i=t.decoder.write(i)),t.objectMode&&null==i)||(t.objectMode||i&&i.length)&&(n.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return function(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}(["error","close","destroy","pause","resume"],(function(t){e.on(t,n.emit.bind(n,t))})),n._read=function(t){Ct("wrapped _read",t),r&&(r=!1,e.resume())},n},xt._fromList=Bt,Kt.WritableState=$t,ze(Kt,Ke),$t.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},Kt.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Kt.prototype.write=function(e,t,r){var n=this._writableState,i=!1;return"function"==typeof t&&(r=t,t=null),ie.isBuffer(e)?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=zt),n.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),v(t,r)}(this,r):function(e,t,r,n){var i=!0,s=!1;return null===r?s=new TypeError("May not write null values to stream"):ie.isBuffer(r)||"string"==typeof r||void 0===r||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),v(n,s),i=!1),i}(this,n,e,r)&&(n.pendingcb++,i=function(e,t,r,n,i){r=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=ie.from(t,r));return t}(t,r,n),ie.isBuffer(r)&&(n="buffer");var s=t.objectMode?1:r.length;t.length+=s;var a=t.length<t.highWaterMark;a||(t.needDrain=!0);if(t.writing||t.corked){var o=t.lastBufferedRequest;t.lastBufferedRequest=new Ht(r,n,i),o?o.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else Wt(e,t,!1,s,r,n,i);return a}(this,n,e,t,r)),i},Kt.prototype.cork=function(){this._writableState.corked++},Kt.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||Gt(this,e))},Kt.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Kt.prototype._write=function(e,t,r){r(new Error("not implemented"))},Kt.prototype._writev=null,Kt.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,Qt(e,t),r&&(t.finished?v(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r)},ze(nr,xt);for(var er=Object.keys(Kt.prototype),tr=0;tr<er.length;tr++){var rr=er[tr];nr.prototype[rr]||(nr.prototype[rr]=Kt.prototype[rr])}function nr(e){if(!(this instanceof nr))return new nr(e);xt.call(this,e),Kt.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",ir)}function ir(){this.allowHalfOpen||this._writableState.ended||v(sr,this)}function sr(e){e.end()}function ar(e){this.afterTransform=function(t,r){return function(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!=r&&e.push(r);i(t);var s=e._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&e._read(s.highWaterMark)}(e,t,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function or(e){if(!(this instanceof or))return new or(e);nr.call(this,e),this._transformState=new ar(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e){ur(t,e)})):ur(t)}))}function ur(e,t){if(t)return e.emit("error",t);var r=e._writableState,n=e._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(n.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function cr(e){if(!(this instanceof cr))return new cr(e);or.call(this,e)}function lr(){Ke.call(this)}ze(or,nr),or.prototype.push=function(e,t){return this._transformState.needTransform=!1,nr.prototype.push.call(this,e,t)},or.prototype._transform=function(e,t,r){throw new Error("Not implemented")},or.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},or.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},ze(cr,or),cr.prototype._transform=function(e,t,r){r(null,e)},ze(lr,Ke),lr.Readable=xt,lr.Writable=Kt,lr.Duplex=nr,lr.Transform=or,lr.PassThrough=cr,lr.Stream=lr,lr.prototype.pipe=function(e,t){var r=this;function n(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function i(){r.readable&&r.resume&&r.resume()}r.on("data",n),e.on("drain",i),e._isStdio||t&&!1===t.end||(r.on("end",a),r.on("close",o));var s=!1;function a(){s||(s=!0,e.end())}function o(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(c(),0===Ke.listenerCount(this,"error"))throw e}function c(){r.removeListener("data",n),e.removeListener("drain",i),r.removeListener("end",a),r.removeListener("close",o),r.removeListener("error",u),e.removeListener("error",u),r.removeListener("end",c),r.removeListener("close",c),e.removeListener("close",c)}return r.on("error",u),e.on("error",u),r.on("end",c),r.on("close",c),e.on("close",c),e.emit("pipe",r),e};var hr,dr,fr,pr,mr,yr,gr,vr,br,_r,wr,Tr,Er,Ar,Dr,Or=r(Object.freeze({__proto__:null,Duplex:nr,PassThrough:cr,Readable:xt,Stream:lr,Transform:or,Writable:Kt,default:lr})),Cr=r(Ot);function Sr(){return hr||(hr=1,function(e){e.parser=function(e,t){return new n(e,t)},e.SAXParser=n,e.SAXStream=s,e.createStream=function(e,t){return new s(e,t)},e.MAX_BUFFER_LENGTH=65536;var t,r=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function n(t,i){if(!(this instanceof n))return new n(t,i);var s=this;!function(e){for(var t=0,n=r.length;t<n;t++)e[r[t]]=""}(s),s.q=s.c="",s.bufferCheckPosition=e.MAX_BUFFER_LENGTH,s.opt=i||{},s.opt.lowercase=s.opt.lowercase||s.opt.lowercasetags,s.looseCase=s.opt.lowercase?"toLowerCase":"toUpperCase",s.tags=[],s.closed=s.closedRoot=s.sawRoot=!1,s.tag=s.error=null,s.strict=!!t,s.noscript=!(!t&&!s.opt.noscript),s.state=E.BEGIN,s.strictEntities=s.opt.strictEntities,s.ENTITIES=s.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),s.attribList=[],s.opt.xmlns&&(s.ns=Object.create(l)),void 0===s.opt.unquotedAttributeValues&&(s.opt.unquotedAttributeValues=!t),s.trackPosition=!1!==s.opt.position,s.trackPosition&&(s.position=s.line=s.column=0),D(s,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}),n.prototype={end:function(){N(this)},write:function(t){var n=this;if(this.error)throw this.error;if(n.closed)return x(n,"Cannot write after close. Assign an onready handler.");if(null===t)return N(n);"object"==typeof t&&(t=t.toString());for(var i=0,s="";s=B(t,i++),n.c=s,s;)switch(n.trackPosition&&(n.position++,"\n"===s?(n.line++,n.column=0):n.column++),n.state){case E.BEGIN:if(n.state=E.BEGIN_WHITESPACE,"\ufeff"===s)continue;U(n,s);continue;case E.BEGIN_WHITESPACE:U(n,s);continue;case E.TEXT:if(n.sawRoot&&!n.closedRoot){for(var u=i-1;s&&"<"!==s&&"&"!==s;)(s=B(t,i++))&&n.trackPosition&&(n.position++,"\n"===s?(n.line++,n.column=0):n.column++);n.textNode+=t.substring(u,i-1)}"<"!==s||n.sawRoot&&n.closedRoot&&!n.strict?(m(s)||n.sawRoot&&!n.closedRoot||I(n,"Text data outside of root node."),"&"===s?n.state=E.TEXT_ENTITY:n.textNode+=s):(n.state=E.OPEN_WAKA,n.startTagPosition=n.position);continue;case E.SCRIPT:"<"===s?n.state=E.SCRIPT_ENDING:n.script+=s;continue;case E.SCRIPT_ENDING:"/"===s?n.state=E.CLOSE_TAG:(n.script+="<"+s,n.state=E.SCRIPT);continue;case E.OPEN_WAKA:if("!"===s)n.state=E.SGML_DECL,n.sgmlDecl="";else if(m(s));else if(v(h,s))n.state=E.OPEN_TAG,n.tagName=s;else if("/"===s)n.state=E.CLOSE_TAG,n.tagName="";else if("?"===s)n.state=E.PROC_INST,n.procInstName=n.procInstBody="";else{if(I(n,"Unencoded <"),n.startTagPosition+1<n.position){var c=n.position-n.startTagPosition;s=new Array(c).join(" ")+s}n.textNode+="<"+s,n.state=E.TEXT}continue;case E.SGML_DECL:if(n.sgmlDecl+s==="--"){n.state=E.COMMENT,n.comment="",n.sgmlDecl="";continue}n.doctype&&!0!==n.doctype&&n.sgmlDecl?(n.state=E.DOCTYPE_DTD,n.doctype+="<!"+n.sgmlDecl+s,n.sgmlDecl=""):(n.sgmlDecl+s).toUpperCase()===a?(O(n,"onopencdata"),n.state=E.CDATA,n.sgmlDecl="",n.cdata=""):(n.sgmlDecl+s).toUpperCase()===o?(n.state=E.DOCTYPE,(n.doctype||n.sawRoot)&&I(n,"Inappropriately located doctype declaration"),n.doctype="",n.sgmlDecl=""):">"===s?(O(n,"onsgmldeclaration",n.sgmlDecl),n.sgmlDecl="",n.state=E.TEXT):y(s)?(n.state=E.SGML_DECL_QUOTED,n.sgmlDecl+=s):n.sgmlDecl+=s;continue;case E.SGML_DECL_QUOTED:s===n.q&&(n.state=E.SGML_DECL,n.q=""),n.sgmlDecl+=s;continue;case E.DOCTYPE:">"===s?(n.state=E.TEXT,O(n,"ondoctype",n.doctype),n.doctype=!0):(n.doctype+=s,"["===s?n.state=E.DOCTYPE_DTD:y(s)&&(n.state=E.DOCTYPE_QUOTED,n.q=s));continue;case E.DOCTYPE_QUOTED:n.doctype+=s,s===n.q&&(n.q="",n.state=E.DOCTYPE);continue;case E.DOCTYPE_DTD:"]"===s?(n.doctype+=s,n.state=E.DOCTYPE):"<"===s?(n.state=E.OPEN_WAKA,n.startTagPosition=n.position):y(s)?(n.doctype+=s,n.state=E.DOCTYPE_DTD_QUOTED,n.q=s):n.doctype+=s;continue;case E.DOCTYPE_DTD_QUOTED:n.doctype+=s,s===n.q&&(n.state=E.DOCTYPE_DTD,n.q="");continue;case E.COMMENT:"-"===s?n.state=E.COMMENT_ENDING:n.comment+=s;continue;case E.COMMENT_ENDING:"-"===s?(n.state=E.COMMENT_ENDED,n.comment=S(n.opt,n.comment),n.comment&&O(n,"oncomment",n.comment),n.comment=""):(n.comment+="-"+s,n.state=E.COMMENT);continue;case E.COMMENT_ENDED:">"!==s?(I(n,"Malformed comment"),n.comment+="--"+s,n.state=E.COMMENT):n.doctype&&!0!==n.doctype?n.state=E.DOCTYPE_DTD:n.state=E.TEXT;continue;case E.CDATA:"]"===s?n.state=E.CDATA_ENDING:n.cdata+=s;continue;case E.CDATA_ENDING:"]"===s?n.state=E.CDATA_ENDING_2:(n.cdata+="]"+s,n.state=E.CDATA);continue;case E.CDATA_ENDING_2:">"===s?(n.cdata&&O(n,"oncdata",n.cdata),O(n,"onclosecdata"),n.cdata="",n.state=E.TEXT):"]"===s?n.cdata+="]":(n.cdata+="]]"+s,n.state=E.CDATA);continue;case E.PROC_INST:"?"===s?n.state=E.PROC_INST_ENDING:m(s)?n.state=E.PROC_INST_BODY:n.procInstName+=s;continue;case E.PROC_INST_BODY:if(!n.procInstBody&&m(s))continue;"?"===s?n.state=E.PROC_INST_ENDING:n.procInstBody+=s;continue;case E.PROC_INST_ENDING:">"===s?(O(n,"onprocessinginstruction",{name:n.procInstName,body:n.procInstBody}),n.procInstName=n.procInstBody="",n.state=E.TEXT):(n.procInstBody+="?"+s,n.state=E.PROC_INST_BODY);continue;case E.OPEN_TAG:v(d,s)?n.tagName+=s:(Y(n),">"===s?P(n):"/"===s?n.state=E.OPEN_TAG_SLASH:(m(s)||I(n,"Invalid character in tag name"),n.state=E.ATTRIB));continue;case E.OPEN_TAG_SLASH:">"===s?(P(n,!0),F(n)):(I(n,"Forward-slash in opening tag not followed by >"),n.state=E.ATTRIB);continue;case E.ATTRIB:if(m(s))continue;">"===s?P(n):"/"===s?n.state=E.OPEN_TAG_SLASH:v(h,s)?(n.attribName=s,n.attribValue="",n.state=E.ATTRIB_NAME):I(n,"Invalid attribute name");continue;case E.ATTRIB_NAME:"="===s?n.state=E.ATTRIB_VALUE:">"===s?(I(n,"Attribute without value"),n.attribValue=n.attribName,L(n),P(n)):m(s)?n.state=E.ATTRIB_NAME_SAW_WHITE:v(d,s)?n.attribName+=s:I(n,"Invalid attribute name");continue;case E.ATTRIB_NAME_SAW_WHITE:if("="===s)n.state=E.ATTRIB_VALUE;else{if(m(s))continue;I(n,"Attribute without value"),n.tag.attributes[n.attribName]="",n.attribValue="",O(n,"onattribute",{name:n.attribName,value:""}),n.attribName="",">"===s?P(n):v(h,s)?(n.attribName=s,n.state=E.ATTRIB_NAME):(I(n,"Invalid attribute name"),n.state=E.ATTRIB)}continue;case E.ATTRIB_VALUE:if(m(s))continue;y(s)?(n.q=s,n.state=E.ATTRIB_VALUE_QUOTED):(n.opt.unquotedAttributeValues||x(n,"Unquoted attribute value"),n.state=E.ATTRIB_VALUE_UNQUOTED,n.attribValue=s);continue;case E.ATTRIB_VALUE_QUOTED:if(s!==n.q){"&"===s?n.state=E.ATTRIB_VALUE_ENTITY_Q:n.attribValue+=s;continue}L(n),n.q="",n.state=E.ATTRIB_VALUE_CLOSED;continue;case E.ATTRIB_VALUE_CLOSED:m(s)?n.state=E.ATTRIB:">"===s?P(n):"/"===s?n.state=E.OPEN_TAG_SLASH:v(h,s)?(I(n,"No whitespace between attributes"),n.attribName=s,n.attribValue="",n.state=E.ATTRIB_NAME):I(n,"Invalid attribute name");continue;case E.ATTRIB_VALUE_UNQUOTED:if(!g(s)){"&"===s?n.state=E.ATTRIB_VALUE_ENTITY_U:n.attribValue+=s;continue}L(n),">"===s?P(n):n.state=E.ATTRIB;continue;case E.CLOSE_TAG:if(n.tagName)">"===s?F(n):v(d,s)?n.tagName+=s:n.script?(n.script+="</"+n.tagName,n.tagName="",n.state=E.SCRIPT):(m(s)||I(n,"Invalid tagname in closing tag"),n.state=E.CLOSE_TAG_SAW_WHITE);else{if(m(s))continue;b(h,s)?n.script?(n.script+="</"+s,n.state=E.SCRIPT):I(n,"Invalid tagname in closing tag."):n.tagName=s}continue;case E.CLOSE_TAG_SAW_WHITE:if(m(s))continue;">"===s?F(n):I(n,"Invalid characters in closing tag");continue;case E.TEXT_ENTITY:case E.ATTRIB_VALUE_ENTITY_Q:case E.ATTRIB_VALUE_ENTITY_U:var l,_;switch(n.state){case E.TEXT_ENTITY:l=E.TEXT,_="textNode";break;case E.ATTRIB_VALUE_ENTITY_Q:l=E.ATTRIB_VALUE_QUOTED,_="attribValue";break;case E.ATTRIB_VALUE_ENTITY_U:l=E.ATTRIB_VALUE_UNQUOTED,_="attribValue"}if(";"===s){var w=k(n);n.opt.unparsedEntities&&!Object.values(e.XML_ENTITIES).includes(w)?(n.entity="",n.state=l,n.write(w)):(n[_]+=w,n.entity="",n.state=l)}else v(n.entity.length?p:f,s)?n.entity+=s:(I(n,"Invalid character in entity name"),n[_]+="&"+n.entity+s,n.entity="",n.state=l);continue;default:throw new Error(n,"Unknown state: "+n.state)}return n.position>=n.bufferCheckPosition&&function(t){for(var n=Math.max(e.MAX_BUFFER_LENGTH,10),i=0,s=0,a=r.length;s<a;s++){var o=t[r[s]].length;if(o>n)switch(r[s]){case"textNode":C(t);break;case"cdata":O(t,"oncdata",t.cdata),t.cdata="";break;case"script":O(t,"onscript",t.script),t.script="";break;default:x(t,"Max buffer length exceeded: "+r[s])}i=Math.max(i,o)}var u=e.MAX_BUFFER_LENGTH-i;t.bufferCheckPosition=u+t.position}(n),n}
/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;C(e=this),""!==e.cdata&&(O(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(O(e,"onscript",e.script),e.script="")}};try{t=Or.Stream}catch(e){t=function(){}}t||(t=function(){});var i=e.EVENTS.filter((function(e){return"error"!==e&&"end"!==e}));function s(e,r){if(!(this instanceof s))return new s(e,r);t.apply(this),this._parser=new n(e,r),this.writable=!0,this.readable=!0;var a=this;this._parser.onend=function(){a.emit("end")},this._parser.onerror=function(e){a.emit("error",e),a._parser.error=null},this._decoder=null,i.forEach((function(e){Object.defineProperty(a,"on"+e,{get:function(){return a._parser["on"+e]},set:function(t){if(!t)return a.removeAllListeners(e),a._parser["on"+e]=t,t;a.on(e,t)},enumerable:!0,configurable:!1})}))}s.prototype=Object.create(t.prototype,{constructor:{value:s}}),s.prototype.write=function(e){if("function"==typeof ie.isBuffer&&ie.isBuffer(e)){if(!this._decoder){var t=Cr.StringDecoder;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},s.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},s.prototype.on=function(e,r){var n=this;return n._parser["on"+e]||-1===i.indexOf(e)||(n._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),t.prototype.on.call(n,e,r)};var a="[CDATA[",o="DOCTYPE",u="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/2000/xmlns/",l={xml:u,xmlns:c},h=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,d=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,f=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,p=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function m(e){return" "===e||"\n"===e||"\r"===e||"\t"===e}function y(e){return'"'===e||"'"===e}function g(e){return">"===e||m(e)}function v(e,t){return e.test(t)}function b(e,t){return!v(e,t)}var _,w,T,E=0;for(var A in e.STATE={BEGIN:E++,BEGIN_WHITESPACE:E++,TEXT:E++,TEXT_ENTITY:E++,OPEN_WAKA:E++,SGML_DECL:E++,SGML_DECL_QUOTED:E++,DOCTYPE:E++,DOCTYPE_QUOTED:E++,DOCTYPE_DTD:E++,DOCTYPE_DTD_QUOTED:E++,COMMENT_STARTING:E++,COMMENT:E++,COMMENT_ENDING:E++,COMMENT_ENDED:E++,CDATA:E++,CDATA_ENDING:E++,CDATA_ENDING_2:E++,PROC_INST:E++,PROC_INST_BODY:E++,PROC_INST_ENDING:E++,OPEN_TAG:E++,OPEN_TAG_SLASH:E++,ATTRIB:E++,ATTRIB_NAME:E++,ATTRIB_NAME_SAW_WHITE:E++,ATTRIB_VALUE:E++,ATTRIB_VALUE_QUOTED:E++,ATTRIB_VALUE_CLOSED:E++,ATTRIB_VALUE_UNQUOTED:E++,ATTRIB_VALUE_ENTITY_Q:E++,ATTRIB_VALUE_ENTITY_U:E++,CLOSE_TAG:E++,CLOSE_TAG_SAW_WHITE:E++,SCRIPT:E++,SCRIPT_ENDING:E++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach((function(t){var r=e.ENTITIES[t],n="number"==typeof r?String.fromCharCode(r):r;e.ENTITIES[t]=n})),e.STATE)e.STATE[e.STATE[A]]=A;function D(e,t,r){e[t]&&e[t](r)}function O(e,t,r){e.textNode&&C(e),D(e,t,r)}function C(e){e.textNode=S(e.opt,e.textNode),e.textNode&&D(e,"ontext",e.textNode),e.textNode=""}function S(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function x(e,t){return C(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,D(e,"onerror",t),e}function N(e){return e.sawRoot&&!e.closedRoot&&I(e,"Unclosed root tag"),e.state!==E.BEGIN&&e.state!==E.BEGIN_WHITESPACE&&e.state!==E.TEXT&&x(e,"Unexpected end"),C(e),e.c="",e.closed=!0,D(e,"onend"),n.call(e,e.strict,e.opt),e}function I(e,t){if("object"!=typeof e||!(e instanceof n))throw new Error("bad call to strictFail");e.strict&&x(e,t)}function Y(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,r=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(r.ns=t.ns),e.attribList.length=0,O(e,"onopentagstart",r)}function R(e,t){var r=e.indexOf(":")<0?["",e]:e.split(":"),n=r[0],i=r[1];return t&&"xmlns"===e&&(n="xmlns",i=""),{prefix:n,local:i}}function L(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=R(e.attribName,!0),r=t.prefix,n=t.local;if("xmlns"===r)if("xml"===n&&e.attribValue!==u)I(e,"xml: prefix must be bound to "+u+"\nActual: "+e.attribValue);else if("xmlns"===n&&e.attribValue!==c)I(e,"xmlns: prefix must be bound to "+c+"\nActual: "+e.attribValue);else{var i=e.tag,s=e.tags[e.tags.length-1]||e;i.ns===s.ns&&(i.ns=Object.create(s.ns)),i.ns[n]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,O(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function P(e,t){if(e.opt.xmlns){var r=e.tag,n=R(e.tagName);r.prefix=n.prefix,r.local=n.local,r.uri=r.ns[n.prefix]||"",r.prefix&&!r.uri&&(I(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),r.uri=n.prefix);var i=e.tags[e.tags.length-1]||e;r.ns&&i.ns!==r.ns&&Object.keys(r.ns).forEach((function(t){O(e,"onopennamespace",{prefix:t,uri:r.ns[t]})}));for(var s=0,a=e.attribList.length;s<a;s++){var o=e.attribList[s],u=o[0],c=o[1],l=R(u,!0),h=l.prefix,d=l.local,f=""===h?"":r.ns[h]||"",p={name:u,value:c,prefix:h,local:d,uri:f};h&&"xmlns"!==h&&!f&&(I(e,"Unbound namespace prefix: "+JSON.stringify(h)),p.uri=h),e.tag.attributes[u]=p,O(e,"onattribute",p)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),O(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=E.TEXT:e.state=E.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function F(e){if(!e.tagName)return I(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=E.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=E.SCRIPT);O(e,"onscript",e.script),e.script=""}var t=e.tags.length,r=e.tagName;e.strict||(r=r[e.looseCase]());for(var n=r;t--&&e.tags[t].name!==n;)I(e,"Unexpected close tag");if(t<0)return I(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=E.TEXT);e.tagName=r;for(var i=e.tags.length;i-- >t;){var s=e.tag=e.tags.pop();e.tagName=e.tag.name,O(e,"onclosetag",e.tagName);var a={};for(var o in s.ns)a[o]=s.ns[o];var u=e.tags[e.tags.length-1]||e;e.opt.xmlns&&s.ns!==u.ns&&Object.keys(s.ns).forEach((function(t){var r=s.ns[t];O(e,"onclosenamespace",{prefix:t,uri:r})}))}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=E.TEXT}function k(e){var t,r=e.entity,n=r.toLowerCase(),i="";return e.ENTITIES[r]?e.ENTITIES[r]:e.ENTITIES[n]?e.ENTITIES[n]:("#"===(r=n).charAt(0)&&("x"===r.charAt(1)?(r=r.slice(2),i=(t=parseInt(r,16)).toString(16)):(r=r.slice(1),i=(t=parseInt(r,10)).toString(10))),r=r.replace(/^0+/,""),isNaN(t)||i.toLowerCase()!==r?(I(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function U(e,t){"<"===t?(e.state=E.OPEN_WAKA,e.startTagPosition=e.position):m(t)||(I(e,"Non-whitespace before first tag."),e.textNode=t,e.state=E.TEXT)}function B(e,t){var r="";return t<e.length&&(r=e.charAt(t)),r}E=e.STATE,String.fromCodePoint||(_=String.fromCharCode,w=Math.floor,T=function(){var e,t,r=[],n=-1,i=arguments.length;if(!i)return"";for(var s="";++n<i;){var a=Number(arguments[n]);if(!isFinite(a)||a<0||a>1114111||w(a)!==a)throw RangeError("Invalid code point: "+a);a<=65535?r.push(a):(e=55296+((a-=65536)>>10),t=a%1024+56320,r.push(e,t)),(n+1===i||r.length>16384)&&(s+=_.apply(null,r),r.length=0)}return s},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:T,configurable:!0,writable:!0}):String.fromCodePoint=T)}(He)),He}function xr(){return fr?dr:(fr=1,dr={isArray:function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}})}function Nr(){if(mr)return pr;mr=1;var e=xr().isArray;return pr={copyOptions:function(e){var t,r={};for(t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r},ensureFlagExists:function(e,t){e in t&&"boolean"==typeof t[e]||(t[e]=!1)},ensureSpacesExists:function(e){(!("spaces"in e)||"number"!=typeof e.spaces&&"string"!=typeof e.spaces)&&(e.spaces=0)},ensureAlwaysArrayExists:function(t){"alwaysArray"in t&&("boolean"==typeof t.alwaysArray||e(t.alwaysArray))||(t.alwaysArray=!1)},ensureKeyExists:function(e,t){e+"Key"in t&&"string"==typeof t[e+"Key"]||(t[e+"Key"]=t.compact?"_"+e:e)},checkFnExists:function(e,t){return e+"Fn"in t}}}function Ir(){if(gr)return yr;gr=1;var e,t,r=Sr(),n=Nr(),i=xr().isArray;function s(e){var t=Number(e);if(!isNaN(t))return t;var r=e.toLowerCase();return"true"===r||"false"!==r&&e}function a(r,n){var s;if(e.compact){if(!t[e[r+"Key"]]&&(i(e.alwaysArray)?-1!==e.alwaysArray.indexOf(e[r+"Key"]):e.alwaysArray)&&(t[e[r+"Key"]]=[]),t[e[r+"Key"]]&&!i(t[e[r+"Key"]])&&(t[e[r+"Key"]]=[t[e[r+"Key"]]]),r+"Fn"in e&&"string"==typeof n&&(n=e[r+"Fn"](n,t)),"instruction"===r&&("instructionFn"in e||"instructionNameFn"in e))for(s in n)if(n.hasOwnProperty(s))if("instructionFn"in e)n[s]=e.instructionFn(n[s],s,t);else{var a=n[s];delete n[s],n[e.instructionNameFn(s,a,t)]=a}i(t[e[r+"Key"]])?t[e[r+"Key"]].push(n):t[e[r+"Key"]]=n}else{t[e.elementsKey]||(t[e.elementsKey]=[]);var o={};if(o[e.typeKey]=r,"instruction"===r){for(s in n)if(n.hasOwnProperty(s))break;o[e.nameKey]="instructionNameFn"in e?e.instructionNameFn(s,n,t):s,e.instructionHasAttributes?(o[e.attributesKey]=n[s][e.attributesKey],"instructionFn"in e&&(o[e.attributesKey]=e.instructionFn(o[e.attributesKey],s,t))):("instructionFn"in e&&(n[s]=e.instructionFn(n[s],s,t)),o[e.instructionKey]=n[s])}else r+"Fn"in e&&(n=e[r+"Fn"](n,t)),o[e[r+"Key"]]=n;e.addParent&&(o[e.parentKey]=t),t[e.elementsKey].push(o)}}function o(r){var n;if("attributesFn"in e&&r&&(r=e.attributesFn(r,t)),(e.trim||"attributeValueFn"in e||"attributeNameFn"in e||e.nativeTypeAttributes)&&r)for(n in r)if(r.hasOwnProperty(n)&&(e.trim&&(r[n]=r[n].trim()),e.nativeTypeAttributes&&(r[n]=s(r[n])),"attributeValueFn"in e&&(r[n]=e.attributeValueFn(r[n],n,t)),"attributeNameFn"in e)){var i=r[n];delete r[n],r[e.attributeNameFn(n,r[n],t)]=i}return r}function u(r){var n={};if(r.body&&("xml"===r.name.toLowerCase()||e.instructionHasAttributes)){for(var i,s=/([\w:-]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|(\w+))\s*/g;null!==(i=s.exec(r.body));)n[i[1]]=i[2]||i[3]||i[4];n=o(n)}if("xml"===r.name.toLowerCase()){if(e.ignoreDeclaration)return;t[e.declarationKey]={},Object.keys(n).length&&(t[e.declarationKey][e.attributesKey]=n),e.addParent&&(t[e.declarationKey][e.parentKey]=t)}else{if(e.ignoreInstruction)return;e.trim&&(r.body=r.body.trim());var u={};e.instructionHasAttributes&&Object.keys(n).length?(u[r.name]={},u[r.name][e.attributesKey]=n):u[r.name]=r.body,a("instruction",u)}}function c(r,n){var s;if("object"==typeof r&&(n=r.attributes,r=r.name),n=o(n),"elementNameFn"in e&&(r=e.elementNameFn(r,t)),e.compact){var a;if(s={},!e.ignoreAttributes&&n&&Object.keys(n).length)for(a in s[e.attributesKey]={},n)n.hasOwnProperty(a)&&(s[e.attributesKey][a]=n[a]);!(r in t)&&(i(e.alwaysArray)?-1!==e.alwaysArray.indexOf(r):e.alwaysArray)&&(t[r]=[]),t[r]&&!i(t[r])&&(t[r]=[t[r]]),i(t[r])?t[r].push(s):t[r]=s}else t[e.elementsKey]||(t[e.elementsKey]=[]),(s={})[e.typeKey]="element",s[e.nameKey]=r,!e.ignoreAttributes&&n&&Object.keys(n).length&&(s[e.attributesKey]=n),e.alwaysChildren&&(s[e.elementsKey]=[]),t[e.elementsKey].push(s);s[e.parentKey]=t,t=s}function l(t){e.ignoreText||(t.trim()||e.captureSpacesBetweenElements)&&(e.trim&&(t=t.trim()),e.nativeType&&(t=s(t)),e.sanitize&&(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),a("text",t))}function h(t){e.ignoreComment||(e.trim&&(t=t.trim()),a("comment",t))}function d(r){var n=t[e.parentKey];e.addParent||delete t[e.parentKey],t=n}function f(t){e.ignoreCdata||(e.trim&&(t=t.trim()),a("cdata",t))}function p(t){e.ignoreDoctype||(t=t.replace(/^ /,""),e.trim&&(t=t.trim()),a("doctype",t))}function m(e){e.note=e}return yr=function(i,s){var a=r.parser(!0,{}),o={};if(t=o,e=function(t){return e=n.copyOptions(t),n.ensureFlagExists("ignoreDeclaration",e),n.ensureFlagExists("ignoreInstruction",e),n.ensureFlagExists("ignoreAttributes",e),n.ensureFlagExists("ignoreText",e),n.ensureFlagExists("ignoreComment",e),n.ensureFlagExists("ignoreCdata",e),n.ensureFlagExists("ignoreDoctype",e),n.ensureFlagExists("compact",e),n.ensureFlagExists("alwaysChildren",e),n.ensureFlagExists("addParent",e),n.ensureFlagExists("trim",e),n.ensureFlagExists("nativeType",e),n.ensureFlagExists("nativeTypeAttributes",e),n.ensureFlagExists("sanitize",e),n.ensureFlagExists("instructionHasAttributes",e),n.ensureFlagExists("captureSpacesBetweenElements",e),n.ensureAlwaysArrayExists(e),n.ensureKeyExists("declaration",e),n.ensureKeyExists("instruction",e),n.ensureKeyExists("attributes",e),n.ensureKeyExists("text",e),n.ensureKeyExists("comment",e),n.ensureKeyExists("cdata",e),n.ensureKeyExists("doctype",e),n.ensureKeyExists("type",e),n.ensureKeyExists("name",e),n.ensureKeyExists("elements",e),n.ensureKeyExists("parent",e),n.checkFnExists("doctype",e),n.checkFnExists("instruction",e),n.checkFnExists("cdata",e),n.checkFnExists("comment",e),n.checkFnExists("text",e),n.checkFnExists("instructionName",e),n.checkFnExists("elementName",e),n.checkFnExists("attributeName",e),n.checkFnExists("attributeValue",e),n.checkFnExists("attributes",e),e}(s),a.opt={strictEntities:!0},a.onopentag=c,a.ontext=l,a.oncomment=h,a.onclosetag=d,a.onerror=m,a.oncdata=f,a.ondoctype=p,a.onprocessinginstruction=u,a.write(i).close(),o[e.elementsKey]){var y=o[e.elementsKey];delete o[e.elementsKey],o[e.elementsKey]=y,delete o.text}return o}}function Yr(){if(br)return vr;br=1;var e=Nr(),t=Ir();return vr=function(r,n){var i,s,a,o;return i=function(t){var r=e.copyOptions(t);return e.ensureSpacesExists(r),r}(n),s=t(r,i),o="compact"in i&&i.compact?"_parent":"parent",a="addParent"in i&&i.addParent?JSON.stringify(s,(function(e,t){return e===o?"_":t}),i.spaces):JSON.stringify(s,null,i.spaces),a.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},vr}function Rr(){if(wr)return _r;wr=1;var e,t,r=Nr(),n=xr().isArray;function i(e,t,r){return(!r&&e.spaces?"\n":"")+Array(t+1).join(e.spaces)}function s(r,n,s){if(n.ignoreAttributes)return"";"attributesFn"in n&&(r=n.attributesFn(r,t,e));var a,o,u,c,l=[];for(a in r)r.hasOwnProperty(a)&&null!==r[a]&&void 0!==r[a]&&(c=n.noQuotesForNativeAttributes&&"string"!=typeof r[a]?"":'"',o=(o=""+r[a]).replace(/"/g,"&quot;"),u="attributeNameFn"in n?n.attributeNameFn(a,o,t,e):a,l.push(n.spaces&&n.indentAttributes?i(n,s+1,!1):" "),l.push(u+"="+c+("attributeValueFn"in n?n.attributeValueFn(o,a,t,e):o)+c));return r&&Object.keys(r).length&&n.spaces&&n.indentAttributes&&l.push(i(n,s,!1)),l.join("")}function a(r,n,i){return e=r,t="xml",n.ignoreDeclaration?"":"<?xml"+s(r[n.attributesKey],n,i)+"?>"}function o(r,n,i){if(n.ignoreInstruction)return"";var a;for(a in r)if(r.hasOwnProperty(a))break;var o="instructionNameFn"in n?n.instructionNameFn(a,r[a],t,e):a;if("object"==typeof r[a])return e=r,t=o,"<?"+o+s(r[a][n.attributesKey],n,i)+"?>";var u=r[a]?r[a]:"";return"instructionFn"in n&&(u=n.instructionFn(u,a,t,e)),"<?"+o+(u?" "+u:"")+"?>"}function u(r,n){return n.ignoreComment?"":"\x3c!--"+("commentFn"in n?n.commentFn(r,t,e):r)+"--\x3e"}function c(r,n){return n.ignoreCdata?"":"<![CDATA["+("cdataFn"in n?n.cdataFn(r,t,e):r.replace("]]>","]]]]><![CDATA[>"))+"]]>"}function l(r,n){return n.ignoreDoctype?"":"<!DOCTYPE "+("doctypeFn"in n?n.doctypeFn(r,t,e):r)+">"}function h(r,n){return n.ignoreText?"":(r=(r=(r=""+r).replace(/&amp;/g,"&")).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"textFn"in n?n.textFn(r,t,e):r)}function d(r,n,a,f){return r.reduce((function(r,p){var m=i(n,a,f&&!r);switch(p.type){case"element":return r+m+function(r,n,i){e=r,t=r.name;var a=[],o="elementNameFn"in n?n.elementNameFn(r.name,r):r.name;a.push("<"+o),r[n.attributesKey]&&a.push(s(r[n.attributesKey],n,i));var u=r[n.elementsKey]&&r[n.elementsKey].length||r[n.attributesKey]&&"preserve"===r[n.attributesKey]["xml:space"];return u||(u="fullTagEmptyElementFn"in n?n.fullTagEmptyElementFn(r.name,r):n.fullTagEmptyElement),u?(a.push(">"),r[n.elementsKey]&&r[n.elementsKey].length&&(a.push(d(r[n.elementsKey],n,i+1)),e=r,t=r.name),a.push(n.spaces&&function(e,t){var r;if(e.elements&&e.elements.length)for(r=0;r<e.elements.length;++r)switch(e.elements[r][t.typeKey]){case"text":if(t.indentText)return!0;break;case"cdata":if(t.indentCdata)return!0;break;case"instruction":if(t.indentInstruction)return!0;break;default:return!0}return!1}(r,n)?"\n"+Array(i+1).join(n.spaces):""),a.push("</"+o+">")):a.push("/>"),a.join("")}(p,n,a);case"comment":return r+m+u(p[n.commentKey],n);case"doctype":return r+m+l(p[n.doctypeKey],n);case"cdata":return r+(n.indentCdata?m:"")+c(p[n.cdataKey],n);case"text":return r+(n.indentText?m:"")+h(p[n.textKey],n);case"instruction":var y={};return y[p[n.nameKey]]=p[n.attributesKey]?p:p[n.instructionKey],r+(n.indentInstruction?m:"")+o(y,n,a)}}),"")}function f(e,t,r){var n;for(n in e)if(e.hasOwnProperty(n))switch(n){case t.parentKey:case t.attributesKey:break;case t.textKey:if(t.indentText||r)return!0;break;case t.cdataKey:if(t.indentCdata||r)return!0;break;case t.instructionKey:if(t.indentInstruction||r)return!0;break;case t.doctypeKey:case t.commentKey:default:return!0}return!1}function p(r,n,a,o,u){e=r,t=n;var c="elementNameFn"in a?a.elementNameFn(n,r):n;if(null==r||""===r)return"fullTagEmptyElementFn"in a&&a.fullTagEmptyElementFn(n,r)||a.fullTagEmptyElement?"<"+c+"></"+c+">":"<"+c+"/>";var l=[];if(n){if(l.push("<"+c),"object"!=typeof r)return l.push(">"+h(r,a)+"</"+c+">"),l.join("");r[a.attributesKey]&&l.push(s(r[a.attributesKey],a,o));var d=f(r,a,!0)||r[a.attributesKey]&&"preserve"===r[a.attributesKey]["xml:space"];if(d||(d="fullTagEmptyElementFn"in a?a.fullTagEmptyElementFn(n,r):a.fullTagEmptyElement),!d)return l.push("/>"),l.join("");l.push(">")}return l.push(m(r,a,o+1,!1)),e=r,t=n,n&&l.push((u?i(a,o,!1):"")+"</"+c+">"),l.join("")}function m(e,t,r,s){var d,m,y,g=[];for(m in e)if(e.hasOwnProperty(m))for(y=n(e[m])?e[m]:[e[m]],d=0;d<y.length;++d){switch(m){case t.declarationKey:g.push(a(y[d],t,r));break;case t.instructionKey:g.push((t.indentInstruction?i(t,r,s):"")+o(y[d],t,r));break;case t.attributesKey:case t.parentKey:break;case t.textKey:g.push((t.indentText?i(t,r,s):"")+h(y[d],t));break;case t.cdataKey:g.push((t.indentCdata?i(t,r,s):"")+c(y[d],t));break;case t.doctypeKey:g.push(i(t,r,s)+l(y[d],t));break;case t.commentKey:g.push(i(t,r,s)+u(y[d],t));break;default:g.push(i(t,r,s)+p(y[d],m,t,r,f(y[d],t)))}s=s&&!g.length}return g.join("")}return _r=function(n,i){i=function(e){var t=r.copyOptions(e);return r.ensureFlagExists("ignoreDeclaration",t),r.ensureFlagExists("ignoreInstruction",t),r.ensureFlagExists("ignoreAttributes",t),r.ensureFlagExists("ignoreText",t),r.ensureFlagExists("ignoreComment",t),r.ensureFlagExists("ignoreCdata",t),r.ensureFlagExists("ignoreDoctype",t),r.ensureFlagExists("compact",t),r.ensureFlagExists("indentText",t),r.ensureFlagExists("indentCdata",t),r.ensureFlagExists("indentAttributes",t),r.ensureFlagExists("indentInstruction",t),r.ensureFlagExists("fullTagEmptyElement",t),r.ensureFlagExists("noQuotesForNativeAttributes",t),r.ensureSpacesExists(t),"number"==typeof t.spaces&&(t.spaces=Array(t.spaces+1).join(" ")),r.ensureKeyExists("declaration",t),r.ensureKeyExists("instruction",t),r.ensureKeyExists("attributes",t),r.ensureKeyExists("text",t),r.ensureKeyExists("comment",t),r.ensureKeyExists("cdata",t),r.ensureKeyExists("doctype",t),r.ensureKeyExists("type",t),r.ensureKeyExists("name",t),r.ensureKeyExists("elements",t),r.checkFnExists("doctype",t),r.checkFnExists("instruction",t),r.checkFnExists("cdata",t),r.checkFnExists("comment",t),r.checkFnExists("text",t),r.checkFnExists("instructionName",t),r.checkFnExists("elementName",t),r.checkFnExists("attributeName",t),r.checkFnExists("attributeValue",t),r.checkFnExists("attributes",t),r.checkFnExists("fullTagEmptyElement",t),t}(i);var s=[];return e=n,t="_root_",i.compact?s.push(m(n,i,0,!0)):(n[i.declarationKey]&&s.push(a(n[i.declarationKey],i,0)),n[i.elementsKey]&&n[i.elementsKey].length&&s.push(d(n[i.elementsKey],i,0,!s.length))),s.join("")}}function Lr(){if(Er)return Tr;Er=1;var e=Rr();return Tr=function(t,r){t instanceof ie&&(t=t.toString());var n=null;if("string"==typeof t)try{n=JSON.parse(t)}catch(e){throw new Error("The JSON structure is invalid")}else n=t;return e(n,r)}}var Pr=function(){if(Dr)return Ar;Dr=1;var e=Ir(),t=Yr(),r=Rr(),n=Lr();return Ar={xml2js:e,xml2json:t,js2xml:r,json2xml:n}}(),Fr=t(Pr);const kr=e=>{const t=Number(e);if(!Number.isNaN(t))return t;const r=e.toLowerCase();return"true"===r||"false"!==r&&e},Ur=(e,t)=>{if(!e&&!t)return!0;if(!e||!t)return!1;const r=e.trim(),n=t.trim();if(Math.abs(r.length-n.length)>1)return!1;const i="/"===r.slice(-1)?r.slice(0,-1):r,s="/"===n.slice(-1)?n.slice(0,-1):n;return e.includes(s)||t.includes(i)},Br=(e,t)=>{if(!e&&!t)return!0;if(!e||!t)return!1;const r=e.trim(),n=t.trim(),i="/"===r.slice(-1)?r.slice(0,-1):r,s="/"===n.slice(-1)?n.slice(0,-1):n;return e.includes(s)||t.includes(i)},Mr=e=>e.reduce(((e,t)=>({...e,[j[t]]:t})),{}),Vr=e=>Object.entries(e).reduce(((e,[t,r])=>r?{...e,[t]:r}:e),{}),jr=(e,t)=>t?{[e]:t}:{},zr=(e,t)=>e?t&&0!==t.length?Object.fromEntries(Object.entries(e).filter((([e])=>!t.includes(e)))):e:{},Hr=e=>Boolean(null==e?void 0:e.includes(".ics")),$r=(e,t)=>{const r=/^\d{4}(-\d\d(-\d\d(T\d\d:\d\d(:\d\d)?(\.\d+)?(([+-]\d\d:\d\d)|Z)?)?)?)?$/i,n=/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+)?(([+-]\d\d:\d\d)|Z)?$/i;if(!(r.test(e)&&r.test(t)||n.test(e)&&n.test(t)))throw new Error("invalid timeRange format, not in ISO8601")};var Kr=Object.freeze({__proto__:null,cleanupFalsy:Vr,conditionalParam:jr,defaultIcsFilter:Hr,excludeHeaders:zr,getDAVAttribute:Mr,urlContains:Br,urlEquals:Ur,validateISO8601TimeRange:$r});const Wr=V("tsdav:request"),qr=async e=>{var t;const{url:r,init:n,convertIncoming:i=!0,parseOutgoing:a=!0,fetchOptions:o={}}=e,{headers:u={},body:c,namespace:l,method:h,attributes:d}=n,f=i?Fr.js2xml({_declaration:{_attributes:{version:"1.0",encoding:"utf-8"}},...c,_attributes:d},{compact:!0,spaces:2,elementNameFn:e=>l&&!/^.+:.+/.test(e)?`${l}:${e}`:e}):c,p={...o};delete p.headers;const m=await s.fetch(r,{headers:{"Content-Type":"text/xml;charset=UTF-8",...Vr(u),...o.headers||{}},body:f,method:h,...p}),y=await m.text();if(!m.ok||!(null===(t=m.headers.get("content-type"))||void 0===t?void 0:t.includes("xml"))||!a)return[{href:m.url,ok:m.ok,status:m.status,statusText:m.statusText,raw:y}];const g=Fr.xml2js(y,{compact:!0,trim:!0,textFn:(e,t)=>{try{const r=t._parent,n=Object.keys(r),i=n[n.length-1],s=r[i];if(s.length>0){s[s.length-1]=kr(e)}else r[i]=kr(e)}catch(e){Wr(e.stack)}},elementNameFn:e=>e.replace(/^.+:/,"").replace(/([-_]\w)/g,(e=>e[1].toUpperCase())),attributesFn:e=>{const t={...e};return delete t.xmlns,t},ignoreDeclaration:!0});return(Array.isArray(g.multistatus.response)?g.multistatus.response:[g.multistatus.response]).map((e=>{var t,r;if(!e)return{status:m.status,statusText:m.statusText,ok:m.ok};const n=/^\S+\s(?<status>\d+)\s(?<statusText>.+)$/.exec(e.status);return{raw:g,href:e.href,status:(null==n?void 0:n.groups)?Number.parseInt(null==n?void 0:n.groups.status,10):m.status,statusText:null!==(r=null===(t=null==n?void 0:n.groups)||void 0===t?void 0:t.statusText)&&void 0!==r?r:m.statusText,ok:!e.error,error:e.error,responsedescription:e.responsedescription,props:(Array.isArray(e.propstat)?e.propstat:[e.propstat]).reduce(((e,t)=>({...e,...null==t?void 0:t.prop})),{})}}))},Gr=async e=>{const{url:t,props:r,depth:n,headers:i,headersToExclude:s,fetchOptions:a={}}=e;return qr({url:t,init:{method:"PROPFIND",headers:zr(Vr({depth:n,...i}),s),namespace:z.DAV,body:{propfind:{_attributes:Mr([B.CALDAV,B.CALDAV_APPLE,B.CALENDAR_SERVER,B.CARDDAV,B.DAV]),prop:r}}},fetchOptions:a})},Zr=async e=>{const{url:t,data:r,headers:n,headersToExclude:i,fetchOptions:a={}}=e;return s.fetch(t,{method:"PUT",body:r,headers:zr(n,i),...a})},Jr=async e=>{const{url:t,data:r,etag:n,headers:i,headersToExclude:a,fetchOptions:o={}}=e;return s.fetch(t,{method:"PUT",body:r,headers:zr(Vr({"If-Match":n,...i}),a),...o})},Qr=async e=>{const{url:t,headers:r,etag:n,headersToExclude:i,fetchOptions:a={}}=e;return s.fetch(t,{method:"DELETE",headers:zr(Vr({"If-Match":n,...r}),i),...a})};var Xr=Object.freeze({__proto__:null,createObject:Zr,davRequest:qr,deleteObject:Qr,propfind:Gr,updateObject:Jr});function en(e,t){const r=e=>t.every((t=>e[t]));return Array.isArray(e)?e.every((e=>r(e))):r(e)}const tn=(e,t)=>t.reduce(((t,r)=>e[r]?t:`${t.length?`${t},`:""}${r.toString()}`),""),rn=V("tsdav:collection"),nn=async e=>{const{url:t,body:r,depth:n,defaultNamespace:i=z.DAV,headers:s,headersToExclude:a,fetchOptions:o={}}=e,u=await qr({url:t,init:{method:"REPORT",headers:zr(Vr({depth:n,...s}),a),namespace:i,body:r},fetchOptions:o});return 1!==u.length||u[0].raw?u:[]},sn=async e=>{const{url:t,props:r,depth:n,headers:i,headersToExclude:s,fetchOptions:a={}}=e;return qr({url:t,init:{method:"MKCOL",headers:zr(Vr({depth:n,...i}),s),namespace:z.DAV,body:r?{mkcol:{set:{prop:r}}}:void 0},fetchOptions:a})},an=async e=>{var t,r,n,i,s;const{collection:a,headers:o,headersToExclude:u,fetchOptions:c={}}=e;return null!==(s=null===(i=null===(n=null===(r=null===(t=(await Gr({url:a.url,props:{[`${z.DAV}:supported-report-set`]:{}},depth:"0",headers:zr(o,u),fetchOptions:c}))[0])||void 0===t?void 0:t.props)||void 0===r?void 0:r.supportedReportSet)||void 0===n?void 0:n.supportedReport)||void 0===i?void 0:i.map((e=>Object.keys(e.report)[0])))&&void 0!==s?s:[]},on=async e=>{var t,r,n;const{collection:i,headers:s,headersToExclude:a,fetchOptions:o={}}=e,u=(await Gr({url:i.url,props:{[`${z.CALENDAR_SERVER}:getctag`]:{}},depth:"0",headers:zr(s,a),fetchOptions:o})).filter((e=>Br(i.url,e.href)))[0];if(!u)throw new Error("Collection does not exist on server");return{isDirty:`${i.ctag}`!=`${null===(t=u.props)||void 0===t?void 0:t.getctag}`,newCtag:null===(n=null===(r=u.props)||void 0===r?void 0:r.getctag)||void 0===n?void 0:n.toString()}},un=e=>{const{url:t,props:r,headers:n,syncLevel:i,syncToken:s,headersToExclude:a,fetchOptions:o}=e;return qr({url:t,init:{method:"REPORT",namespace:z.DAV,headers:zr({...n},a),body:{"sync-collection":{_attributes:Mr([B.CALDAV,B.CARDDAV,B.DAV]),"sync-level":i,"sync-token":s,[`${z.DAV}:prop`]:r}}},fetchOptions:o})},cn=async e=>{var t,r,n,i,s,a,o,u,c,l,h;const{collection:d,method:f,headers:p,headersToExclude:m,account:y,detailedResult:g,fetchOptions:v={}}=e,b=["accountType","homeUrl"];if(!y||!en(y,b)){if(!y)throw new Error("no account for smartCollectionSync");throw new Error(`account must have ${tn(y,b)} before smartCollectionSync`)}const _=null!=f?f:(null===(t=d.reports)||void 0===t?void 0:t.includes("syncCollection"))?"webdav":"basic";if(rn(`smart collection sync with type ${y.accountType} and method ${_}`),"webdav"===_){const e=await un({url:d.url,props:{[`${z.DAV}:getetag`]:{},[`${"caldav"===y.accountType?z.CALDAV:z.CARDDAV}:${"caldav"===y.accountType?"calendar-data":"address-data"}`]:{},[`${z.DAV}:displayname`]:{}},syncLevel:1,syncToken:d.syncToken,headers:zr(p,m),fetchOptions:v}),t=e.filter((e=>{var t;const r="caldav"===y.accountType?".ics":".vcf";return(null===(t=e.href)||void 0===t?void 0:t.slice(-4))===r})),c=t.filter((e=>404!==e.status)).map((e=>e.href)),l=t.filter((e=>404===e.status)).map((e=>e.href)),h=(c.length&&null!==(n=await(null===(r=null==d?void 0:d.objectMultiGet)||void 0===r?void 0:r.call(d,{url:d.url,props:{[`${z.DAV}:getetag`]:{},[`${"caldav"===y.accountType?z.CALDAV:z.CARDDAV}:${"caldav"===y.accountType?"calendar-data":"address-data"}`]:{}},objectUrls:c,depth:"1",headers:zr(p,m),fetchOptions:v})))&&void 0!==n?n:[]).map((e=>{var t,r,n,i,s,a,o,u,c,l;return{url:null!==(t=e.href)&&void 0!==t?t:"",etag:null===(r=e.props)||void 0===r?void 0:r.getetag,data:"caldav"===(null==y?void 0:y.accountType)?null!==(s=null===(i=null===(n=e.props)||void 0===n?void 0:n.calendarData)||void 0===i?void 0:i._cdata)&&void 0!==s?s:null===(a=e.props)||void 0===a?void 0:a.calendarData:null!==(c=null===(u=null===(o=e.props)||void 0===o?void 0:o.addressData)||void 0===u?void 0:u._cdata)&&void 0!==c?c:null===(l=e.props)||void 0===l?void 0:l.addressData}})),f=null!==(i=d.objects)&&void 0!==i?i:[],b=h.filter((e=>f.every((t=>!Br(t.url,e.url))))),_=f.reduce(((e,t)=>{const r=h.find((e=>Br(e.url,t.url)));return r&&r.etag&&r.etag!==t.etag?[...e,r]:e}),[]),w=l.map((e=>({url:e,etag:""}))),T=f.filter((e=>h.some((t=>Br(e.url,t.url)&&t.etag===e.etag))));return{...d,objects:g?{created:b,updated:_,deleted:w}:[...T,...b,..._],syncToken:null!==(u=null===(o=null===(a=null===(s=e[0])||void 0===s?void 0:s.raw)||void 0===a?void 0:a.multistatus)||void 0===o?void 0:o.syncToken)&&void 0!==u?u:d.syncToken}}if("basic"===_){const{isDirty:e,newCtag:t}=await on({collection:d,headers:zr(p,m),fetchOptions:v}),r=null!==(c=d.objects)&&void 0!==c?c:[],n=null!==(h=await(null===(l=d.fetchObjects)||void 0===l?void 0:l.call(d,{collection:d,headers:zr(p,m),fetchOptions:v})))&&void 0!==h?h:[],i=n.filter((e=>r.every((t=>!Br(t.url,e.url))))),s=r.reduce(((e,t)=>{const r=n.find((e=>Br(e.url,t.url)));return r&&r.etag&&r.etag!==t.etag?[...e,r]:e}),[]),a=r.filter((e=>n.every((t=>!Br(t.url,e.url))))),o=r.filter((e=>n.some((t=>Br(e.url,t.url)&&t.etag===e.etag))));if(e)return{...d,objects:g?{created:i,updated:s,deleted:a}:[...o,...i,...s],ctag:t}}return g?{...d,objects:{created:[],updated:[],deleted:[]}}:d};var ln=Object.freeze({__proto__:null,collectionQuery:nn,isCollectionDirty:on,makeCollection:sn,smartCollectionSync:cn,supportedReportSet:an,syncCollection:un});const hn=V("tsdav:addressBook"),dn=async e=>{const{url:t,props:r,filters:n,depth:i,headers:s,headersToExclude:a,fetchOptions:o={}}=e;return nn({url:t,body:{"addressbook-query":Vr({_attributes:Mr([B.CARDDAV,B.DAV]),[`${z.DAV}:prop`]:r,filter:null!=n?n:{"prop-filter":{_attributes:{name:"FN"}}}})},defaultNamespace:z.CARDDAV,depth:i,headers:zr(s,a),fetchOptions:o})},fn=async e=>{const{url:t,props:r,objectUrls:n,depth:i,headers:s,headersToExclude:a,fetchOptions:o={}}=e;return nn({url:t,body:{"addressbook-multiget":Vr({_attributes:Mr([B.DAV,B.CARDDAV]),[`${z.DAV}:prop`]:r,[`${z.DAV}:href`]:n})},defaultNamespace:z.CARDDAV,depth:i,headers:zr(s,a),fetchOptions:o})},pn=async e=>{const{account:t,headers:r,props:n,headersToExclude:i,fetchOptions:s={}}=null!=e?e:{},a=["homeUrl","rootUrl"];if(!t||!en(t,a)){if(!t)throw new Error("no account for fetchAddressBooks");throw new Error(`account must have ${tn(t,a)} before fetchAddressBooks`)}const o=await Gr({url:t.homeUrl,props:null!=n?n:{[`${z.DAV}:displayname`]:{},[`${z.CALENDAR_SERVER}:getctag`]:{},[`${z.DAV}:resourcetype`]:{},[`${z.DAV}:sync-token`]:{}},depth:"1",headers:zr(r,i),fetchOptions:s});return Promise.all(o.filter((e=>{var t,r;return Object.keys(null!==(r=null===(t=e.props)||void 0===t?void 0:t.resourcetype)&&void 0!==r?r:{}).includes("addressbook")})).map((e=>{var r,n,i,s,a,o,u,c,l;const h=null!==(i=null===(n=null===(r=e.props)||void 0===r?void 0:r.displayname)||void 0===n?void 0:n._cdata)&&void 0!==i?i:null===(s=e.props)||void 0===s?void 0:s.displayname;return hn(`Found address book named ${"string"==typeof h?h:""},\n             props: ${JSON.stringify(e.props)}`),{url:new URL(null!==(a=e.href)&&void 0!==a?a:"",null!==(o=t.rootUrl)&&void 0!==o?o:"").href,ctag:null===(u=e.props)||void 0===u?void 0:u.getctag,displayName:"string"==typeof h?h:"",resourcetype:Object.keys(null===(c=e.props)||void 0===c?void 0:c.resourcetype),syncToken:null===(l=e.props)||void 0===l?void 0:l.syncToken}})).map((async e=>({...e,reports:await an({collection:e,headers:zr(r,i),fetchOptions:s})}))))},mn=async e=>{const{addressBook:t,headers:r,objectUrls:n,headersToExclude:i,urlFilter:s=e=>e,useMultiGet:a=!0,fetchOptions:o={}}=e;hn(`Fetching vcards from ${null==t?void 0:t.url}`);const u=["url"];if(!t||!en(t,u)){if(!t)throw new Error("cannot fetchVCards for undefined addressBook");throw new Error(`addressBook must have ${tn(t,u)} before fetchVCards`)}const c=(null!=n?n:(await dn({url:t.url,props:{[`${z.DAV}:getetag`]:{}},depth:"1",headers:zr(r,i),fetchOptions:o})).map((e=>{var t;return e.ok&&null!==(t=e.href)&&void 0!==t?t:""}))).map((e=>e.startsWith("http")||!e?e:new URL(e,t.url).href)).filter(s).map((e=>new URL(e).pathname));let l=[];return c.length>0&&(l=a?await fn({url:t.url,props:{[`${z.DAV}:getetag`]:{},[`${z.CARDDAV}:address-data`]:{}},objectUrls:c,depth:"1",headers:zr(r,i),fetchOptions:o}):await dn({url:t.url,props:{[`${z.DAV}:getetag`]:{},[`${z.CARDDAV}:address-data`]:{}},depth:"1",headers:zr(r,i),fetchOptions:o})),l.map((e=>{var r,n,i,s,a,o;return{url:new URL(null!==(r=e.href)&&void 0!==r?r:"",t.url).href,etag:null===(n=e.props)||void 0===n?void 0:n.getetag,data:null!==(a=null===(s=null===(i=e.props)||void 0===i?void 0:i.addressData)||void 0===s?void 0:s._cdata)&&void 0!==a?a:null===(o=e.props)||void 0===o?void 0:o.addressData}}))},yn=async e=>{const{addressBook:t,vCardString:r,filename:n,headers:i,headersToExclude:s,fetchOptions:a={}}=e;return Zr({url:new URL(n,t.url).href,data:r,headers:zr({"content-type":"text/vcard; charset=utf-8","If-None-Match":"*",...i},s),fetchOptions:a})},gn=async e=>{const{vCard:t,headers:r,headersToExclude:n,fetchOptions:i={}}=e;return Jr({url:t.url,data:t.data,etag:t.etag,headers:zr({"content-type":"text/vcard; charset=utf-8",...r},n),fetchOptions:i})},vn=async e=>{const{vCard:t,headers:r,headersToExclude:n,fetchOptions:i={}}=e;return Qr({url:t.url,etag:t.etag,headers:zr(r,n),fetchOptions:i})};var bn=Object.freeze({__proto__:null,addressBookMultiGet:fn,addressBookQuery:dn,createVCard:yn,deleteVCard:vn,fetchAddressBooks:pn,fetchVCards:mn,updateVCard:gn});const _n=V("tsdav:calendar"),wn=async e=>{var t,r,n;const{account:i,headers:s,headersToExclude:a,fetchOptions:o={}}=e,u=["principalUrl","rootUrl"];if(!en(i,u))throw new Error(`account must have ${tn(i,u)} before fetchUserAddresses`);_n(`Fetch user addresses from ${i.principalUrl}`);const c=(await Gr({url:i.principalUrl,props:{[`${z.CALDAV}:calendar-user-address-set`]:{}},depth:"0",headers:zr(s,a),fetchOptions:o})).find((e=>Br(i.principalUrl,e.href)));if(!c||!c.ok)throw new Error("cannot find calendarUserAddresses");const l=(null===(n=null===(r=null===(t=null==c?void 0:c.props)||void 0===t?void 0:t.calendarUserAddressSet)||void 0===r?void 0:r.href)||void 0===n?void 0:n.filter(Boolean))||[];return _n(`Fetched calendar user addresses ${l}`),l},Tn=async e=>{const{url:t,props:r,filters:n,timezone:i,depth:s,headers:a,headersToExclude:o,fetchOptions:u={}}=e;return nn({url:t,body:{"calendar-query":Vr({_attributes:Mr([B.CALDAV,B.CALENDAR_SERVER,B.CALDAV_APPLE,B.DAV]),[`${z.DAV}:prop`]:r,filter:n,timezone:i})},defaultNamespace:z.CALDAV,depth:s,headers:zr(a,o),fetchOptions:u})},En=async e=>{const{url:t,props:r,objectUrls:n,filters:i,timezone:s,depth:a,headers:o,headersToExclude:u,fetchOptions:c={}}=e;return nn({url:t,body:{"calendar-multiget":Vr({_attributes:Mr([B.DAV,B.CALDAV]),[`${z.DAV}:prop`]:r,[`${z.DAV}:href`]:n,filter:i,timezone:s})},defaultNamespace:z.CALDAV,depth:a,headers:zr(o,u),fetchOptions:c})},An=async e=>{const{url:t,props:r,depth:n,headers:i,headersToExclude:s,fetchOptions:a={}}=e;return qr({url:t,init:{method:"MKCALENDAR",headers:zr(Vr({depth:n,...i}),s),namespace:z.DAV,body:{[`${z.CALDAV}:mkcalendar`]:{_attributes:Mr([B.DAV,B.CALDAV,B.CALDAV_APPLE]),set:{prop:r}}}},fetchOptions:a})},Dn=async e=>{const{headers:t,account:r,props:n,projectedProps:i,headersToExclude:s,fetchOptions:a={}}=null!=e?e:{},o=["homeUrl","rootUrl"];if(!r||!en(r,o)){if(!r)throw new Error("no account for fetchCalendars");throw new Error(`account must have ${tn(r,o)} before fetchCalendars`)}const u=await Gr({url:r.homeUrl,props:null!=n?n:{[`${z.CALDAV}:calendar-description`]:{},[`${z.CALDAV}:calendar-timezone`]:{},[`${z.DAV}:displayname`]:{},[`${z.CALDAV_APPLE}:calendar-color`]:{},[`${z.CALENDAR_SERVER}:getctag`]:{},[`${z.DAV}:resourcetype`]:{},[`${z.CALDAV}:supported-calendar-component-set`]:{},[`${z.DAV}:sync-token`]:{}},depth:"1",headers:zr(t,s),fetchOptions:a});return Promise.all(u.filter((e=>{var t,r;return Object.keys(null!==(r=null===(t=e.props)||void 0===t?void 0:t.resourcetype)&&void 0!==r?r:{}).includes("calendar")})).filter((e=>{var t,r,n,i,s,a;return(Array.isArray(null===(r=null===(t=e.props)||void 0===t?void 0:t.supportedCalendarComponentSet)||void 0===r?void 0:r.comp)?null===(n=e.props)||void 0===n?void 0:n.supportedCalendarComponentSet.comp.map((e=>e._attributes.name)):[null===(a=null===(s=null===(i=e.props)||void 0===i?void 0:i.supportedCalendarComponentSet)||void 0===s?void 0:s.comp)||void 0===a?void 0:a._attributes.name]).some((e=>Object.values(H).includes(e)))})).map((e=>{var t,n,s,a,o,u,c,l,h,d,f,p,m,y,g,v;const b=null===(t=e.props)||void 0===t?void 0:t.calendarDescription,_=null===(n=e.props)||void 0===n?void 0:n.calendarTimezone;return{description:"string"==typeof b?b:"",timezone:"string"==typeof _?_:"",url:new URL(null!==(s=e.href)&&void 0!==s?s:"",null!==(a=r.rootUrl)&&void 0!==a?a:"").href,ctag:null===(o=e.props)||void 0===o?void 0:o.getctag,calendarColor:null===(u=e.props)||void 0===u?void 0:u.calendarColor,displayName:null!==(l=null===(c=e.props)||void 0===c?void 0:c.displayname._cdata)&&void 0!==l?l:null===(h=e.props)||void 0===h?void 0:h.displayname,components:Array.isArray(null===(d=e.props)||void 0===d?void 0:d.supportedCalendarComponentSet.comp)?null===(f=e.props)||void 0===f?void 0:f.supportedCalendarComponentSet.comp.map((e=>e._attributes.name)):[null===(m=null===(p=e.props)||void 0===p?void 0:p.supportedCalendarComponentSet.comp)||void 0===m?void 0:m._attributes.name],resourcetype:Object.keys(null===(y=e.props)||void 0===y?void 0:y.resourcetype),syncToken:null===(g=e.props)||void 0===g?void 0:g.syncToken,...jr("projectedProps",Object.fromEntries(Object.entries(null!==(v=e.props)&&void 0!==v?v:{}).filter((([e])=>null==i?void 0:i[e]))))}})).map((async e=>({...e,reports:await an({collection:e,headers:zr(t,s),fetchOptions:a})}))))},On=async e=>{const{calendar:t,objectUrls:r,filters:n,timeRange:i,headers:s,expand:a,urlFilter:o=e=>Boolean(null==e?void 0:e.includes(".ics")),useMultiGet:u=!0,headersToExclude:c,fetchOptions:l={}}=e;if(i){const e=/^\d{4}(-\d\d(-\d\d(T\d\d:\d\d(:\d\d)?(\.\d+)?(([+-]\d\d:\d\d)|Z)?)?)?)?$/i,t=/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+)?(([+-]\d\d:\d\d)|Z)?$/i;if(!(e.test(i.start)&&e.test(i.end)||t.test(i.start)&&t.test(i.end)))throw new Error("invalid timeRange format, not in ISO8601")}_n(`Fetching calendar objects from ${null==t?void 0:t.url}`);const h=["url"];if(!t||!en(t,h)){if(!t)throw new Error("cannot fetchCalendarObjects for undefined calendar");throw new Error(`calendar must have ${tn(t,h)} before fetchCalendarObjects`)}const d=null!=n?n:[{"comp-filter":{_attributes:{name:"VCALENDAR"},"comp-filter":{_attributes:{name:"VEVENT"},...i?{"time-range":{_attributes:{start:`${new Date(i.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(i.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}}:{}}}}],f=(null!=r?r:(await Tn({url:t.url,props:{[`${z.DAV}:getetag`]:{...a&&i?{[`${z.CALDAV}:expand`]:{_attributes:{start:`${new Date(i.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(i.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}}:{}}},filters:d,depth:"1",headers:zr(s,c),fetchOptions:l})).map((e=>{var t;return null!==(t=e.href)&&void 0!==t?t:""}))).map((e=>e.startsWith("http")||!e?e:new URL(e,t.url).href)).filter(o).map((e=>new URL(e).pathname));let p=[];return f.length>0&&(p=!u||a?await Tn({url:t.url,props:{[`${z.DAV}:getetag`]:{},[`${z.CALDAV}:calendar-data`]:{...a&&i?{[`${z.CALDAV}:expand`]:{_attributes:{start:`${new Date(i.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(i.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}}:{}}},filters:d,depth:"1",headers:zr(s,c),fetchOptions:l}):await En({url:t.url,props:{[`${z.DAV}:getetag`]:{},[`${z.CALDAV}:calendar-data`]:{...a&&i?{[`${z.CALDAV}:expand`]:{_attributes:{start:`${new Date(i.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(i.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}}:{}}},objectUrls:f,depth:"1",headers:zr(s,c),fetchOptions:l})),p.map((e=>{var r,n,i,s,a,o;return{url:new URL(null!==(r=e.href)&&void 0!==r?r:"",t.url).href,etag:`${null===(n=e.props)||void 0===n?void 0:n.getetag}`,data:null!==(a=null===(s=null===(i=e.props)||void 0===i?void 0:i.calendarData)||void 0===s?void 0:s._cdata)&&void 0!==a?a:null===(o=e.props)||void 0===o?void 0:o.calendarData}}))},Cn=async e=>{const{calendar:t,iCalString:r,filename:n,headers:i,headersToExclude:s,fetchOptions:a={}}=e;return Zr({url:new URL(n,t.url).href,data:r,headers:zr({"content-type":"text/calendar; charset=utf-8","If-None-Match":"*",...i},s),fetchOptions:a})},Sn=async e=>{const{calendarObject:t,headers:r,headersToExclude:n,fetchOptions:i={}}=e;return Jr({url:t.url,data:t.data,etag:t.etag,headers:zr({"content-type":"text/calendar; charset=utf-8",...r},n),fetchOptions:i})},xn=async e=>{const{calendarObject:t,headers:r,headersToExclude:n,fetchOptions:i={}}=e;return Qr({url:t.url,etag:t.etag,headers:zr(r,n),fetchOptions:i})},Nn=async e=>{var t;const{oldCalendars:r,account:n,detailedResult:i,headers:s,headersToExclude:a,fetchOptions:o={}}=e;if(!n)throw new Error("Must have account before syncCalendars");const u=null!==(t=null!=r?r:n.calendars)&&void 0!==t?t:[],c=await Dn({account:n,headers:zr(s,a),fetchOptions:o}),l=c.filter((e=>u.every((t=>!Br(t.url,e.url)))));_n(`new calendars: ${l.map((e=>e.displayName))}`);const h=u.reduce(((e,t)=>{const r=c.find((e=>Br(e.url,t.url)));return r&&(r.syncToken&&`${r.syncToken}`!=`${t.syncToken}`||r.ctag&&`${r.ctag}`!=`${t.ctag}`)?[...e,r]:e}),[]);_n(`updated calendars: ${h.map((e=>e.displayName))}`);const d=await Promise.all(h.map((async e=>await cn({collection:{...e,objectMultiGet:En},method:"webdav",headers:zr(s,a),account:n,fetchOptions:o})))),f=u.filter((e=>c.every((t=>!Br(t.url,e.url)))));_n(`deleted calendars: ${f.map((e=>e.displayName))}`);const p=u.filter((e=>c.some((t=>Br(t.url,e.url)&&(t.syncToken&&`${t.syncToken}`!=`${e.syncToken}`||t.ctag&&`${t.ctag}`!=`${e.ctag}`)))));return i?{created:l,updated:h,deleted:f}:[...p,...l,...d]},In=async e=>{const{url:t,timeRange:r,depth:n,headers:i,headersToExclude:s,fetchOptions:a={}}=e;if(!r)throw new Error("timeRange is required");{const e=/^\d{4}(-\d\d(-\d\d(T\d\d:\d\d(:\d\d)?(\.\d+)?(([+-]\d\d:\d\d)|Z)?)?)?)?$/i,t=/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+)?(([+-]\d\d:\d\d)|Z)?$/i;if(!(e.test(r.start)&&e.test(r.end)||t.test(r.start)&&t.test(r.end)))throw new Error("invalid timeRange format, not in ISO8601")}return(await nn({url:t,body:{"free-busy-query":Vr({_attributes:Mr([B.CALDAV]),[`${z.CALDAV}:time-range`]:{_attributes:{start:`${new Date(r.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(r.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}})},defaultNamespace:z.CALDAV,depth:n,headers:zr(i,s),fetchOptions:a}))[0]};var Yn=Object.freeze({__proto__:null,calendarMultiGet:En,calendarQuery:Tn,createCalendarObject:Cn,deleteCalendarObject:xn,fetchCalendarObjects:On,fetchCalendarUserAddresses:wn,fetchCalendars:Dn,freeBusyQuery:In,makeCalendar:An,syncCalendars:Nn,updateCalendarObject:Sn});const Rn=V("tsdav:account"),Ln=async e=>{var t,r;Rn("Service discovery...");const{account:n,headers:i,headersToExclude:a,fetchOptions:o={}}=e,u=new URL(n.serverUrl),c=new URL(`/.well-known/${n.accountType}`,u);c.protocol=null!==(t=u.protocol)&&void 0!==t?t:"http";try{const e=await s.fetch(c.href,{headers:zr(i,a),method:"PROPFIND",redirect:"manual",...o});if(e.status>=300&&e.status<400){const t=e.headers.get("Location");if("string"==typeof t&&t.length){Rn(`Service discovery redirected to ${t}`);const e=new URL(t,u);return e.hostname===c.hostname&&c.port&&!e.port&&(e.port=c.port),e.protocol=null!==(r=u.protocol)&&void 0!==r?r:"http",e.href}}}catch(e){Rn(`Service discovery failed: ${e.stack}`)}return u.href},Pn=async e=>{var t,r,n,i,s;const{account:a,headers:o,headersToExclude:u,fetchOptions:c={}}=e,l=["rootUrl"];if(!en(a,l))throw new Error(`account must have ${tn(a,l)} before fetchPrincipalUrl`);Rn(`Fetching principal url from path ${a.rootUrl}`);const[h]=await Gr({url:a.rootUrl,props:{[`${z.DAV}:current-user-principal`]:{}},depth:"0",headers:zr(o,u),fetchOptions:c});if(!h.ok&&(Rn(`Fetch principal url failed: ${h.statusText}`),401===h.status))throw new Error("Invalid credentials");return Rn(`Fetched principal url ${null===(r=null===(t=h.props)||void 0===t?void 0:t.currentUserPrincipal)||void 0===r?void 0:r.href}`),new URL(null!==(s=null===(i=null===(n=h.props)||void 0===n?void 0:n.currentUserPrincipal)||void 0===i?void 0:i.href)&&void 0!==s?s:"",a.rootUrl).href},Fn=async e=>{var t,r;const{account:n,headers:i,headersToExclude:s,fetchOptions:a={}}=e,o=["principalUrl","rootUrl"];if(!en(n,o))throw new Error(`account must have ${tn(n,o)} before fetchHomeUrl`);Rn(`Fetch home url from ${n.principalUrl}`);const u=await Gr({url:n.principalUrl,props:"caldav"===n.accountType?{[`${z.CALDAV}:calendar-home-set`]:{}}:{[`${z.CARDDAV}:addressbook-home-set`]:{}},depth:"0",headers:zr(i,s),fetchOptions:a}),c=u.find((e=>Br(n.principalUrl,e.href)));if(!c||!c.ok)throw Rn(`Fetch home url failed with status ${null==c?void 0:c.statusText} and error ${JSON.stringify(u.map((e=>e.error)))}`),new Error("cannot find homeUrl");const l=new URL("caldav"===n.accountType?null===(t=null==c?void 0:c.props)||void 0===t?void 0:t.calendarHomeSet.href:null===(r=null==c?void 0:c.props)||void 0===r?void 0:r.addressbookHomeSet.href,n.rootUrl).href;return Rn(`Fetched home url ${l}`),l},kn=async e=>{const{account:t,headers:r,loadCollections:n=!1,loadObjects:i=!1,headersToExclude:s,fetchOptions:a={}}=e,o={...t};return o.rootUrl=await Ln({account:t,headers:zr(r,s),fetchOptions:a}),o.principalUrl=await Pn({account:o,headers:zr(r,s),fetchOptions:a}),o.homeUrl=await Fn({account:o,headers:zr(r,s),fetchOptions:a}),(n||i)&&("caldav"===t.accountType?o.calendars=await Dn({headers:zr(r,s),account:o,fetchOptions:a}):"carddav"===t.accountType&&(o.addressBooks=await pn({headers:zr(r,s),account:o,fetchOptions:a}))),i&&("caldav"===t.accountType&&o.calendars?o.calendars=await Promise.all(o.calendars.map((async e=>({...e,objects:await On({calendar:e,headers:zr(r,s),fetchOptions:a})})))):"carddav"===t.accountType&&o.addressBooks&&(o.addressBooks=await Promise.all(o.addressBooks.map((async e=>({...e,objects:await mn({addressBook:e,headers:zr(r,s),fetchOptions:a})})))))),o};var Un=Object.freeze({__proto__:null,createAccount:kn,fetchHomeUrl:Fn,fetchPrincipalUrl:Pn,serviceDiscovery:Ln});const Bn=V("tsdav:todo"),Mn=e=>({[`${z.CALDAV}:expand`]:{_attributes:{start:`${new Date(e.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(e.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}}),Vn=async e=>{const{url:t,props:r,filters:n,timezone:i,depth:s,headers:a,headersToExclude:o,fetchOptions:u={}}=e;return nn({url:t,body:{"calendar-query":Vr({_attributes:Mr([B.CALDAV,B.CALENDAR_SERVER,B.CALDAV_APPLE,B.DAV]),[`${z.DAV}:prop`]:r,filter:n,timezone:i})},defaultNamespace:z.CALDAV,depth:s,headers:zr(a,o),fetchOptions:u})},jn=async e=>{const{url:t,props:r,objectUrls:n,filters:i,timezone:s,depth:a,headers:o,headersToExclude:u,fetchOptions:c={}}=e;return nn({url:t,body:{"calendar-multiget":Vr({_attributes:Mr([B.DAV,B.CALDAV]),[`${z.DAV}:prop`]:r,[`${z.DAV}:href`]:n,filter:i,timezone:s})},defaultNamespace:z.CALDAV,depth:a,headers:zr(o,u),fetchOptions:c})},zn=async e=>{const{calendar:t,objectUrls:r,filters:n,timeRange:i,headers:s,expand:a,urlFilter:o=Hr,useMultiGet:u=!0,headersToExclude:c,fetchOptions:l={}}=e;i&&$r(i.start,i.end),Bn(`Fetching todo objects from ${null==t?void 0:t.url}`);const h=["url"];if(!t||!en(t,h)){if(!t)throw new Error("cannot fetchTodos for undefined calendar");throw new Error(`calendar must have ${tn(t,h)} before fetchTodos`)}const d=null!=n?n:[{"comp-filter":{_attributes:{name:"VCALENDAR"},"comp-filter":{_attributes:{name:"VTODO"},...i?{"time-range":{_attributes:{start:`${new Date(i.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(i.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}}:{}}}}],f=(null!=r?r:(await Vn({url:t.url,props:{[`${z.DAV}:getetag`]:{...a&&i?Mn(i):{}}},filters:d,depth:"1",headers:zr(s,c),fetchOptions:l})).map((e=>{var t;return null!==(t=e.href)&&void 0!==t?t:""}))).map((e=>e.startsWith("http")||!e?e:new URL(e,t.url).href)).filter(o).map((e=>new URL(e).pathname));let p=[];return f.length>0&&(p=!u||a?await Vn({url:t.url,props:{[`${z.DAV}:getetag`]:{},[`${z.CALDAV}:calendar-data`]:{...a&&i?Mn(i):{}}},filters:d,depth:"1",headers:zr(s,c),fetchOptions:l}):await jn({url:t.url,props:{[`${z.DAV}:getetag`]:{},[`${z.CALDAV}:calendar-data`]:{...a&&i?Mn(i):{}}},objectUrls:f,depth:"1",headers:zr(s,c),fetchOptions:l})),p.map((e=>{var r,n,i,s,a,o;return{url:new URL(null!==(r=e.href)&&void 0!==r?r:"",t.url).href,etag:`${null===(n=e.props)||void 0===n?void 0:n.getetag}`,data:null!==(a=null===(s=null===(i=e.props)||void 0===i?void 0:i.calendarData)||void 0===s?void 0:s._cdata)&&void 0!==a?a:null===(o=e.props)||void 0===o?void 0:o.calendarData}}))},Hn=async e=>{const{calendar:t,iCalString:r,filename:n,headers:i,headersToExclude:s,fetchOptions:a={}}=e;if(!r.includes("UID:"))throw new Error("iCalString must contain a UID");return Zr({url:new URL(n,t.url).href,data:r,headers:zr({"content-type":"text/calendar; charset=utf-8","If-None-Match":"*",...i},s),fetchOptions:a})},$n=async e=>{const{calendarObject:t,headers:r,headersToExclude:n,fetchOptions:i={}}=e;if(!t.etag)throw new Error("calendarObject must have etag for update - fetch todo first");return Jr({url:t.url,data:t.data,etag:t.etag,headers:zr({"content-type":"text/calendar; charset=utf-8",...r},n),fetchOptions:i})},Kn=async e=>{const{calendarObject:t,headers:r,headersToExclude:n,fetchOptions:i={}}=e;return Qr({url:t.url,etag:t.etag,headers:zr(r,n),fetchOptions:i})};var Wn,qn=Object.freeze({__proto__:null,createTodo:Hn,deleteTodo:Kn,fetchTodos:zn,todoMultiGet:jn,todoQuery:Vn,updateTodo:$n}),Gn={exports:{}};var Zn,Jn,Qn=(Wn||(Wn=1,Zn=Gn,Jn=Gn.exports,function(t){var r=Jn,n=Zn&&Zn.exports==r&&Zn,i="object"==typeof e&&e;i.global!==i&&i.window!==i||(t=i);var s=function(e){this.message=e};(s.prototype=new Error).name="InvalidCharacterError";var a=function(e){throw new s(e)},o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=/[\t\n\f\r ]/g,c={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&a("The string to be encoded contains characters outside of the Latin1 range.");for(var t,r,n,i,s=e.length%3,u="",c=-1,l=e.length-s;++c<l;)t=e.charCodeAt(c)<<16,r=e.charCodeAt(++c)<<8,n=e.charCodeAt(++c),u+=o.charAt((i=t+r+n)>>18&63)+o.charAt(i>>12&63)+o.charAt(i>>6&63)+o.charAt(63&i);return 2==s?(t=e.charCodeAt(c)<<8,r=e.charCodeAt(++c),u+=o.charAt((i=t+r)>>10)+o.charAt(i>>4&63)+o.charAt(i<<2&63)+"="):1==s&&(i=e.charCodeAt(c),u+=o.charAt(i>>2)+o.charAt(i<<4&63)+"=="),u},decode:function(e){var t=(e=String(e).replace(u,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&a("Invalid character: the string to be decoded is not correctly encoded.");for(var r,n,i=0,s="",c=-1;++c<t;)n=o.indexOf(e.charAt(c)),r=i%4?64*r+n:n,i++%4&&(s+=String.fromCharCode(255&r>>(-2*i&6)));return s},version:"1.0.0"};if(r&&!r.nodeType)if(n)n.exports=c;else for(var l in c)c.hasOwnProperty(l)&&(r[l]=c[l]);else t.base64=c}(Gn.exports)),Gn.exports);const Xn=V("tsdav:authHelper"),ei=(e,t)=>(...r)=>e({...t,...r[0]}),ti=e=>(Xn(`Basic auth token generated: ${Qn.encode(`${e.username}:${e.password}`)}`),{authorization:`Basic ${Qn.encode(`${e.username}:${e.password}`)}`}),ri=async(e,t)=>{const r=["authorizationCode","redirectUrl","clientId","clientSecret","tokenUrl"];if(!en(e,r))throw new Error(`Oauth credentials missing: ${tn(e,r)}`);const n=new URLSearchParams({grant_type:"authorization_code",code:e.authorizationCode,redirect_uri:e.redirectUrl,client_id:e.clientId,client_secret:e.clientSecret});Xn(e.tokenUrl),Xn(n.toString());const i=await s.fetch(e.tokenUrl,{method:"POST",body:n.toString(),headers:{"content-length":`${n.toString().length}`,"content-type":"application/x-www-form-urlencoded"},...null!=t?t:{}});if(i.ok){return await i.json()}return Xn(`Fetch Oauth tokens failed: ${await i.text()}`),{}},ni=async(e,t)=>{const r=["refreshToken","clientId","clientSecret","tokenUrl"];if(!en(e,r))throw new Error(`Oauth credentials missing: ${tn(e,r)}`);const n=new URLSearchParams({client_id:e.clientId,client_secret:e.clientSecret,refresh_token:e.refreshToken,grant_type:"refresh_token"}),i=await s.fetch(e.tokenUrl,{method:"POST",body:n.toString(),headers:{"Content-Type":"application/x-www-form-urlencoded"},...null!=t?t:{}});if(i.ok){return await i.json()}return Xn(`Refresh access token failed: ${await i.text()}`),{}},ii=async(e,t)=>{var r;Xn("Fetching oauth headers");let n={};return e.refreshToken?(e.refreshToken&&!e.accessToken||Date.now()>(null!==(r=e.expiration)&&void 0!==r?r:0))&&(n=await ni(e,t)):n=await ri(e,t),Xn(`Oauth tokens fetched: ${n.access_token}`),{tokens:n,headers:{authorization:`Bearer ${n.access_token}`}}};var si=Object.freeze({__proto__:null,defaultParam:ei,fetchOauthTokens:ri,getBasicAuthHeaders:ti,getOauthHeaders:ii,refreshAccessToken:ni});const ai=async e=>{var t;const{serverUrl:r,credentials:n,authMethod:i,defaultAccountType:s,authFunction:a}=e;let o={};switch(i){case"Basic":o=ti(n);break;case"Oauth":o=(await ii(n)).headers;break;case"Digest":o={Authorization:`Digest ${n.digestString}`};break;case"Custom":o=null!==(t=await(null==a?void 0:a(n)))&&void 0!==t?t:{};break;default:throw new Error("Invalid auth method")}const u=s?await kn({account:{serverUrl:r,credentials:n,accountType:s},headers:o}):void 0,c=ei(Zr,{url:r,headers:o}),l=ei(Jr,{headers:o,url:r}),h=ei(Qr,{headers:o,url:r}),d=ei(Gr,{headers:o}),f=ei(nn,{headers:o}),p=ei(sn,{headers:o}),m=ei(un,{headers:o}),y=ei(an,{headers:o}),g=ei(on,{headers:o}),v=ei(cn,{headers:o,account:u}),b=ei(Tn,{headers:o}),_=ei(En,{headers:o}),w=ei(An,{headers:o}),T=ei(Dn,{headers:o,account:u}),E=ei(wn,{headers:o,account:u}),A=ei(On,{headers:o}),D=ei(Cn,{headers:o}),O=ei(Sn,{headers:o}),C=ei(xn,{headers:o}),S=ei(Nn,{account:u,headers:o}),x=ei(dn,{headers:o}),N=ei(fn,{headers:o});return{davRequest:async e=>{const{init:t,...r}=e,{headers:n,...i}=t;return qr({...r,init:{...i,headers:{...o,...n}}})},propfind:d,createAccount:async e=>{const{account:t,headers:i,loadCollections:s,loadObjects:a}=e;return kn({account:{serverUrl:r,credentials:n,...t},headers:{...o,...i},loadCollections:s,loadObjects:a})},createObject:c,updateObject:l,deleteObject:h,calendarQuery:b,addressBookQuery:x,collectionQuery:f,makeCollection:p,calendarMultiGet:_,makeCalendar:w,syncCollection:m,supportedReportSet:y,isCollectionDirty:g,smartCollectionSync:v,fetchCalendars:T,fetchCalendarUserAddresses:E,fetchCalendarObjects:A,createCalendarObject:D,updateCalendarObject:O,deleteCalendarObject:C,syncCalendars:S,fetchAddressBooks:ei(pn,{account:u,headers:o}),addressBookMultiGet:N,fetchVCards:ei(mn,{headers:o}),createVCard:ei(yn,{headers:o}),updateVCard:ei(gn,{headers:o}),deleteVCard:ei(vn,{headers:o}),todoQuery:ei(Vn,{headers:o}),todoMultiGet:ei(jn,{headers:o}),fetchTodos:ei(zn,{headers:o}),createTodo:ei(Hn,{headers:o}),updateTodo:ei($n,{headers:o}),deleteTodo:ei(Kn,{headers:o})}};class oi{constructor(e){var t,r,n;this.serverUrl=e.serverUrl,this.credentials=e.credentials,this.authMethod=null!==(t=e.authMethod)&&void 0!==t?t:"Basic",this.accountType=null!==(r=e.defaultAccountType)&&void 0!==r?r:"caldav",this.authFunction=e.authFunction,this.fetchOptions=null!==(n=e.fetchOptions)&&void 0!==n?n:{}}async login(){var e;switch(this.authMethod){case"Basic":this.authHeaders=ti(this.credentials);break;case"Oauth":this.authHeaders=(await ii(this.credentials,this.fetchOptions)).headers;break;case"Digest":this.authHeaders={Authorization:`Digest ${this.credentials.digestString}`};break;case"Custom":this.authHeaders=await(null===(e=this.authFunction)||void 0===e?void 0:e.call(this,this.credentials));break;default:throw new Error("Invalid auth method")}this.account=this.accountType?await kn({account:{serverUrl:this.serverUrl,credentials:this.credentials,accountType:this.accountType},headers:this.authHeaders,fetchOptions:this.fetchOptions}):void 0}async davRequest(e){const{init:t,...r}=e,{headers:n,...i}=t;return qr({...r,init:{...i,headers:{...this.authHeaders,...n}},fetchOptions:this.fetchOptions})}async createObject(...e){return ei(Zr,{url:this.serverUrl,headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async updateObject(...e){return ei(Jr,{url:this.serverUrl,headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async deleteObject(...e){return ei(Qr,{url:this.serverUrl,headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async propfind(...e){return ei(Gr,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async createAccount(e){const{account:t,headers:r,loadCollections:n,loadObjects:i,fetchOptions:s}=e;return kn({account:{serverUrl:this.serverUrl,credentials:this.credentials,...t},headers:{...this.authHeaders,...r},loadCollections:n,loadObjects:i,fetchOptions:null!=s?s:this.fetchOptions})}async collectionQuery(...e){return ei(nn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async makeCollection(...e){return ei(sn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async syncCollection(...e){return ei(un,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async supportedReportSet(...e){return ei(an,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async isCollectionDirty(...e){return ei(on,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async smartCollectionSync(...e){return ei(cn,{headers:this.authHeaders,fetchOptions:this.fetchOptions,account:this.account})(e[0])}async calendarQuery(...e){return ei(Tn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async makeCalendar(...e){return ei(An,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async calendarMultiGet(...e){return ei(En,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async fetchCalendars(...e){return ei(Dn,{headers:this.authHeaders,account:this.account,fetchOptions:this.fetchOptions})(null==e?void 0:e[0])}async fetchCalendarUserAddresses(...e){return ei(wn,{headers:this.authHeaders,account:this.account,fetchOptions:this.fetchOptions})(null==e?void 0:e[0])}async fetchCalendarObjects(...e){return ei(On,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async createCalendarObject(...e){return ei(Cn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async updateCalendarObject(...e){return ei(Sn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async deleteCalendarObject(...e){return ei(xn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async syncCalendars(...e){return ei(Nn,{headers:this.authHeaders,account:this.account,fetchOptions:this.fetchOptions})(e[0])}async addressBookQuery(...e){return ei(dn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async addressBookMultiGet(...e){return ei(fn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async fetchAddressBooks(...e){return ei(pn,{headers:this.authHeaders,account:this.account,fetchOptions:this.fetchOptions})(null==e?void 0:e[0])}async fetchVCards(...e){return ei(mn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async createVCard(...e){return ei(yn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async updateVCard(...e){return ei(gn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async deleteVCard(...e){return ei(vn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async todoQuery(...e){return ei(Vn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async todoMultiGet(...e){return ei(jn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async fetchTodos(...e){return ei(zn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async createTodo(...e){return ei(Hn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async updateTodo(...e){return ei($n,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async deleteTodo(...e){return ei(Kn,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}}var ui=Object.freeze({__proto__:null,DAVClient:oi,createDAVClient:ai});class ci{static fromString(e){return new ci(e)}constructor(e){this.value=e}icaltype="binary";decodeValue(){return this._b64_decode(this.value)}setEncodedValue(e){this.value=this._b64_encode(e)}_b64_encode(e){let t,r,n,i,s,a,o,u,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,h=0,d="",f=[];if(!e)return e;do{t=e.charCodeAt(l++),r=e.charCodeAt(l++),n=e.charCodeAt(l++),u=t<<16|r<<8|n,i=u>>18&63,s=u>>12&63,a=u>>6&63,o=63&u,f[h++]=c.charAt(i)+c.charAt(s)+c.charAt(a)+c.charAt(o)}while(l<e.length);d=f.join("");let p=e.length%3;return(p?d.slice(0,p-3):d)+"===".slice(p||3)}_b64_decode(e){let t,r,n,i,s,a,o,u,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,h=0,d="",f=[];if(!e)return e;e+="";do{i=c.indexOf(e.charAt(l++)),s=c.indexOf(e.charAt(l++)),a=c.indexOf(e.charAt(l++)),o=c.indexOf(e.charAt(l++)),u=i<<18|s<<12|a<<6|o,t=u>>16&255,r=u>>8&255,n=255&u,f[h++]=64==a?String.fromCharCode(t):64==o?String.fromCharCode(t,r):String.fromCharCode(t,r,n)}while(l<e.length);return d=f.join(""),d}toString(){return this.value}}const li=/([PDWHMTS]{1,1})/,hi=["weeks","days","hours","minutes","seconds","isNegative"];class di{static fromSeconds(e){return(new di).fromSeconds(e)}static isValueString(e){return"P"===e[0]||"P"===e[1]}static fromString(e){let t=0,r=Object.create(null),n=0;for(;-1!==(t=e.search(li));){let i=e[t],s=e.slice(0,Math.max(0,t));e=e.slice(t+1),n+=fi(i,s,r)}if(n<2)throw new Error('invalid duration value: Not enough duration components in "'+e+'"');return new di(r)}static fromData(e){return new di(e)}constructor(e){this.wrappedJSObject=this,this.fromData(e)}weeks=0;days=0;hours=0;minutes=0;seconds=0;isNegative=!1;icalclass="icalduration";icaltype="duration";clone(){return di.fromData(this)}toSeconds(){let e=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+604800*this.weeks;return this.isNegative?-e:e}fromSeconds(e){let t=Math.abs(e);return this.isNegative=e<0,this.days=Ri(t/86400),this.days%7==0?(this.weeks=this.days/7,this.days=0):this.weeks=0,t-=86400*(this.days+7*this.weeks),this.hours=Ri(t/3600),t-=3600*this.hours,this.minutes=Ri(t/60),t-=60*this.minutes,this.seconds=t,this}fromData(e){for(let t of hi)this[t]=e&&t in e?e[t]:0}reset(){this.isNegative=!1,this.weeks=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0}compare(e){let t=this.toSeconds(),r=e.toSeconds();return(t>r)-(t<r)}normalize(){this.fromSeconds(this.toSeconds())}toString(){if(0==this.toSeconds())return"PT0S";{let e="";this.isNegative&&(e+="-"),e+="P";let t=!1;return this.weeks?this.days||this.hours||this.minutes||this.seconds?e+=7*this.weeks+this.days+"D":(e+=this.weeks+"W",t=!0):this.days&&(e+=this.days+"D"),t||(this.hours||this.minutes||this.seconds)&&(e+="T",this.hours&&(e+=this.hours+"H"),this.minutes&&(e+=this.minutes+"M"),this.seconds&&(e+=this.seconds+"S")),e}}toICALString(){return this.toString()}}function fi(e,t,r){let n;switch(e){case"P":r.isNegative=!(!t||"-"!==t);break;case"D":n="days";break;case"W":n="weeks";break;case"H":n="hours";break;case"M":n="minutes";break;case"S":n="seconds";break;default:return 0}if(n){if(!t&&0!==t)throw new Error('invalid duration value: Missing number before "'+e+'"');let i=parseInt(t,10);if(Di(i))throw new Error('invalid duration value: Invalid number "'+t+'" before "'+e+'"');r[n]=i}return 1}class pi{static fromString(e,t){let r=e.split("/");if(2!==r.length)throw new Error('Invalid string value: "'+e+'" must contain a "/" char.');let n={start:mi.fromDateTimeString(r[0],t)},i=r[1];return di.isValueString(i)?n.duration=di.fromString(i):n.end=mi.fromDateTimeString(i,t),new pi(n)}static fromData(e){return new pi(e)}static fromJSON(e,t,r){function n(e,t){return r?mi.fromString(e,t):mi.fromDateTimeString(e,t)}return di.isValueString(e[1])?pi.fromData({start:n(e[0],t),duration:di.fromString(e[1])}):pi.fromData({start:n(e[0],t),end:n(e[1],t)})}constructor(e){if(this.wrappedJSObject=this,e&&"start"in e){if(e.start&&!(e.start instanceof mi))throw new TypeError(".start must be an instance of ICAL.Time");this.start=e.start}if(e&&e.end&&e.duration)throw new Error("cannot accept both end and duration");if(e&&"end"in e){if(e.end&&!(e.end instanceof mi))throw new TypeError(".end must be an instance of ICAL.Time");this.end=e.end}if(e&&"duration"in e){if(e.duration&&!(e.duration instanceof di))throw new TypeError(".duration must be an instance of ICAL.Duration");this.duration=e.duration}}start=null;end=null;duration=null;icalclass="icalperiod";icaltype="period";clone(){return pi.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})}getDuration(){return this.duration?this.duration:this.end.subtractDate(this.start)}getEnd(){if(this.end)return this.end;{let e=this.start.clone();return e.addDuration(this.duration),e}}compare(e){return e.compare(this.start)<0?1:e.compare(this.getEnd())>0?-1:0}toString(){return this.start+"/"+(this.end||this.duration)}toJSON(){return[this.start.toString(),(this.end||this.duration).toString()]}toICALString(){return this.start.toICALString()+"/"+(this.end||this.duration).toICALString()}}class mi{static _dowCache={};static _wnCache={};static daysInMonth(e,t){let r=30;return e<1||e>12||(r=[0,31,28,31,30,31,30,31,31,30,31,30,31][e],2==e&&(r+=mi.isLeapYear(t))),r}static isLeapYear(e){return e<=1752?e%4==0:e%4==0&&e%100!=0||e%400==0}static fromDayOfYear(e,t){let r=t,n=e,i=new mi;i.auto_normalize=!1;let s=mi.isLeapYear(r)?1:0;if(n<1)return r--,s=mi.isLeapYear(r)?1:0,n+=mi.daysInYearPassedMonth[s][12],mi.fromDayOfYear(n,r);if(n>mi.daysInYearPassedMonth[s][12])return s=mi.isLeapYear(r)?1:0,n-=mi.daysInYearPassedMonth[s][12],r++,mi.fromDayOfYear(n,r);i.year=r,i.isDate=!0;for(let e=11;e>=0;e--)if(n>mi.daysInYearPassedMonth[s][e]){i.month=e+1,i.day=n-mi.daysInYearPassedMonth[s][e];break}return i.auto_normalize=!0,i}static fromStringv2(e){return new mi({year:parseInt(e.slice(0,4),10),month:parseInt(e.slice(5,7),10),day:parseInt(e.slice(8,10),10),isDate:!0})}static fromDateString(e){return new mi({year:Oi(e.slice(0,4)),month:Oi(e.slice(5,7)),day:Oi(e.slice(8,10)),isDate:!0})}static fromDateTimeString(e,t){if(e.length<19)throw new Error('invalid date-time value: "'+e+'"');let r,n;"Z"===e.slice(-1)?r=Ti.utcTimezone:t&&(n=t.getParameter("tzid"),t.parent&&("standard"===t.parent.name||"daylight"===t.parent.name?r=Ti.localTimezone:n&&(r=t.parent.getTimeZoneByID(n))));const i={year:Oi(e.slice(0,4)),month:Oi(e.slice(5,7)),day:Oi(e.slice(8,10)),hour:Oi(e.slice(11,13)),minute:Oi(e.slice(14,16)),second:Oi(e.slice(17,19))};return n&&!r&&(i.timezone=n),new mi(i,r)}static fromString(e,t){return e.length>10?mi.fromDateTimeString(e,t):mi.fromDateString(e)}static fromJSDate(e,t){return(new mi).fromJSDate(e,t)}static fromData=function(e,t){return(new mi).fromData(e,t)};static now(){return mi.fromJSDate(new Date,!1)}static weekOneStarts(e,t){let r=mi.fromData({year:e,month:1,day:1,isDate:!0}),n=r.dayOfWeek(),i=t||mi.DEFAULT_WEEK_START;return n>mi.THURSDAY&&(r.day+=7),i>mi.THURSDAY&&(r.day-=7),r.day-=n-i,r}static getDominicalLetter(e){let t="GFEDCBA",r=(e+(e/4|0)+(e/400|0)-(e/100|0)-1)%7;return mi.isLeapYear(e)?t[(r+6)%7]+t[r]:t[r]}static#e=null;static get epochTime(){return this.#e||(this.#e=mi.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:"Z"})),this.#e}static _cmp_attr(e,t,r){return e[r]>t[r]?1:e[r]<t[r]?-1:0}static daysInYearPassedMonth=[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]];static SUNDAY=1;static MONDAY=2;static TUESDAY=3;static WEDNESDAY=4;static THURSDAY=5;static FRIDAY=6;static SATURDAY=7;static DEFAULT_WEEK_START=2;constructor(e,t){this.wrappedJSObject=this,this._time=Object.create(null),this._time.year=0,this._time.month=1,this._time.day=1,this._time.hour=0,this._time.minute=0,this._time.second=0,this._time.isDate=!1,this.fromData(e,t)}icalclass="icaltime";_cachedUnixTime=null;get icaltype(){return this.isDate?"date":"date-time"}zone=null;_pendingNormalization=!1;get year(){return this._getTimeAttr("year")}set year(e){this._setTimeAttr("year",e)}get month(){return this._getTimeAttr("month")}set month(e){this._setTimeAttr("month",e)}get day(){return this._getTimeAttr("day")}set day(e){this._setTimeAttr("day",e)}get hour(){return this._getTimeAttr("hour")}set hour(e){this._setTimeAttr("hour",e)}get minute(){return this._getTimeAttr("minute")}set minute(e){this._setTimeAttr("minute",e)}get second(){return this._getTimeAttr("second")}set second(e){this._setTimeAttr("second",e)}get isDate(){return this._getTimeAttr("isDate")}set isDate(e){this._setTimeAttr("isDate",e)}_getTimeAttr(e){return this._pendingNormalization&&(this._normalize(),this._pendingNormalization=!1),this._time[e]}_setTimeAttr(e,t){"isDate"===e&&t&&!this._time.isDate&&this.adjust(0,0,0,0),this._cachedUnixTime=null,this._pendingNormalization=!0,this._time[e]=t}clone(){return new mi(this._time,this.zone)}reset(){this.fromData(mi.epochTime),this.zone=Ti.utcTimezone}resetTo(e,t,r,n,i,s,a){this.fromData({year:e,month:t,day:r,hour:n,minute:i,second:s,zone:a})}fromJSDate(e,t){return e?t?(this.zone=Ti.utcTimezone,this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()):(this.zone=Ti.localTimezone,this.year=e.getFullYear(),this.month=e.getMonth()+1,this.day=e.getDate(),this.hour=e.getHours(),this.minute=e.getMinutes(),this.second=e.getSeconds()):this.reset(),this._cachedUnixTime=null,this}fromData(e,t){if(e)for(let[t,r]of Object.entries(e))"icaltype"!==t&&(this[t]=r);if(t&&(this.zone=t),e&&!("isDate"in e)?this.isDate=!("hour"in e):e&&"isDate"in e&&(this.isDate=e.isDate),e&&"timezone"in e){let t=Ai.get(e.timezone);this.zone=t||Ti.localTimezone}return e&&"zone"in e&&(this.zone=e.zone),this.zone||(this.zone=Ti.localTimezone),this._cachedUnixTime=null,this}dayOfWeek(e){let t=e||mi.SUNDAY,r=(this.year<<12)+(this.month<<8)+(this.day<<3)+t;if(r in mi._dowCache)return mi._dowCache[r];let n=this.day,i=this.month+(this.month<3?12:0),s=this.year-(this.month<3?1:0),a=n+s+Ri(26*(i+1)/10)+Ri(s/4);return a+=6*Ri(s/100)+Ri(s/400),a=(a+7-t)%7+1,mi._dowCache[r]=a,a}dayOfYear(){let e=mi.isLeapYear(this.year)?1:0;return mi.daysInYearPassedMonth[e][this.month-1]+this.day}startOfWeek(e){let t=e||mi.SUNDAY,r=this.clone();return r.day-=(this.dayOfWeek()+7-t)%7,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r}endOfWeek(e){let t=e||mi.SUNDAY,r=this.clone();return r.day+=(7-this.dayOfWeek()+t-mi.SUNDAY)%7,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r}startOfMonth(){let e=this.clone();return e.day=1,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}endOfMonth(){let e=this.clone();return e.day=mi.daysInMonth(e.month,e.year),e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}startOfYear(){let e=this.clone();return e.day=1,e.month=1,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}endOfYear(){let e=this.clone();return e.day=31,e.month=12,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}startDoyWeek(e){let t=e||mi.SUNDAY,r=this.dayOfWeek()-t;return r<0&&(r+=7),this.dayOfYear()-r}getDominicalLetter(){return mi.getDominicalLetter(this.year)}nthWeekDay(e,t){let r,n=mi.daysInMonth(this.month,this.year),i=t,s=0,a=this.clone();if(i>=0){a.day=1,0!=i&&i--,s=a.day;let t=e-a.dayOfWeek();t<0&&(t+=7),s+=t,s-=e,r=e}else{a.day=n,i++,r=a.dayOfWeek()-e,r<0&&(r+=7),r=n-r}return r+=7*i,s+r}isNthWeekDay(e,t){let r=this.dayOfWeek();return 0===t&&r===e||this.nthWeekDay(e,t)===this.day}weekNumber(e){let t,r=(this.year<<12)+(this.month<<8)+(this.day<<3)+e;if(r in mi._wnCache)return mi._wnCache[r];let n=this.clone();n.isDate=!0;let i=this.year;12==n.month&&n.day>25?(t=mi.weekOneStarts(i+1,e),n.compare(t)<0?t=mi.weekOneStarts(i,e):i++):(t=mi.weekOneStarts(i,e),n.compare(t)<0&&(t=mi.weekOneStarts(--i,e)));let s=Ri(n.subtractDate(t).toSeconds()/86400/7)+1;return mi._wnCache[r]=s,s}addDuration(e){let t=e.isNegative?-1:1,r=this.second,n=this.minute,i=this.hour,s=this.day;r+=t*e.seconds,n+=t*e.minutes,i+=t*e.hours,s+=t*e.days,s+=7*t*e.weeks,this.second=r,this.minute=n,this.hour=i,this.day=s,this._cachedUnixTime=null}subtractDate(e){let t=this.toUnixTime()+this.utcOffset(),r=e.toUnixTime()+e.utcOffset();return di.fromSeconds(t-r)}subtractDateTz(e){let t=this.toUnixTime(),r=e.toUnixTime();return di.fromSeconds(t-r)}compare(e){if(e instanceof pi)return-1*e.compare(this);{let t=this.toUnixTime(),r=e.toUnixTime();return t>r?1:r>t?-1:0}}compareDateOnlyTz(e,t){let r=this.convertToZone(t),n=e.convertToZone(t),i=0;return 0!=(i=mi._cmp_attr(r,n,"year"))||0!=(i=mi._cmp_attr(r,n,"month"))||(i=mi._cmp_attr(r,n,"day")),i}convertToZone(e){let t=this.clone(),r=this.zone.tzid==e.tzid;return this.isDate||r||Ti.convert_time(t,this.zone,e),t.zone=e,t}utcOffset(){return this.zone==Ti.localTimezone||this.zone==Ti.utcTimezone?0:this.zone.utcOffset(this)}toICALString(){let e=this.toString();return e.length>10?_s.icalendar.value["date-time"].toICAL(e):_s.icalendar.value.date.toICAL(e)}toString(){let e=this.year+"-"+Yi(this.month)+"-"+Yi(this.day);return this.isDate||(e+="T"+Yi(this.hour)+":"+Yi(this.minute)+":"+Yi(this.second),this.zone===Ti.utcTimezone&&(e+="Z")),e}toJSDate(){return this.zone==Ti.localTimezone?this.isDate?new Date(this.year,this.month-1,this.day):new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0):new Date(1e3*this.toUnixTime())}_normalize(){return this._time.isDate&&(this._time.hour=0,this._time.minute=0,this._time.second=0),this.adjust(0,0,0,0),this}adjust(e,t,r,n,i){let s,a,o,u,c,l,h,d=0,f=0,p=i||this._time;if(p.isDate||(o=p.second+n,p.second=o%60,s=Ri(o/60),p.second<0&&(p.second+=60,s--),u=p.minute+r+s,p.minute=u%60,a=Ri(u/60),p.minute<0&&(p.minute+=60,a--),c=p.hour+t+a,p.hour=c%24,d=Ri(c/24),p.hour<0&&(p.hour+=24,d--)),p.month>12?f=Ri((p.month-1)/12):p.month<1&&(f=Ri(p.month/12)-1),p.year+=f,p.month-=12*f,l=p.day+e+d,l>0)for(;h=mi.daysInMonth(p.month,p.year),!(l<=h);)p.month++,p.month>12&&(p.year++,p.month=1),l-=h;else for(;l<=0;)1==p.month?(p.year--,p.month=12):p.month--,l+=mi.daysInMonth(p.month,p.year);return p.day=l,this._cachedUnixTime=null,this}fromUnixTime(e){this.zone=Ti.utcTimezone;let t=new Date(1e3*e);this.year=t.getUTCFullYear(),this.month=t.getUTCMonth()+1,this.day=t.getUTCDate(),this._time.isDate?(this.hour=0,this.minute=0,this.second=0):(this.hour=t.getUTCHours(),this.minute=t.getUTCMinutes(),this.second=t.getUTCSeconds()),this._cachedUnixTime=null}toUnixTime(){if(null!==this._cachedUnixTime)return this._cachedUnixTime;let e=this.utcOffset(),t=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-e);return this._cachedUnixTime=t/1e3,this._cachedUnixTime}toJSON(){let e,t=["year","month","day","hour","minute","second","isDate"],r=Object.create(null),n=0,i=t.length;for(;n<i;n++)e=t[n],r[e]=this[e];return this.zone&&(r.timezone=this.zone.tzid),r}}const yi=/[^ \t]/,gi=":",vi={"^'":'"',"^n":"\n","^^":"^"};function bi(e){let t={},r=t.component=[];if(t.stack=[r],bi._eachLine(e,(function(e,r){bi._handleContentLine(r,t)})),t.stack.length>1)throw new _i("invalid ical body. component began but did not end");return t=null,1==r.length?r[0]:r}bi.property=function(e,t){let r={component:[[],[]],designSet:t||_s.defaultSet};return bi._handleContentLine(e,r),r.component[1][0]},bi.component=function(e){return bi(e)};class _i extends Error{name=this.constructor.name}bi.ParserError=_i,bi._handleContentLine=function(e,t){let r,n,i,s,a,o,u=e.indexOf(gi),c=e.indexOf(";"),l={};if(-1!==c&&-1!==u&&c>u&&(c=-1),-1!==c){if(i=e.slice(0,Math.max(0,c)).toLowerCase(),a=bi._parseParameters(e.slice(Math.max(0,c)),0,t.designSet),-1==a[2])throw new _i("Invalid parameters in '"+e+"'");let o;if(l=a[0],o="string"==typeof a[1]?a[1].length:a[1].reduce(((e,t)=>e+t.length),0),r=o+a[2]+c,-1===(n=e.slice(Math.max(0,r)).indexOf(gi)))throw new _i("Missing parameter value in '"+e+"'");s=e.slice(Math.max(0,r+n+1))}else{if(-1===u)throw new _i('invalid line (no token ";" or ":") "'+e+'"');if(i=e.slice(0,Math.max(0,u)).toLowerCase(),s=e.slice(Math.max(0,u+1)),"begin"===i){let e=[s.toLowerCase(),[],[]];return 1===t.stack.length?t.component.push(e):t.component[2].push(e),t.stack.push(t.component),t.component=e,void(t.designSet||(t.designSet=_s.getDesignSet(t.component[0])))}if("end"===i)return void(t.component=t.stack.pop())}let h,d,f,p,m=!1,y=!1;t.designSet.propertyGroups&&-1!==i.indexOf(".")?(d=i.split("."),l.group=d[0],f=d[1]):f=i,f in t.designSet.property&&(h=t.designSet.property[f],"multiValue"in h&&(m=h.multiValue),"structuredValue"in h&&(y=h.structuredValue),s&&"detectType"in h&&(o=h.detectType(s))),o||(o="value"in l?l.value.toLowerCase():h?h.defaultType:"unknown"),delete l.value,m&&y?(s=bi._parseMultiValue(s,y,o,[],m,t.designSet,y),p=[f,l,o,s]):m?(p=[f,l,o],bi._parseMultiValue(s,m,o,p,null,t.designSet,!1)):y?(s=bi._parseMultiValue(s,y,o,[],null,t.designSet,y),p=[f,l,o,s]):(s=bi._parseValue(s,o,t.designSet,!1),p=[f,l,o,s]),"vcard"!==t.component[0]||0!==t.component[1].length||"version"===i&&"4.0"===s||(t.designSet=_s.getDesignSet("vcard3")),t.component[1].push(p)},bi._parseValue=function(e,t,r,n){return t in r.value&&"fromICAL"in r.value[t]?r.value[t].fromICAL(e,n):e},bi._parseParameters=function(e,t,r){let n,i,s,a,o,u,c=t,l=0,h={},d=-1;for(;!1!==l&&-1!==(l=e.indexOf("=",l+1));){if(n=e.slice(c+1,l),0==n.length)throw new _i("Empty parameter name in '"+e+"'");if(i=n.toLowerCase(),u=!1,o=!1,a=i in r.param&&r.param[i].valueType?r.param[i].valueType:"text",i in r.param&&(o=r.param[i].multiValue,r.param[i].multiValueSeparateDQuote&&(u=bi._rfc6868Escape('"'+o+'"'))),'"'===e[l+1]){if(d=l+2,l=e.indexOf('"',d),o&&-1!=l){let t=!0;for(;t;)e[l+1]==o&&'"'==e[l+2]?l=e.indexOf('"',l+3):t=!1}if(-1===l)throw new _i('invalid line (no matching double quote) "'+e+'"');s=e.slice(d,l),c=e.indexOf(";",l);let t=e.indexOf(gi,l);(-1===c||-1!==t&&c>t)&&(l=!1)}else{d=l+1;let t=e.indexOf(";",d),r=e.indexOf(gi,d);-1!==r&&t>r?(t=r,l=!1):-1===t?(t=-1===r?e.length:r,l=!1):(c=t,l=t),s=e.slice(d,t)}const t=s.length;if(s=bi._rfc6868Escape(s),d+=t-s.length,o){let e=u||o;s=bi._parseMultiValue(s,e,a,[],null,r)}else s=bi._parseValue(s,a,r);o&&i in h?Array.isArray(h[i])?h[i].push(s):h[i]=[h[i],s]:h[i]=s}return[h,s,d]},bi._rfc6868Escape=function(e){return e.replace(/\^['n^]/g,(function(e){return vi[e]}))},bi._parseMultiValue=function(e,t,r,n,i,s,a){let o,u=0,c=0;if(0===t.length)return e;for(;-1!==(u=Si(e,t,c));)o=e.slice(c,u),o=i?bi._parseMultiValue(o,i,r,[],null,s,a):bi._parseValue(o,r,s,a),n.push(o),c=u+t.length;return o=e.slice(c),o=i?bi._parseMultiValue(o,i,r,[],null,s,a):bi._parseValue(o,r,s,a),n.push(o),1==n.length?n[0]:n},bi._eachLine=function(e,t){let r,n,i,s=e.length,a=e.search(yi),o=a;do{o=e.indexOf("\n",a)+1,i=o>1&&"\r"===e[o-2]?2:1,0===o&&(o=s,i=0),n=e[a]," "===n||"\t"===n?r+=e.slice(a+1,o-i):(r&&t(null,r),r=e.slice(a,o-i)),a=o}while(o!==s);r=r.trim(),r.length&&t(null,r)};const wi=["tzid","location","tznames","latitude","longitude"];class Ti{static _compare_change_fn(e,t){return e.year<t.year?-1:e.year>t.year?1:e.month<t.month?-1:e.month>t.month?1:e.day<t.day?-1:e.day>t.day?1:e.hour<t.hour?-1:e.hour>t.hour?1:e.minute<t.minute?-1:e.minute>t.minute?1:e.second<t.second?-1:e.second>t.second?1:0}static convert_time(e,t,r){if(e.isDate||t.tzid==r.tzid||t==Ti.localTimezone||r==Ti.localTimezone)return e.zone=r,e;let n=t.utcOffset(e);return e.adjust(0,0,0,-n),n=r.utcOffset(e),e.adjust(0,0,0,n),null}static fromData(e){return(new Ti).fromData(e)}static#t=null;static get utcTimezone(){return this.#t||(this.#t=Ti.fromData({tzid:"UTC"})),this.#t}static#r=null;static get localTimezone(){return this.#r||(this.#r=Ti.fromData({tzid:"floating"})),this.#r}static adjust_change(e,t,r,n,i){return mi.prototype.adjust.call(e,t,r,n,i,e)}static _minimumExpansionYear=-1;static EXTRA_COVERAGE=5;constructor(e){this.wrappedJSObject=this,this.fromData(e)}tzid="";location="";tznames="";latitude=0;longitude=0;component=null;expandedUntilYear=0;icalclass="icaltimezone";fromData(e){if(this.expandedUntilYear=0,this.changes=[],e instanceof Os)this.component=e;else{if(e&&"component"in e)if("string"==typeof e.component){let t=bi(e.component);this.component=new Os(t)}else e.component instanceof Os?this.component=e.component:this.component=null;for(let t of wi)e&&t in e&&(this[t]=e[t])}return this.component instanceof Os&&!this.tzid&&(this.tzid=this.component.getFirstPropertyValue("tzid")),this}utcOffset(e){if(this==Ti.utcTimezone||this==Ti.localTimezone)return 0;if(this._ensureCoverage(e.year),!this.changes.length)return 0;let t={year:e.year,month:e.month,day:e.day,hour:e.hour,minute:e.minute,second:e.second},r=this._findNearbyChange(t),n=-1,i=1;for(;;){let e=Ni(this.changes[r],!0);if(e.utcOffset<e.prevUtcOffset?Ti.adjust_change(e,0,0,0,e.utcOffset):Ti.adjust_change(e,0,0,0,e.prevUtcOffset),Ti._compare_change_fn(t,e)>=0?n=r:i=-1,-1==i&&-1!=n)break;if(r+=i,r<0)return 0;if(r>=this.changes.length)break}let s=this.changes[n];if(s.utcOffset-s.prevUtcOffset<0&&n>0){let e=Ni(s,!0);if(Ti.adjust_change(e,0,0,0,e.prevUtcOffset),Ti._compare_change_fn(t,e)<0){let e=this.changes[n-1],t=!1;s.is_daylight!=t&&e.is_daylight==t&&(s=e)}}return s.utcOffset}_findNearbyChange(e){let t=xi(this.changes,e,Ti._compare_change_fn);return t>=this.changes.length?this.changes.length-1:t}_ensureCoverage(e){if(-1==Ti._minimumExpansionYear){let e=mi.now();Ti._minimumExpansionYear=e.year}let t=e;if(t<Ti._minimumExpansionYear&&(t=Ti._minimumExpansionYear),t+=Ti.EXTRA_COVERAGE,!this.changes.length||this.expandedUntilYear<e){let e=this.component.getAllSubcomponents(),r=e.length,n=0;for(;n<r;n++)this._expandComponent(e[n],t,this.changes);this.changes.sort(Ti._compare_change_fn),this.expandedUntilYear=t}}_expandComponent(e,t,r){if(!e.hasProperty("dtstart")||!e.hasProperty("tzoffsetto")||!e.hasProperty("tzoffsetfrom"))return null;let n,i=e.getFirstProperty("dtstart").getFirstValue();function s(e){return e.factor*(3600*e.hours+60*e.minutes)}function a(){let t={};return t.is_daylight="daylight"==e.name,t.utcOffset=s(e.getFirstProperty("tzoffsetto").getFirstValue()),t.prevUtcOffset=s(e.getFirstProperty("tzoffsetfrom").getFirstValue()),t}if(e.hasProperty("rrule")||e.hasProperty("rdate")){let s=e.getAllProperties("rdate");for(let e of s){let t=e.getFirstValue();n=a(),n.year=t.year,n.month=t.month,n.day=t.day,t.isDate?(n.hour=i.hour,n.minute=i.minute,n.second=i.second,i.zone!=Ti.utcTimezone&&Ti.adjust_change(n,0,0,0,-n.prevUtcOffset)):(n.hour=t.hour,n.minute=t.minute,n.second=t.second,t.zone!=Ti.utcTimezone&&Ti.adjust_change(n,0,0,0,-n.prevUtcOffset)),r.push(n)}let o=e.getFirstProperty("rrule");if(o){o=o.getFirstValue(),n=a(),o.until&&o.until.zone==Ti.utcTimezone&&(o.until.adjust(0,0,0,n.prevUtcOffset),o.until.zone=Ti.localTimezone);let e,s=o.iterator(i);for(;(e=s.next())&&(n=a(),!(e.year>t)&&e);)n.year=e.year,n.month=e.month,n.day=e.day,n.hour=e.hour,n.minute=e.minute,n.second=e.second,n.isDate=e.isDate,Ti.adjust_change(n,0,0,0,-n.prevUtcOffset),r.push(n)}}else n=a(),n.year=i.year,n.month=i.month,n.day=i.day,n.hour=i.hour,n.minute=i.minute,n.second=i.second,Ti.adjust_change(n,0,0,0,-n.prevUtcOffset),r.push(n);return r}toString(){return this.tznames?this.tznames:this.tzid}}let Ei=null;const Ai={get count(){return null===Ei?0:Object.keys(Ei).length},reset:function(){Ei=Object.create(null);let e=Ti.utcTimezone;Ei.Z=e,Ei.UTC=e,Ei.GMT=e},_hard_reset:function(){Ei=null},has:function(e){return null!==Ei&&!!Ei[e]},get:function(e){return null===Ei&&this.reset(),Ei[e]},register:function(e,t){if(null===Ei&&this.reset(),"string"==typeof e&&t instanceof Ti&&([e,t]=[t,e]),t||(e instanceof Ti?t=e.tzid:"vtimezone"===e.name&&(t=(e=new Ti(e)).tzid)),!t)throw new TypeError("Neither a timezone nor a name was passed");if(!(e instanceof Ti))throw new TypeError("timezone must be ICAL.Timezone or ICAL.Component");Ei[t]=e},remove:function(e){return null===Ei?null:delete Ei[e]}};function Di(e){return"number"==typeof e&&isNaN(e)}function Oi(e){let t=parseInt(e,10);if(Di(t))throw new Error('Could not extract integer from "'+e+'"');return t}function Ci(e,t){if(void 0!==e)return e instanceof t?e:new t(e)}function Si(e,t,r){for(;-1!==(r=e.indexOf(t,r));){if(!(r>0&&"\\"===e[r-1]))return r;r+=1}return-1}function xi(e,t,r){if(!e.length)return 0;let n,i,s=0,a=e.length-1;for(;s<=a;)if(n=s+Math.floor((a-s)/2),i=r(t,e[n]),i<0)a=n-1;else{if(!(i>0))break;s=n+1}return i<0?n:i>0?n+1:n}function Ni(e,t){if(e&&"object"==typeof e){if(e instanceof Date)return new Date(e.getTime());if("clone"in e)return e.clone();if(Array.isArray(e)){let r=[];for(let n=0;n<e.length;n++)r.push(t?Ni(e[n],!0):e[n]);return r}{let r={};for(let[n,i]of Object.entries(e))r[n]=t?Ni(i,!0):i;return r}}return e}function Ii(e){let t="",r=e||"",n=0,i=0;for(;r.length;){let e=r.codePointAt(n);e<128?++i:i+=e<2048?2:e<65536?3:4,i<Ns.foldLength+1?n+=e>65535?2:1:(t+=Ns.newLineChar+" "+r.slice(0,Math.max(0,n)),r=r.slice(Math.max(0,n)),n=i=0)}return t.slice(Ns.newLineChar.length+1)}function Yi(e){switch("string"!=typeof e&&("number"==typeof e&&(e=parseInt(e)),e=String(e)),e.length){case 0:return"00";case 1:return"0"+e;default:return e}}function Ri(e){return e<0?Math.ceil(e):Math.floor(e)}function Li(e,t){for(let r in e){let n=Object.getOwnPropertyDescriptor(e,r);n&&!Object.getOwnPropertyDescriptor(t,r)&&Object.defineProperty(t,r,n)}return t}var Pi=Object.freeze({__proto__:null,binsearchInsert:xi,clone:Ni,extend:Li,foldline:Ii,formatClassType:Ci,isStrictlyNaN:Di,pad2:Yi,strictParseInt:Oi,trunc:Ri,unescapedIndexOf:Si,updateTimezones:function(e){let t,r,n,i,s;if(!e||"vcalendar"!==e.name)return e;for(t=e.getAllSubcomponents(),r=[],n={},s=0;s<t.length;s++)if("vtimezone"===t[s].name){n[t[s].getFirstProperty("tzid").getFirstValue()]=t[s]}else r=r.concat(t[s].getAllProperties());for(i={},s=0;s<r.length;s++){let e=r[s].getParameter("tzid");e&&(i[e]=!0)}for(let[t,r]of Object.entries(n))i[t]||e.removeSubcomponent(r);for(let t of Object.keys(i))!n[t]&&Ai.has(t)&&e.addSubcomponent(Ai.get(t).component);return e}});class Fi{static fromString(e){let t={};return t.factor="+"===e[0]?1:-1,t.hours=Oi(e.slice(1,3)),t.minutes=Oi(e.slice(4,6)),new Fi(t)}static fromSeconds(e){let t=new Fi;return t.fromSeconds(e),t}constructor(e){this.fromData(e)}hours=0;minutes=0;factor=1;icaltype="utc-offset";clone(){return Fi.fromSeconds(this.toSeconds())}fromData(e){if(e)for(let[t,r]of Object.entries(e))this[t]=r;this._normalize()}fromSeconds(e){let t=Math.abs(e);return this.factor=e<0?-1:1,this.hours=Ri(t/3600),t-=3600*this.hours,this.minutes=Ri(t/60),this}toSeconds(){return this.factor*(60*this.minutes+3600*this.hours)}compare(e){let t=this.toSeconds(),r=e.toSeconds();return(t>r)-(r>t)}_normalize(){let e=this.toSeconds(),t=this.factor;for(;e<-43200;)e+=97200;for(;e>50400;)e-=97200;this.fromSeconds(e),0==e&&(this.factor=t)}toICALString(){return _s.icalendar.value["utc-offset"].toICAL(this.toString())}toString(){return(1==this.factor?"+":"-")+Yi(this.hours)+":"+Yi(this.minutes)}}class ki extends mi{static fromDateAndOrTimeString(e,t){function r(e,t,r){return e?Oi(e.slice(t,t+r)):null}let n=e.split("T"),i=n[0],s=n[1],a=s?_s.vcard.value.time._splitZone(s):[],o=a[0],u=a[1],c=i?i.length:0,l=u?u.length:0,h=i&&"-"==i[0]&&"-"==i[1],d=u&&"-"==u[0],f={year:h?null:r(i,0,4),month:!h||4!=c&&7!=c?7==c||10==c?r(i,5,2):null:r(i,2,2),day:5==c?r(i,3,2):7==c&&h?r(i,5,2):10==c?r(i,8,2):null,hour:d?null:r(u,0,2),minute:d&&3==l?r(u,1,2):l>4?r(u,d?1:3,2):null,second:4==l?r(u,2,2):6==l?r(u,4,2):8==l?r(u,6,2):null};return o="Z"==o?Ti.utcTimezone:o&&":"==o[3]?Fi.fromString(o):null,new ki(f,o,t)}constructor(e,t,r){super(e,t),this.icaltype=r||"date-and-or-time"}icalclass="vcardtime";icaltype="date-and-or-time";clone(){return new ki(this._time,this.zone,this.icaltype)}_normalize(){return this}utcOffset(){return this.zone instanceof Fi?this.zone.toSeconds():mi.prototype.utcOffset.apply(this,arguments)}toICALString(){return _s.vcard.value[this.icaltype].toICAL(this.toString())}toString(){let e,t=this.year,r=this.month,n=this.day,i=this.hour,s=this.minute,a=this.second,o=null!==r,u=null!==n,c=null!==i,l=null!==s,h=null!==a,d=(null!==t?Yi(t)+(o||u?"-":""):o||u?"--":"")+(o?Yi(r):"")+(u?"-"+Yi(n):""),f=(c?Yi(i):"-")+(c&&l?":":"")+(l?Yi(s):"")+(c||l?"":"-")+(l&&h?":":"")+(h?Yi(a):"");if(this.zone===Ti.utcTimezone)e="Z";else if(this.zone instanceof Fi)e=this.zone.toString();else if(this.zone===Ti.localTimezone)e="";else if(this.zone instanceof Ti){e=Fi.fromSeconds(this.zone.utcOffset(this)).toString()}else e="";switch(this.icaltype){case"time":return f+e;case"date-and-or-time":case"date-time":return d+("--"==f?"":"T"+f+e);case"date":return d}return null}}class Ui{static _indexMap={BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8};static _expandMap={SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]};static UNKNOWN=0;static CONTRACT=1;static EXPAND=2;static ILLEGAL=3;constructor(e){this.fromData(e)}completed=!1;rule=null;dtstart=null;last=null;occurrence_number=0;by_indices=null;initialized=!1;by_data=null;days=null;days_index=0;fromData(e){if(this.rule=Ci(e.rule,$i),!this.rule)throw new Error("iterator requires a (ICAL.Recur) rule");if(this.dtstart=Ci(e.dtstart,mi),!this.dtstart)throw new Error("iterator requires a (ICAL.Time) dtstart");if(e.by_data?this.by_data=e.by_data:this.by_data=Ni(this.rule.parts,!0),e.occurrence_number&&(this.occurrence_number=e.occurrence_number),this.days=e.days||[],e.last&&(this.last=Ci(e.last,mi)),this.by_indices=e.by_indices,this.by_indices||(this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}),this.initialized=e.initialized||!1,!this.initialized)try{this.init()}catch(e){if(!(e instanceof Bi))throw e;this.completed=!0}}init(){this.initialized=!0,this.last=this.dtstart.clone();let e=this.by_data;if("BYDAY"in e&&this.sort_byday_rules(e.BYDAY),"BYYEARDAY"in e&&("BYMONTH"in e||"BYWEEKNO"in e||"BYMONTHDAY"in e))throw new Error("Invalid BYYEARDAY rule");if("BYWEEKNO"in e&&"BYMONTHDAY"in e)throw new Error("BYWEEKNO does not fit to BYMONTHDAY");if("MONTHLY"==this.rule.freq&&("BYYEARDAY"in e||"BYWEEKNO"in e))throw new Error("For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear");if("WEEKLY"==this.rule.freq&&("BYYEARDAY"in e||"BYMONTHDAY"in e))throw new Error("For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear");if("YEARLY"!=this.rule.freq&&"BYYEARDAY"in e)throw new Error("BYYEARDAY may only appear in YEARLY rules");if(this.last.second=this.setup_defaults("BYSECOND","SECONDLY",this.dtstart.second),this.last.minute=this.setup_defaults("BYMINUTE","MINUTELY",this.dtstart.minute),this.last.hour=this.setup_defaults("BYHOUR","HOURLY",this.dtstart.hour),this.last.day=this.setup_defaults("BYMONTHDAY","DAILY",this.dtstart.day),this.last.month=this.setup_defaults("BYMONTH","MONTHLY",this.dtstart.month),"WEEKLY"==this.rule.freq)if("BYDAY"in e){let[,t]=this.ruleDayOfWeek(e.BYDAY[0],this.rule.wkst),r=t-this.last.dayOfWeek(this.rule.wkst);(this.last.dayOfWeek(this.rule.wkst)<t&&r>=0||r<0)&&(this.last.day+=r)}else{let t=$i.numericDayToIcalDay(this.dtstart.dayOfWeek());e.BYDAY=[t]}if("YEARLY"==this.rule.freq){const e=this.rule.until?this.rule.until.year:2e4;for(;this.last.year<=e&&(this.expand_year_days(this.last.year),!(this.days.length>0));)this.increment_year(this.rule.interval);if(0==this.days.length)throw new Bi;if(!(this._nextByYearDay()||this.next_year()||this.next_year()||this.next_year()))throw new Bi}if("MONTHLY"==this.rule.freq)if(this.has_by_data("BYDAY")){let e=null,t=this.last.clone(),r=mi.daysInMonth(this.last.month,this.last.year);for(let n of this.by_data.BYDAY){this.last=t.clone();let[i,s]=this.ruleDayOfWeek(n),a=this.last.nthWeekDay(s,i);if(i>=6||i<=-6)throw new Error("Malformed values in BYDAY part");if(a>r||a<=0){if(e&&e.month==t.month)continue;for(;a>r||a<=0;)this.increment_month(),r=mi.daysInMonth(this.last.month,this.last.year),a=this.last.nthWeekDay(s,i)}this.last.day=a,(!e||this.last.compare(e)<0)&&(e=this.last.clone())}if(this.last=e.clone(),this.has_by_data("BYMONTHDAY")&&this._byDayAndMonthDay(!0),this.last.day>r||0==this.last.day)throw new Error("Malformed values in BYDAY part")}else if(this.has_by_data("BYMONTHDAY")){this.last.day=1;let e=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY).filter((e=>e>=this.last.day));if(e.length)this.last.day=e[0],this.by_data.BYMONTHDAY=e;else if(!this.next_month()&&!this.next_month()&&!this.next_month())throw new Bi}}next(e=!1){let t,r=this.last?this.last.clone():null;if((this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&this.last.compare(this.rule.until)>0)&&(this.completed=!0),this.completed)return null;if(0==this.occurrence_number&&this.last.compare(this.dtstart)>=0)return this.occurrence_number++,this.last;let n=0;do{switch(t=1,this.rule.freq){case"SECONDLY":this.next_second();break;case"MINUTELY":this.next_minute();break;case"HOURLY":this.next_hour();break;case"DAILY":this.next_day();break;case"WEEKLY":this.next_week();break;case"MONTHLY":if(t=this.next_month(),t)n=0;else if(336==++n)return this.completed=!0,null;break;case"YEARLY":if(t=this.next_year(),t)n=0;else if(28==++n)return this.completed=!0,null;break;default:return null}}while(!this.check_contracting_rules()||this.last.compare(this.dtstart)<0||!t);if(0==this.last.compare(r)){if(e)throw new Error("Same occurrence found twice, protecting you from death by recursion");this.next(!0)}return this.rule.until&&this.last.compare(this.rule.until)>0?(this.completed=!0,null):(this.occurrence_number++,this.last)}next_second(){return this.next_generic("BYSECOND","SECONDLY","second","minute")}increment_second(e){return this.increment_generic(e,"second",60,"minute")}next_minute(){return this.next_generic("BYMINUTE","MINUTELY","minute","hour","next_second")}increment_minute(e){return this.increment_generic(e,"minute",60,"hour")}next_hour(){return this.next_generic("BYHOUR","HOURLY","hour","monthday","next_minute")}increment_hour(e){this.increment_generic(e,"hour",24,"monthday")}next_day(){let e="DAILY"==this.rule.freq;return 0==this.next_hour()||(e?this.increment_monthday(this.rule.interval):this.increment_monthday(1)),0}next_week(){let e=0;if(0==this.next_weekday_by_week())return e;if(this.has_by_data("BYWEEKNO")){this.by_indices.BYWEEKNO++,this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length&&(this.by_indices.BYWEEKNO=0,e=1),this.last.month=1,this.last.day=1;let t=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*t,e&&this.increment_year(1)}else this.increment_monthday(7*this.rule.interval);return e}normalizeByMonthDayRules(e,t,r){let n,i=mi.daysInMonth(t,e),s=[],a=0,o=r.length;for(;a<o;a++){if(n=parseInt(r[a],10),isNaN(n))throw new Error("Invalid BYMONTHDAY value");if(!(Math.abs(n)>i)){if(n<0)n=i+(n+1);else if(0===n)continue;-1===s.indexOf(n)&&s.push(n)}}return s.sort((function(e,t){return e-t}))}_byDayAndMonthDay(e){let t,r,n,i,s=this.by_data.BYDAY,a=0,o=s.length,u=0,c=this,l=this.last.day;function h(){for(i=mi.daysInMonth(c.last.month,c.last.year),t=c.normalizeByMonthDayRules(c.last.year,c.last.month,c.by_data.BYMONTHDAY),n=t.length;t[a]<=l&&(!e||t[a]!=l)&&a<n-1;)a++}function d(){l=0,c.increment_month(),a=0,h()}h(),e&&(l-=1);let f=48;for(;!u&&f;){if(f--,r=l+1,r>i){d();continue}let e=t[a++];if(e>=r){l=e;for(let e=0;e<o;e++){let t=this.ruleDayOfWeek(s[e]),r=t[0],n=t[1];if(this.last.day=l,this.last.isNthWeekDay(n,r)){u=1;break}}u||a!==n||d()}else d()}if(f<=0)throw new Error("Malformed values in BYDAY combined with BYMONTHDAY parts");return u}next_month(){let e=1;if(0==this.next_hour())return e;if(this.has_by_data("BYDAY")&&this.has_by_data("BYMONTHDAY"))e=this._byDayAndMonthDay();else if(this.has_by_data("BYDAY")){let t,r=mi.daysInMonth(this.last.month,this.last.year),n=0,i=0;if(this.has_by_data("BYSETPOS")){let e=this.last.day;for(let t=1;t<=r;t++)this.last.day=t,this.is_day_in_byday(this.last)&&(i++,t<=e&&n++);this.last.day=e}for(e=0,t=this.last.day+1;t<=r;t++)if(this.last.day=t,this.is_day_in_byday(this.last)&&(!this.has_by_data("BYSETPOS")||this.check_set_position(++n)||this.check_set_position(n-i-1))){e=1;break}t>r&&(this.last.day=1,this.increment_month(),this.is_day_in_byday(this.last)?this.has_by_data("BYSETPOS")&&!this.check_set_position(1)||(e=1):e=0)}else if(this.has_by_data("BYMONTHDAY")){if(this.by_indices.BYMONTHDAY++,this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length&&(this.by_indices.BYMONTHDAY=0,this.increment_month(),this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length))return 0;let t=mi.daysInMonth(this.last.month,this.last.year),r=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];r<0&&(r=t+r+1),r>t?(this.last.day=1,e=this.is_day_in_byday(this.last)):this.last.day=r}else{this.increment_month();let t=mi.daysInMonth(this.last.month,this.last.year);this.by_data.BYMONTHDAY[0]>t?e=0:this.last.day=this.by_data.BYMONTHDAY[0]}return e}next_weekday_by_week(){let e=0;if(0==this.next_hour())return e;if(!this.has_by_data("BYDAY"))return 1;for(;;){let t=new mi;this.by_indices.BYDAY++,this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length&&(this.by_indices.BYDAY=0,e=1);let r=this.by_data.BYDAY[this.by_indices.BYDAY],n=this.ruleDayOfWeek(r)[1];n-=this.rule.wkst,n<0&&(n+=7),t.year=this.last.year,t.month=this.last.month,t.day=this.last.day;let i=t.startDoyWeek(this.rule.wkst);if(n+i<1&&!e)continue;let s=mi.fromDayOfYear(i+n,this.last.year);return this.last.year=s.year,this.last.month=s.month,this.last.day=s.day,e}}next_year(){return 0==this.next_hour()?0:0!=this.days.length&&++this.days_index!=this.days.length||(this.days_index=0,this.increment_year(this.rule.interval),this.has_by_data("BYMONTHDAY")&&(this.by_data.BYMONTHDAY=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY)),this.expand_year_days(this.last.year),0!=this.days.length)?this._nextByYearDay():0}_nextByYearDay(){let e=this.days[this.days_index],t=this.last.year;if(366==Math.abs(e)&&!mi.isLeapYear(this.last.year))return 0;e<1&&(e+=1,t+=1);let r=mi.fromDayOfYear(e,t);return this.last.day=r.day,this.last.month=r.month,1}ruleDayOfWeek(e,t){let r=e.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(r){return[parseInt(r[1]||0,10),e=$i.icalDayToNumericDay(r[2],t)]}return[0,0]}next_generic(e,t,r,n,i){let s=e in this.by_data,a=this.rule.freq==t,o=0;if(i&&0==this[i]())return o;if(s){this.by_indices[e]++;let t=this.by_data[e];this.by_indices[e]==t.length&&(this.by_indices[e]=0,o=1),this.last[r]=t[this.by_indices[e]]}else a&&this["increment_"+r](this.rule.interval);return s&&o&&a&&this["increment_"+n](1),o}increment_monthday(e){for(let t=0;t<e;t++){let e=mi.daysInMonth(this.last.month,this.last.year);this.last.day++,this.last.day>e&&(this.last.day-=e,this.increment_month())}}increment_month(){if(this.last.day=1,this.has_by_data("BYMONTH"))this.by_indices.BYMONTH++,this.by_indices.BYMONTH==this.by_data.BYMONTH.length&&(this.by_indices.BYMONTH=0,this.increment_year(1)),this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH];else{"MONTHLY"==this.rule.freq?this.last.month+=this.rule.interval:this.last.month++,this.last.month--;let e=Ri(this.last.month/12);this.last.month%=12,this.last.month++,0!=e&&this.increment_year(e)}this.has_by_data("BYMONTHDAY")&&(this.by_data.BYMONTHDAY=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY))}increment_year(e){this.last.day=1,this.last.year+=e}increment_generic(e,t,r,n){this.last[t]+=e;let i=Ri(this.last[t]/r);this.last[t]%=r,0!=i&&this["increment_"+n](i)}has_by_data(e){return e in this.rule.parts}expand_year_days(e){let t=new mi;this.days=[];let r={},n=["BYDAY","BYWEEKNO","BYMONTHDAY","BYMONTH","BYYEARDAY"];for(let e of n)e in this.rule.parts&&(r[e]=this.rule.parts[e]);if("BYMONTH"in r&&"BYWEEKNO"in r){let n=1,i={};t.year=e,t.isDate=!0;for(let r=0;r<this.by_data.BYMONTH.length;r++){let n=this.by_data.BYMONTH[r];t.month=n,t.day=1;let s=t.weekNumber(this.rule.wkst);t.day=mi.daysInMonth(n,e);let a=t.weekNumber(this.rule.wkst);for(r=s;r<a;r++)i[r]=1}for(let e=0;e<this.by_data.BYWEEKNO.length&&n;e++){this.by_data.BYWEEKNO[e]<52?n&=i[e]:n=0}n?delete r.BYMONTH:delete r.BYWEEKNO}let i=Object.keys(r).length;if(0==i){let e=this.dtstart.clone();e.year=this.last.year,this.days.push(e.dayOfYear())}else if(1==i&&"BYMONTH"in r)for(let t of this.by_data.BYMONTH){let r=this.dtstart.clone();r.year=e,r.month=t,r.isDate=!0,this.days.push(r.dayOfYear())}else if(1==i&&"BYMONTHDAY"in r)for(let t of this.by_data.BYMONTHDAY){let r=this.dtstart.clone();if(t<0){t=t+mi.daysInMonth(r.month,e)+1}r.day=t,r.year=e,r.isDate=!0,this.days.push(r.dayOfYear())}else if(2==i&&"BYMONTHDAY"in r&&"BYMONTH"in r)for(let r of this.by_data.BYMONTH){let n=mi.daysInMonth(r,e);for(let i of this.by_data.BYMONTHDAY)i<0&&(i=i+n+1),t.day=i,t.month=r,t.year=e,t.isDate=!0,this.days.push(t.dayOfYear())}else if(1==i&&"BYWEEKNO"in r);else if(2==i&&"BYWEEKNO"in r&&"BYMONTHDAY"in r);else if(1==i&&"BYDAY"in r)this.days=this.days.concat(this.expand_by_day(e));else if(2==i&&"BYDAY"in r&&"BYMONTH"in r){for(let r of this.by_data.BYMONTH){let n=mi.daysInMonth(r,e);t.year=e,t.month=r,t.day=1,t.isDate=!0;let i=t.dayOfWeek(),s=t.dayOfYear()-1;t.day=n;let a=t.dayOfWeek();if(this.has_by_data("BYSETPOS")){let e=[];for(let r=1;r<=n;r++)t.day=r,this.is_day_in_byday(t)&&e.push(r);for(let t=0;t<e.length;t++)(this.check_set_position(t+1)||this.check_set_position(t-e.length))&&this.days.push(s+e[t])}else for(let e of this.by_data.BYDAY){let t,r=this.ruleDayOfWeek(e),o=r[0],u=r[1],c=(u+7-i)%7+1,l=n-(a+7-u)%7;if(0==o)for(let e=c;e<=n;e+=7)this.days.push(s+e);else o>0?(t=c+7*(o-1),t<=n&&this.days.push(s+t)):(t=l+7*(o+1),t>0&&this.days.push(s+t))}}this.days.sort((function(e,t){return e-t}))}else if(2==i&&"BYDAY"in r&&"BYMONTHDAY"in r){let t=this.expand_by_day(e);for(let r of t){let t=mi.fromDayOfYear(r,e);this.by_data.BYMONTHDAY.indexOf(t.day)>=0&&this.days.push(r)}}else if(3==i&&"BYDAY"in r&&"BYMONTHDAY"in r&&"BYMONTH"in r){let t=this.expand_by_day(e);for(let r of t){let t=mi.fromDayOfYear(r,e);this.by_data.BYMONTH.indexOf(t.month)>=0&&this.by_data.BYMONTHDAY.indexOf(t.day)>=0&&this.days.push(r)}}else if(2==i&&"BYDAY"in r&&"BYWEEKNO"in r){let t=this.expand_by_day(e);for(let r of t){let t=mi.fromDayOfYear(r,e).weekNumber(this.rule.wkst);this.by_data.BYWEEKNO.indexOf(t)&&this.days.push(r)}}else if(3==i&&"BYDAY"in r&&"BYWEEKNO"in r&&"BYMONTHDAY"in r);else if(1==i&&"BYYEARDAY"in r)this.days=this.days.concat(this.by_data.BYYEARDAY);else if(2==i&&"BYYEARDAY"in r&&"BYDAY"in r){let t=mi.isLeapYear(e)?366:365,r=new Set(this.expand_by_day(e));for(let e of this.by_data.BYYEARDAY)e<0&&(e+=t+1),r.has(e)&&this.days.push(e)}else this.days=[];let s=mi.isLeapYear(e)?366:365;return this.days.sort(((e,t)=>(e<0&&(e+=s+1),t<0&&(t+=s+1),e-t))),0}expand_by_day(e){let t=[],r=this.last.clone();r.year=e,r.month=1,r.day=1,r.isDate=!0;let n=r.dayOfWeek();r.month=12,r.day=31,r.isDate=!0;let i=r.dayOfWeek(),s=r.dayOfYear();for(let e of this.by_data.BYDAY){let r=this.ruleDayOfWeek(e),a=r[0],o=r[1];if(0==a){for(let e=(o+7-n)%7+1;e<=s;e+=7)t.push(e)}else if(a>0){let e;e=o>=n?o-n+1:o-n+8,t.push(e+7*(a-1))}else{let e;a=-a,e=o<=i?s-i+o:s-i+o-7,t.push(e-7*(a-1))}}return t}is_day_in_byday(e){if(this.by_data.BYDAY)for(let t of this.by_data.BYDAY){let r=this.ruleDayOfWeek(t),n=r[0],i=r[1],s=e.dayOfWeek();if(0==n&&i==s||e.nthWeekDay(i,n)==e.day)return 1}return 0}check_set_position(e){if(this.has_by_data("BYSETPOS")){return-1!==this.by_data.BYSETPOS.indexOf(e)}return!1}sort_byday_rules(e){for(let t=0;t<e.length;t++)for(let r=0;r<t;r++){if(this.ruleDayOfWeek(e[r],this.rule.wkst)[1]>this.ruleDayOfWeek(e[t],this.rule.wkst)[1]){let n=e[t];e[t]=e[r],e[r]=n}}}check_contract_restriction(e,t){let r=Ui._indexMap[e],n=Ui._expandMap[this.rule.freq][r],i=!1;if(e in this.by_data&&n==Ui.CONTRACT){let r=this.by_data[e];for(let e of r)if(e==t){i=!0;break}}else i=!0;return i}check_contracting_rules(){let e=this.last.dayOfWeek(),t=this.last.weekNumber(this.rule.wkst),r=this.last.dayOfYear();return this.check_contract_restriction("BYSECOND",this.last.second)&&this.check_contract_restriction("BYMINUTE",this.last.minute)&&this.check_contract_restriction("BYHOUR",this.last.hour)&&this.check_contract_restriction("BYDAY",$i.numericDayToIcalDay(e))&&this.check_contract_restriction("BYWEEKNO",t)&&this.check_contract_restriction("BYMONTHDAY",this.last.day)&&this.check_contract_restriction("BYMONTH",this.last.month)&&this.check_contract_restriction("BYYEARDAY",r)}setup_defaults(e,t,r){let n=Ui._indexMap[e];return Ui._expandMap[this.rule.freq][n]!=Ui.CONTRACT&&(e in this.by_data||(this.by_data[e]=[r]),this.rule.freq!=t)?this.by_data[e][0]:r}toJSON(){let e=Object.create(null);return e.initialized=this.initialized,e.rule=this.rule.toJSON(),e.dtstart=this.dtstart.toJSON(),e.by_data=this.by_data,e.days=this.days,e.last=this.last.toJSON(),e.by_indices=this.by_indices,e.occurrence_number=this.occurrence_number,e}}class Bi extends Error{constructor(){super("Recurrence rule has no valid occurrences")}}const Mi=/^(SU|MO|TU|WE|TH|FR|SA)$/,Vi=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,ji={SU:mi.SUNDAY,MO:mi.MONDAY,TU:mi.TUESDAY,WE:mi.WEDNESDAY,TH:mi.THURSDAY,FR:mi.FRIDAY,SA:mi.SATURDAY},zi=Object.fromEntries(Object.entries(ji).map((e=>e.reverse()))),Hi=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"];class $i{static fromString(e){let t=this._stringToData(e,!1);return new $i(t)}static fromData(e){return new $i(e)}static _stringToData(e,t){let r=Object.create(null),n=e.split(";"),i=n.length;for(let e=0;e<i;e++){let i=n[e].split("="),s=i[0].toUpperCase(),a=i[0].toLowerCase(),o=t?a:s,u=i[1];if(s in qi){let e=u.split(","),t=new Set;for(let r of e)t.add(qi[s](r));e=[...t],r[o]=1==e.length?e[0]:e}else s in Wi?Wi[s](u,r,t):r[a]=u}return r}static icalDayToNumericDay(e,t){let r=t||mi.SUNDAY;return(ji[e]-r+7)%7+1}static numericDayToIcalDay(e,t){let r=e+(t||mi.SUNDAY)-mi.SUNDAY;return r>7&&(r-=7),zi[r]}constructor(e){this.wrappedJSObject=this,this.parts={},e&&"object"==typeof e&&this.fromData(e)}parts=null;interval=1;wkst=mi.MONDAY;until=null;count=null;freq=null;icalclass="icalrecur";icaltype="recur";iterator(e){return new Ui({rule:this,dtstart:e})}clone(){return new $i(this.toJSON())}isFinite(){return!(!this.count&&!this.until)}isByCount(){return!(!this.count||this.until)}addComponent(e,t){let r=e.toUpperCase();r in this.parts?this.parts[r].push(t):this.parts[r]=[t]}setComponent(e,t){this.parts[e.toUpperCase()]=t.slice()}getComponent(e){let t=e.toUpperCase();return t in this.parts?this.parts[t].slice():[]}getNextOccurrence(e,t){let r,n=this.iterator(e);do{r=n.next()}while(r&&r.compare(t)<=0);return r&&t.zone&&(r.zone=t.zone),r}fromData(e){for(let t in e){let r=t.toUpperCase();r in qi?Array.isArray(e[t])?this.parts[r]=e[t]:this.parts[r]=[e[t]]:this[t]=e[t]}this.interval&&"number"!=typeof this.interval&&Wi.INTERVAL(this.interval,this),this.wkst&&"number"!=typeof this.wkst&&(this.wkst=$i.icalDayToNumericDay(this.wkst)),!this.until||this.until instanceof mi||(this.until=mi.fromString(this.until))}toJSON(){let e=Object.create(null);e.freq=this.freq,this.count&&(e.count=this.count),this.interval>1&&(e.interval=this.interval);for(let[t,r]of Object.entries(this.parts))Array.isArray(r)&&1==r.length?e[t.toLowerCase()]=r[0]:e[t.toLowerCase()]=Ni(r);return this.until&&(e.until=this.until.toString()),"wkst"in this&&this.wkst!==mi.DEFAULT_WEEK_START&&(e.wkst=$i.numericDayToIcalDay(this.wkst)),e}toString(){let e="FREQ="+this.freq;this.count&&(e+=";COUNT="+this.count),this.interval>1&&(e+=";INTERVAL="+this.interval);for(let[t,r]of Object.entries(this.parts))e+=";"+t+"="+r;return this.until&&(e+=";UNTIL="+this.until.toICALString()),"wkst"in this&&this.wkst!==mi.DEFAULT_WEEK_START&&(e+=";WKST="+$i.numericDayToIcalDay(this.wkst)),e}}function Ki(e,t,r,n){let i=n;if("+"===n[0]&&(i=n.slice(1)),i=Oi(i),void 0!==t&&n<t)throw new Error(e+': invalid value "'+n+'" must be > '+t);if(void 0!==r&&n>r)throw new Error(e+': invalid value "'+n+'" must be < '+t);return i}const Wi={FREQ:function(e,t,r){if(-1===Hi.indexOf(e))throw new Error('invalid frequency "'+e+'" expected: "'+Hi.join(", ")+'"');t.freq=e},COUNT:function(e,t,r){t.count=Oi(e)},INTERVAL:function(e,t,r){t.interval=Oi(e),t.interval<1&&(t.interval=1)},UNTIL:function(e,t,r){e.length>10?t.until=_s.icalendar.value["date-time"].fromICAL(e):t.until=_s.icalendar.value.date.fromICAL(e),r||(t.until=mi.fromString(t.until))},WKST:function(e,t,r){if(!Mi.test(e))throw new Error('invalid WKST value "'+e+'"');t.wkst=$i.icalDayToNumericDay(e)}},qi={BYSECOND:Ki.bind(void 0,"BYSECOND",0,60),BYMINUTE:Ki.bind(void 0,"BYMINUTE",0,59),BYHOUR:Ki.bind(void 0,"BYHOUR",0,23),BYDAY:function(e){if(Vi.test(e))return e;throw new Error('invalid BYDAY value "'+e+'"')},BYMONTHDAY:Ki.bind(void 0,"BYMONTHDAY",-31,31),BYYEARDAY:Ki.bind(void 0,"BYYEARDAY",-366,366),BYWEEKNO:Ki.bind(void 0,"BYWEEKNO",-53,53),BYMONTH:Ki.bind(void 0,"BYMONTH",1,12),BYSETPOS:Ki.bind(void 0,"BYSETPOS",-366,366)},Gi=/\\\\|\\,|\\[Nn]/g,Zi=/\\|,|\n/g;function Ji(e,t){return{matches:/.*/,fromICAL:function(t,r){return function(e,t,r){if(-1===e.indexOf("\\"))return e;r&&(t=new RegExp(t.source+"|\\\\"+r,t.flags));return e.replace(t,us)}(t,e,r)},toICAL:function(e,r){let n=t;return r&&(n=new RegExp(n.source+"|"+r,n.flags)),e.replace(n,(function(e){switch(e){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case"\n":return"\\n";default:return e}}))}}}const Qi={defaultType:"text"},Xi={defaultType:"text",multiValue:","},es={defaultType:"text",structuredValue:";"},ts={defaultType:"integer"},rs={defaultType:"date-time",allowedTypes:["date-time","date"]},ns={defaultType:"date-time"},is={defaultType:"uri"},ss={defaultType:"utc-offset"},as={defaultType:"recur"},os={defaultType:"date-and-or-time",allowedTypes:["date-time","date","text"]};function us(e){switch(e){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return"\n";default:return e}}let cs={categories:Xi,url:is,version:Qi,uid:Qi},ls={boolean:{values:["TRUE","FALSE"],fromICAL:function(e){return"TRUE"===e},toICAL:function(e){return e?"TRUE":"FALSE"}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(e){let t=parseFloat(e);return Di(t)?0:t},toICAL:function(e){return String(e)}},integer:{fromICAL:function(e){let t=parseInt(e);return Di(t)?0:t},toICAL:function(e){return String(e)}},"utc-offset":{toICAL:function(e){return e.length<7?e.slice(0,3)+e.slice(4,6):e.slice(0,3)+e.slice(4,6)+e.slice(7,9)},fromICAL:function(e){return e.length<6?e.slice(0,3)+":"+e.slice(3,5):e.slice(0,3)+":"+e.slice(3,5)+":"+e.slice(5,7)},decorate:function(e){return Fi.fromString(e)},undecorate:function(e){return e.toString()}}};const hs=Li(ls,{text:Ji(/\\\\|\\;|\\,|\\[Nn]/g,/\\|;|,|\n/g),uri:{},binary:{decorate:function(e){return ci.fromString(e)},undecorate:function(e){return e.toString()}},"cal-address":{},date:{decorate:function(e,t){return mi.fromDateString(e,t)},undecorate:function(e){return e.toString()},fromICAL:function(e){return e.slice(0,4)+"-"+e.slice(4,6)+"-"+e.slice(6,8)},toICAL:function(e){let t=e.length;return 10==t?e.slice(0,4)+e.slice(5,7)+e.slice(8,10):t>=19?hs["date-time"].toICAL(e):e}},"date-time":{fromICAL:function(e){{let t=e.slice(0,4)+"-"+e.slice(4,6)+"-"+e.slice(6,8)+"T"+e.slice(9,11)+":"+e.slice(11,13)+":"+e.slice(13,15);return e[15]&&"Z"===e[15]&&(t+="Z"),t}},toICAL:function(e){if(e.length>=19){let t=e.slice(0,4)+e.slice(5,7)+e.slice(8,13)+e.slice(14,16)+e.slice(17,19);return e[19]&&"Z"===e[19]&&(t+="Z"),t}return e},decorate:function(e,t){return mi.fromDateTimeString(e,t)},undecorate:function(e){return e.toString()}},duration:{decorate:function(e){return di.fromString(e)},undecorate:function(e){return e.toString()}},period:{fromICAL:function(e){let t=e.split("/");return t[0]=hs["date-time"].fromICAL(t[0]),di.isValueString(t[1])||(t[1]=hs["date-time"].fromICAL(t[1])),t},toICAL:function(e){return(e=e.slice())[0]=hs["date-time"].toICAL(e[0]),di.isValueString(e[1])||(e[1]=hs["date-time"].toICAL(e[1])),e.join("/")},decorate:function(e,t){return pi.fromJSON(e,t,!1)},undecorate:function(e){return e.toJSON()}},recur:{fromICAL:function(e){return $i._stringToData(e,!0)},toICAL:function(e){let t="";for(let[r,n]of Object.entries(e))"until"==r?n=n.length>10?hs["date-time"].toICAL(n):hs.date.toICAL(n):"wkst"==r?"number"==typeof n&&(n=$i.numericDayToIcalDay(n)):Array.isArray(n)&&(n=n.join(",")),t+=r.toUpperCase()+"="+n+";";return t.slice(0,Math.max(0,t.length-1))},decorate:function(e){return $i.fromData(e)},undecorate:function(e){return e.toJSON()}},time:{fromICAL:function(e){if(e.length<6)return e;let t=e.slice(0,2)+":"+e.slice(2,4)+":"+e.slice(4,6);return"Z"===e[6]&&(t+="Z"),t},toICAL:function(e){if(e.length<8)return e;let t=e.slice(0,2)+e.slice(3,5)+e.slice(6,8);return"Z"===e[8]&&(t+="Z"),t}}});let ds=Li(cs,{action:Qi,attach:{defaultType:"uri"},attendee:{defaultType:"cal-address"},calscale:Qi,class:Qi,comment:Qi,completed:ns,contact:Qi,created:ns,description:Qi,dtend:rs,dtstamp:ns,dtstart:rs,due:rs,duration:{defaultType:"duration"},exdate:{defaultType:"date-time",allowedTypes:["date-time","date"],multiValue:","},exrule:as,freebusy:{defaultType:"period",multiValue:","},geo:{defaultType:"float",structuredValue:";"},"last-modified":ns,location:Qi,method:Qi,organizer:{defaultType:"cal-address"},"percent-complete":ts,priority:ts,prodid:Qi,"related-to":Qi,repeat:ts,rdate:{defaultType:"date-time",allowedTypes:["date-time","date","period"],multiValue:",",detectType:function(e){return-1!==e.indexOf("/")?"period":-1===e.indexOf("T")?"date":"date-time"}},"recurrence-id":rs,resources:Xi,"request-status":es,rrule:as,sequence:ts,status:Qi,summary:Qi,transp:Qi,trigger:{defaultType:"duration",allowedTypes:["duration","date-time"]},tzoffsetfrom:ss,tzoffsetto:ss,tzurl:is,tzid:Qi,tzname:Qi});const fs=Li(ls,{text:Ji(Gi,Zi),uri:Ji(Gi,Zi),date:{decorate:function(e){return ki.fromDateAndOrTimeString(e,"date")},undecorate:function(e){return e.toString()},fromICAL:function(e){return 8==e.length?hs.date.fromICAL(e):"-"==e[0]&&6==e.length?e.slice(0,4)+"-"+e.slice(4):e},toICAL:function(e){return 10==e.length?hs.date.toICAL(e):"-"==e[0]&&7==e.length?e.slice(0,4)+e.slice(5):e}},time:{decorate:function(e){return ki.fromDateAndOrTimeString("T"+e,"time")},undecorate:function(e){return e.toString()},fromICAL:function(e){let t=fs.time._splitZone(e,!0),r=t[0],n=t[1];return 6==n.length?n=n.slice(0,2)+":"+n.slice(2,4)+":"+n.slice(4,6):4==n.length&&"-"!=n[0]?n=n.slice(0,2)+":"+n.slice(2,4):5==n.length&&(n=n.slice(0,3)+":"+n.slice(3,5)),5!=r.length||"-"!=r[0]&&"+"!=r[0]||(r=r.slice(0,3)+":"+r.slice(3)),n+r},toICAL:function(e){let t=fs.time._splitZone(e),r=t[0],n=t[1];return 8==n.length?n=n.slice(0,2)+n.slice(3,5)+n.slice(6,8):5==n.length&&"-"!=n[0]?n=n.slice(0,2)+n.slice(3,5):6==n.length&&(n=n.slice(0,3)+n.slice(4,6)),6!=r.length||"-"!=r[0]&&"+"!=r[0]||(r=r.slice(0,3)+r.slice(4)),n+r},_splitZone:function(e,t){let r,n,i=e.length-1,s=e.length-(t?5:6),a=e[s];return"Z"==e[i]?(r=e[i],n=e.slice(0,Math.max(0,i))):e.length>6&&("-"==a||"+"==a)?(r=e.slice(s),n=e.slice(0,Math.max(0,s))):(r="",n=e),[r,n]}},"date-time":{decorate:function(e){return ki.fromDateAndOrTimeString(e,"date-time")},undecorate:function(e){return e.toString()},fromICAL:function(e){return fs["date-and-or-time"].fromICAL(e)},toICAL:function(e){return fs["date-and-or-time"].toICAL(e)}},"date-and-or-time":{decorate:function(e){return ki.fromDateAndOrTimeString(e,"date-and-or-time")},undecorate:function(e){return e.toString()},fromICAL:function(e){let t=e.split("T");return(t[0]?fs.date.fromICAL(t[0]):"")+(t[1]?"T"+fs.time.fromICAL(t[1]):"")},toICAL:function(e){let t=e.split("T");return fs.date.toICAL(t[0])+(t[1]?"T"+fs.time.toICAL(t[1]):"")}},timestamp:hs["date-time"],"language-tag":{matches:/^[a-zA-Z0-9-]+$/},"phone-number":{fromICAL:function(e){return Array.from(e).filter((function(e){return"\\"===e?void 0:e})).join("")},toICAL:function(e){return Array.from(e).map((function(e){return","===e||";"===e?"\\"+e:e})).join("")}}});let ps=Li(cs,{adr:{defaultType:"text",structuredValue:";",multiValue:","},anniversary:os,bday:os,caladruri:is,caluri:is,clientpidmap:es,email:Qi,fburl:is,fn:Qi,gender:es,geo:is,impp:is,key:is,kind:Qi,lang:{defaultType:"language-tag"},logo:is,member:is,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:Xi,note:Qi,org:{defaultType:"text",structuredValue:";"},photo:is,related:is,rev:{defaultType:"timestamp"},role:Qi,sound:is,source:is,tel:{defaultType:"uri",allowedTypes:["uri","text"]},title:Qi,tz:{defaultType:"text",allowedTypes:["text","utc-offset","uri"]},xml:Qi}),ms=Li(ls,{binary:hs.binary,date:fs.date,"date-time":fs["date-time"],"phone-number":fs["phone-number"],uri:hs.uri,text:fs.text,time:hs.time,vcard:hs.text,"utc-offset":{toICAL:function(e){return e.slice(0,7)},fromICAL:function(e){return e.slice(0,7)},decorate:function(e){return Fi.fromString(e)},undecorate:function(e){return e.toString()}}}),ys=Li(cs,{fn:Qi,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:Xi,photo:{defaultType:"binary",allowedTypes:["binary","uri"]},bday:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(e){return-1===e.indexOf("T")?"date":"date-time"}},adr:{defaultType:"text",structuredValue:";",multiValue:","},label:Qi,tel:{defaultType:"phone-number"},email:Qi,mailer:Qi,tz:{defaultType:"utc-offset",allowedTypes:["utc-offset","text"]},geo:{defaultType:"float",structuredValue:";"},title:Qi,role:Qi,logo:{defaultType:"binary",allowedTypes:["binary","uri"]},agent:{defaultType:"vcard",allowedTypes:["vcard","text","uri"]},org:es,note:Xi,prodid:Qi,rev:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(e){return-1===e.indexOf("T")?"date":"date-time"}},"sort-string":Qi,sound:{defaultType:"binary",allowedTypes:["binary","uri"]},class:Qi,key:{defaultType:"binary",allowedTypes:["binary","text"]}}),gs={name:"ical",value:hs,param:{cutype:{values:["INDIVIDUAL","GROUP","RESOURCE","ROOM","UNKNOWN"],allowXName:!0,allowIanaToken:!0},"delegated-from":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},"delegated-to":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},encoding:{values:["8BIT","BASE64"]},fbtype:{values:["FREE","BUSY","BUSY-UNAVAILABLE","BUSY-TENTATIVE"],allowXName:!0,allowIanaToken:!0},member:{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},partstat:{values:["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED","COMPLETED","IN-PROCESS"],allowXName:!0,allowIanaToken:!0},range:{values:["THISANDFUTURE"]},related:{values:["START","END"]},reltype:{values:["PARENT","CHILD","SIBLING"],allowXName:!0,allowIanaToken:!0},role:{values:["REQ-PARTICIPANT","CHAIR","OPT-PARTICIPANT","NON-PARTICIPANT"],allowXName:!0,allowIanaToken:!0},rsvp:{values:["TRUE","FALSE"]},"sent-by":{valueType:"cal-address"},tzid:{matches:/^\//},value:{values:["binary","boolean","cal-address","date","date-time","duration","float","integer","period","recur","text","time","uri","utc-offset"],allowXName:!0,allowIanaToken:!0}},property:ds,propertyGroups:!1},vs={name:"vcard4",value:fs,param:{type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","time","date-time","date-and-or-time","timestamp","boolean","integer","float","utc-offset","language-tag"],allowXName:!0,allowIanaToken:!0}},property:ps,propertyGroups:!0},bs={name:"vcard3",value:ms,param:{type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","date-time","phone-number","time","boolean","integer","float","utc-offset","vcard","binary"],allowXName:!0,allowIanaToken:!0}},property:ys,propertyGroups:!0};const _s={strict:!0,defaultSet:gs,defaultType:"unknown",components:{vcard:vs,vcard3:bs,vevent:gs,vtodo:gs,vjournal:gs,valarm:gs,vtimezone:gs,daylight:gs,standard:gs},icalendar:gs,vcard:vs,vcard3:bs,getDesignSet:function(e){return e&&e in _s.components?_s.components[e]:_s.defaultSet}},ws="\r\n",Ts="unknown",Es={'"':"^'","\n":"^n","^":"^^"};function As(e){"string"==typeof e[0]&&(e=[e]);let t=0,r=e.length,n="";for(;t<r;t++)n+=As.component(e[t])+ws;return n}As.component=function(e,t){let r=e[0].toUpperCase(),n="BEGIN:"+r+ws,i=e[1],s=0,a=i.length,o=e[0];for("vcard"===o&&e[1].length>0&&("version"!==e[1][0][0]||"4.0"!==e[1][0][3])&&(o="vcard3"),t=t||_s.getDesignSet(o);s<a;s++)n+=As.property(i[s],t)+ws;let u=e[2]||[],c=0,l=u.length;for(;c<l;c++)n+=As.component(u[c],t)+ws;return n+="END:"+r,n},As.property=function(e,t,r){let n=e[0].toUpperCase(),i=e[0],s=e[1];t||(t=_s.defaultSet);let a,o=s.group;a=t.propertyGroups&&o?o.toUpperCase()+"."+n:n;for(let[e,r]of Object.entries(s)){if(t.propertyGroups&&"group"==e)continue;let n=t.param[e],i=n&&n.multiValue;i&&Array.isArray(r)?(r=r.map((function(e){return e=As._rfc6868Unescape(e),e=As.paramPropertyValue(e,n.multiValueSeparateDQuote)})),r=As.multiValue(r,i,"unknown",null,t)):(r=As._rfc6868Unescape(r),r=As.paramPropertyValue(r)),a+=";"+e.toUpperCase()+"="+r}if(3===e.length)return a+":";let u,c=e[2],l=!1,h=!1,d=!1;return i in t.property?(u=t.property[i],"multiValue"in u&&(l=u.multiValue),"structuredValue"in u&&Array.isArray(e[3])&&(h=u.structuredValue),"defaultType"in u?c===u.defaultType&&(d=!0):c===Ts&&(d=!0)):c===Ts&&(d=!0),d||(a+=";VALUE="+c.toUpperCase()),a+=":",a+=l&&h?As.multiValue(e[3],h,c,l,t,h):l?As.multiValue(e.slice(3),l,c,null,t,!1):h?As.multiValue(e[3],h,c,null,t,h):As.value(e[3],c,t,!1),r?a:Ii(a)},As.paramPropertyValue=function(e,t){return t||-1!==e.indexOf(",")||-1!==e.indexOf(":")||-1!==e.indexOf(";")?'"'+e+'"':e},As.multiValue=function(e,t,r,n,i,s){let a="",o=e.length,u=0;for(;u<o;u++)n&&Array.isArray(e[u])?a+=As.multiValue(e[u],n,r,null,i,s):a+=As.value(e[u],r,i,s),u!==o-1&&(a+=t);return a},As.value=function(e,t,r,n){return t in r.value&&"toICAL"in r.value[t]?r.value[t].toICAL(e,n):e},As._rfc6868Unescape=function(e){return e.replace(/[\n^"]/g,(function(e){return Es[e]}))};class Ds{static fromString(e,t){return new Ds(bi.property(e,t))}constructor(e,t){this._parent=t||null,"string"==typeof e?(this.jCal=[e,{},_s.defaultType],this.jCal[2]=this.getDefaultType()):this.jCal=e,this._updateType()}get type(){return this.jCal[2]}get name(){return this.jCal[0]}get parent(){return this._parent}set parent(e){let t=!this._parent||e&&e._designSet!=this._parent._designSet;this._parent=e,this.type==_s.defaultType&&t&&(this.jCal[2]=this.getDefaultType(),this._updateType())}get _designSet(){return this.parent?this.parent._designSet:_s.defaultSet}_updateType(){let e=this._designSet;this.type in e.value&&("decorate"in e.value[this.type]?this.isDecorated=!0:this.isDecorated=!1,this.name in e.property&&(this.isMultiValue="multiValue"in e.property[this.name],this.isStructuredValue="structuredValue"in e.property[this.name]))}_hydrateValue(e){return this._values&&this._values[e]?this._values[e]:this.jCal.length<=3+e?null:this.isDecorated?(this._values||(this._values=[]),this._values[e]=this._decorate(this.jCal[3+e])):this.jCal[3+e]}_decorate(e){return this._designSet.value[this.type].decorate(e,this)}_undecorate(e){return this._designSet.value[this.type].undecorate(e,this)}_setDecoratedValue(e,t){this._values||(this._values=[]),"object"==typeof e&&"icaltype"in e?(this.jCal[3+t]=this._undecorate(e),this._values[t]=e):(this.jCal[3+t]=e,this._values[t]=this._decorate(e))}getParameter(e){return e in this.jCal[1]?this.jCal[1][e]:void 0}getFirstParameter(e){let t=this.getParameter(e);return Array.isArray(t)?t[0]:t}setParameter(e,t){let r=e.toLowerCase();"string"==typeof t&&r in this._designSet.param&&"multiValue"in this._designSet.param[r]&&(t=[t]),this.jCal[1][e]=t}removeParameter(e){delete this.jCal[1][e]}getDefaultType(){let e=this.jCal[0],t=this._designSet;if(e in t.property){let r=t.property[e];if("defaultType"in r)return r.defaultType}return _s.defaultType}resetType(e){this.removeAllValues(),this.jCal[2]=e,this._updateType()}getFirstValue(){return this._hydrateValue(0)}getValues(){let e=this.jCal.length-3;if(e<1)return[];let t=0,r=[];for(;t<e;t++)r[t]=this._hydrateValue(t);return r}removeAllValues(){this._values&&(this._values.length=0),this.jCal.length=3}setValues(e){if(!this.isMultiValue)throw new Error(this.name+": does not not support mulitValue.\noverride isMultiValue");let t=e.length,r=0;if(this.removeAllValues(),t>0&&"object"==typeof e[0]&&"icaltype"in e[0]&&this.resetType(e[0].icaltype),this.isDecorated)for(;r<t;r++)this._setDecoratedValue(e[r],r);else for(;r<t;r++)this.jCal[3+r]=e[r]}setValue(e){this.removeAllValues(),"object"==typeof e&&"icaltype"in e&&this.resetType(e.icaltype),this.isDecorated?this._setDecoratedValue(e,0):this.jCal[3]=e}toJSON(){return this.jCal}toICALString(){return As.property(this.jCal,this._designSet,!0)}}class Os{static fromString(e){return new Os(bi.component(e))}constructor(e,t){"string"==typeof e&&(e=[e,[],[]]),this.jCal=e,this.parent=t||null,this.parent||"vcalendar"!==this.name||(this._timezoneCache=new Map)}_hydratedPropertyCount=0;_hydratedComponentCount=0;_timezoneCache=null;_components=null;_properties=null;get name(){return this.jCal[0]}get _designSet(){let e=this.parent&&this.parent._designSet;if(!e&&"vcard"==this.name){let e=this.jCal[1]?.[0];if(e&&"version"==e[0]&&"3.0"==e[3])return _s.getDesignSet("vcard3")}return e||_s.getDesignSet(this.name)}_hydrateComponent(e){if(this._components||(this._components=[],this._hydratedComponentCount=0),this._components[e])return this._components[e];let t=new Os(this.jCal[2][e],this);return this._hydratedComponentCount++,this._components[e]=t}_hydrateProperty(e){if(this._properties||(this._properties=[],this._hydratedPropertyCount=0),this._properties[e])return this._properties[e];let t=new Ds(this.jCal[1][e],this);return this._hydratedPropertyCount++,this._properties[e]=t}getFirstSubcomponent(e){if(e){let t=0,r=this.jCal[2],n=r.length;for(;t<n;t++)if(r[t][0]===e){return this._hydrateComponent(t)}}else if(this.jCal[2].length)return this._hydrateComponent(0);return null}getAllSubcomponents(e){let t=this.jCal[2].length,r=0;if(e){let n=this.jCal[2],i=[];for(;r<t;r++)e===n[r][0]&&i.push(this._hydrateComponent(r));return i}if(!this._components||this._hydratedComponentCount!==t)for(;r<t;r++)this._hydrateComponent(r);return this._components||[]}hasProperty(e){let t=this.jCal[1],r=t.length,n=0;for(;n<r;n++)if(t[n][0]===e)return!0;return!1}getFirstProperty(e){if(e){let t=0,r=this.jCal[1],n=r.length;for(;t<n;t++)if(r[t][0]===e){return this._hydrateProperty(t)}}else if(this.jCal[1].length)return this._hydrateProperty(0);return null}getFirstPropertyValue(e){let t=this.getFirstProperty(e);return t?t.getFirstValue():null}getAllProperties(e){let t=this.jCal[1].length,r=0;if(e){let n=this.jCal[1],i=[];for(;r<t;r++)e===n[r][0]&&i.push(this._hydrateProperty(r));return i}if(!this._properties||this._hydratedPropertyCount!==t)for(;r<t;r++)this._hydrateProperty(r);return this._properties||[]}_removeObjectByIndex(e,t,r){if((t=t||[])[r]){let e=t[r];"parent"in e&&(e.parent=null)}t.splice(r,1),this.jCal[e].splice(r,1)}_removeObject(e,t,r){let n=0,i=this.jCal[e],s=i.length,a=this[t];if("string"==typeof r){for(;n<s;n++)if(i[n][0]===r)return this._removeObjectByIndex(e,a,n),!0}else if(a)for(;n<s;n++)if(a[n]&&a[n]===r)return this._removeObjectByIndex(e,a,n),!0;return!1}_removeAllObjects(e,t,r){let n=this[t],i=this.jCal[e],s=i.length-1;for(;s>=0;s--)r&&i[s][0]!==r||this._removeObjectByIndex(e,n,s)}addSubcomponent(e){this._components||(this._components=[],this._hydratedComponentCount=0),e.parent&&e.parent.removeSubcomponent(e);let t=this.jCal[2].push(e.jCal);return this._components[t-1]=e,this._hydratedComponentCount++,e.parent=this,e}removeSubcomponent(e){let t=this._removeObject(2,"_components",e);return t&&this._hydratedComponentCount--,t}removeAllSubcomponents(e){let t=this._removeAllObjects(2,"_components",e);return this._hydratedComponentCount=0,t}addProperty(e){if(!(e instanceof Ds))throw new TypeError("must be instance of ICAL.Property");this._properties||(this._properties=[],this._hydratedPropertyCount=0),e.parent&&e.parent.removeProperty(e);let t=this.jCal[1].push(e.jCal);return this._properties[t-1]=e,this._hydratedPropertyCount++,e.parent=this,e}addPropertyWithValue(e,t){let r=new Ds(e);return r.setValue(t),this.addProperty(r),r}updatePropertyWithValue(e,t){let r=this.getFirstProperty(e);return r?r.setValue(t):r=this.addPropertyWithValue(e,t),r}removeProperty(e){let t=this._removeObject(1,"_properties",e);return t&&this._hydratedPropertyCount--,t}removeAllProperties(e){let t=this._removeAllObjects(1,"_properties",e);return this._hydratedPropertyCount=0,t}toJSON(){return this.jCal}toString(){return As.component(this.jCal,this._designSet)}getTimeZoneByID(e){if(this.parent)return this.parent.getTimeZoneByID(e);if(!this._timezoneCache)return null;if(this._timezoneCache.has(e))return this._timezoneCache.get(e);const t=this.getAllSubcomponents("vtimezone");for(const r of t)if(r.getFirstProperty("tzid").getFirstValue()===e){const t=new Ti({component:r,tzid:e});return this._timezoneCache.set(e,t),t}return null}}class Cs{constructor(e){this.ruleDates=[],this.exDates=[],this.fromData(e)}complete=!1;ruleIterators=null;ruleDates=null;exDates=null;ruleDateInc=0;exDateInc=0;exDate=null;ruleDate=null;dtstart=null;last=null;fromData(e){let t=Ci(e.dtstart,mi);if(!t)throw new Error(".dtstart (ICAL.Time) must be given");if(this.dtstart=t,e.component)this._init(e.component);else{if(this.last=Ci(e.last,mi)||t.clone(),!e.ruleIterators)throw new Error(".ruleIterators or .component must be given");this.ruleIterators=e.ruleIterators.map((function(e){return Ci(e,Ui)})),this.ruleDateInc=e.ruleDateInc,this.exDateInc=e.exDateInc,e.ruleDates&&(this.ruleDates=e.ruleDates.map((e=>Ci(e,mi))),this.ruleDate=this.ruleDates[this.ruleDateInc]),e.exDates&&(this.exDates=e.exDates.map((e=>Ci(e,mi))),this.exDate=this.exDates[this.exDateInc]),void 0!==e.complete&&(this.complete=e.complete)}}_compare_special(e,t){return!e.isDate&&t.isDate?new mi({year:e.year,month:e.month,day:e.day}).compare(t):e.compare(t)}next(){let e,t,r,n=0;for(;;){if(n++>500)throw new Error("max tries have occurred, rule may be impossible to fulfill.");if(t=this.ruleDate,e=this._nextRecurrenceIter(this.last),!t&&!e){this.complete=!0;break}if((!t||e&&t.compare(e.last)>0)&&(t=e.last.clone(),e.next()),this.ruleDate===t&&this._nextRuleDay(),this.last=t,!this.exDate||(r=this._compare_special(this.last,this.exDate),r>0&&this._nextExDay(),0!==r))return this.last;this._nextExDay()}}toJSON(){function e(e){return e.toJSON()}let t=Object.create(null);return t.ruleIterators=this.ruleIterators.map(e),this.ruleDates&&(t.ruleDates=this.ruleDates.map(e)),this.exDates&&(t.exDates=this.exDates.map(e)),t.ruleDateInc=this.ruleDateInc,t.exDateInc=this.exDateInc,t.last=this.last.toJSON(),t.dtstart=this.dtstart.toJSON(),t.complete=this.complete,t}_extractDates(e,t){let r=[],n=e.getAllProperties(t);for(let e=0,t=n.length;e<t;e++)for(let t of n[e].getValues()){let e=xi(r,t,((e,t)=>e.compare(t)));r.splice(e,0,t)}return r}_init(e){if(this.ruleIterators=[],this.last=this.dtstart.clone(),!e.hasProperty("rdate")&&!e.hasProperty("rrule")&&!e.hasProperty("recurrence-id"))return this.ruleDate=this.last.clone(),void(this.complete=!0);if(e.hasProperty("rdate")&&(this.ruleDates=this._extractDates(e,"rdate"),this.ruleDates[0]&&this.ruleDates[0].compare(this.dtstart)<0?(this.ruleDateInc=0,this.last=this.ruleDates[0].clone()):this.ruleDateInc=xi(this.ruleDates,this.last,((e,t)=>e.compare(t))),this.ruleDate=this.ruleDates[this.ruleDateInc]),e.hasProperty("rrule")){let t,r,n=e.getAllProperties("rrule"),i=0,s=n.length;for(;i<s;i++)t=n[i].getFirstValue(),r=t.iterator(this.dtstart),this.ruleIterators.push(r),r.next()}e.hasProperty("exdate")&&(this.exDates=this._extractDates(e,"exdate"),this.exDateInc=xi(this.exDates,this.last,this._compare_special),this.exDate=this.exDates[this.exDateInc])}_nextExDay(){this.exDate=this.exDates[++this.exDateInc]}_nextRuleDay(){this.ruleDate=this.ruleDates[++this.ruleDateInc]}_nextRecurrenceIter(){let e=this.ruleIterators;if(0===e.length)return null;let t,r,n,i=e.length,s=0;for(;s<i;s++)t=e[s],r=t.last,t.completed?(i--,0!==s&&s--,e.splice(s,1)):(!n||n.last.compare(r)>0)&&(n=t);return n}}class Ss{constructor(e,t){e instanceof Os||(t=e,e=null),this.component=e||new Os("vevent"),this._rangeExceptionCache=Object.create(null),this.exceptions=Object.create(null),this.rangeExceptions=[],t&&t.strictExceptions&&(this.strictExceptions=t.strictExceptions),t&&t.exceptions?t.exceptions.forEach(this.relateException,this):this.component.parent&&!this.isRecurrenceException()&&this.component.parent.getAllSubcomponents("vevent").forEach((function(e){e.hasProperty("recurrence-id")&&this.relateException(e)}),this)}static THISANDFUTURE="THISANDFUTURE";exceptions=null;strictExceptions=!1;relateException(e){if(this.isRecurrenceException())throw new Error("cannot relate exception to exceptions");if(e instanceof Os&&(e=new Ss(e)),this.strictExceptions&&e.uid!==this.uid)throw new Error("attempted to relate unrelated exception");let t=e.recurrenceId.toString();if(this.exceptions[t]=e,e.modifiesFuture()){let r=[e.recurrenceId.toUnixTime(),t],n=xi(this.rangeExceptions,r,xs);this.rangeExceptions.splice(n,0,r)}}modifiesFuture(){if(!this.component.hasProperty("recurrence-id"))return!1;return this.component.getFirstProperty("recurrence-id").getParameter("range")===Ss.THISANDFUTURE}findRangeException(e){if(!this.rangeExceptions.length)return null;let t=e.toUnixTime(),r=xi(this.rangeExceptions,[t],xs);if(r-=1,r<0)return null;let n=this.rangeExceptions[r];return t<n[0]?null:n[1]}getOccurrenceDetails(e){let t,r=e.toString(),n=e.convertToZone(Ti.utcTimezone).toString(),i={recurrenceId:e};if(r in this.exceptions)t=i.item=this.exceptions[r],i.startDate=t.startDate,i.endDate=t.endDate,i.item=t;else if(n in this.exceptions)t=this.exceptions[n],i.startDate=t.startDate,i.endDate=t.endDate,i.item=t;else{let t,r=this.findRangeException(e);if(r){let n=this.exceptions[r];i.item=n;let s=this._rangeExceptionCache[r];if(!s){let e=n.recurrenceId.clone(),t=n.startDate.clone();e.zone=t.zone,s=t.subtractDate(e),this._rangeExceptionCache[r]=s}let a=e.clone();a.zone=n.startDate.zone,a.addDuration(s),t=a.clone(),t.addDuration(n.duration),i.startDate=a,i.endDate=t}else t=e.clone(),t.addDuration(this.duration),i.endDate=t,i.startDate=e,i.item=this}return i}iterator(e){return new Cs({component:this.component,dtstart:e||this.startDate})}isRecurring(){let e=this.component;return e.hasProperty("rrule")||e.hasProperty("rdate")}isRecurrenceException(){return this.component.hasProperty("recurrence-id")}getRecurrenceTypes(){let e=this.component.getAllProperties("rrule"),t=0,r=e.length,n=Object.create(null);for(;t<r;t++){n[e[t].getFirstValue().freq]=!0}return n}get uid(){return this._firstProp("uid")}set uid(e){this._setProp("uid",e)}get startDate(){return this._firstProp("dtstart")}set startDate(e){this._setTime("dtstart",e)}get endDate(){let e=this._firstProp("dtend");if(!e){let t=this._firstProp("duration");e=this.startDate.clone(),t?e.addDuration(t):e.isDate&&(e.day+=1)}return e}set endDate(e){this.component.hasProperty("duration")&&this.component.removeProperty("duration"),this._setTime("dtend",e)}get duration(){let e=this._firstProp("duration");return e||this.endDate.subtractDateTz(this.startDate)}set duration(e){this.component.hasProperty("dtend")&&this.component.removeProperty("dtend"),this._setProp("duration",e)}get location(){return this._firstProp("location")}set location(e){this._setProp("location",e)}get attendees(){return this.component.getAllProperties("attendee")}get summary(){return this._firstProp("summary")}set summary(e){this._setProp("summary",e)}get description(){return this._firstProp("description")}set description(e){this._setProp("description",e)}get color(){return this._firstProp("color")}set color(e){this._setProp("color",e)}get organizer(){return this._firstProp("organizer")}set organizer(e){this._setProp("organizer",e)}get sequence(){return this._firstProp("sequence")}set sequence(e){this._setProp("sequence",e)}get recurrenceId(){return this._firstProp("recurrence-id")}set recurrenceId(e){this._setTime("recurrence-id",e)}_setTime(e,t){let r=this.component.getFirstProperty(e);r||(r=new Ds(e),this.component.addProperty(r)),t.zone===Ti.localTimezone||t.zone===Ti.utcTimezone?r.removeParameter("tzid"):r.setParameter("tzid",t.zone.tzid),r.setValue(t)}_setProp(e,t){this.component.updatePropertyWithValue(e,t)}_firstProp(e){return this.component.getFirstPropertyValue(e)}toString(){return this.component.toString()}}function xs(e,t){return e[0]>t[0]?1:t[0]>e[0]?-1:0}var Ns={foldLength:75,debug:!1,newLineChar:"\r\n",Binary:ci,Component:Os,ComponentParser:class{constructor(e){void 0===e&&(e={});for(let[t,r]of Object.entries(e))this[t]=r}parseEvent=!0;parseTimezone=!0;oncomplete=function(){};onerror=function(e){};ontimezone=function(e){};onevent=function(e){};process(e){"string"==typeof e&&(e=bi(e)),e instanceof Os||(e=new Os(e));let t,r=e.getAllSubcomponents(),n=0,i=r.length;for(;n<i;n++)switch(t=r[n],t.name){case"vtimezone":if(this.parseTimezone){let e=t.getFirstPropertyValue("tzid");e&&this.ontimezone(new Ti({tzid:e,component:t}))}break;case"vevent":this.parseEvent&&this.onevent(new Ss(t));break;default:continue}this.oncomplete()}},Duration:di,Event:Ss,Period:pi,Property:Ds,Recur:$i,RecurExpansion:Cs,RecurIterator:Ui,Time:mi,Timezone:Ti,TimezoneService:Ai,UtcOffset:Fi,VCardTime:ki,parse:bi,stringify:As,design:_s,helpers:Pi};function Is(e){try{const t=function(e){return e.replace(/\r\n /g,"").replace(/\n /g,"")}(e),r=Ns.parse(t);return new Ns.Component(r)}catch(e){throw new Error(`Failed to parse iCal component: ${e instanceof Error?e.message:String(e)}`)}}function Ys(e){try{const t=e.toString().split(/\r\n|\n/);return t.map((e=>function(e,t=75){if(e.length<=t)return e;const r=[];let n=e;for(r.push(n.substring(0,t)),n=n.substring(t);n.length>0;){const e=n.substring(0,t-1);r.push(` ${e}`),n=n.substring(t-1)}return r.join("\r\n")}(e))).join("\r\n")}catch(e){throw new Error(`Failed to serialize iCal component: ${e instanceof Error?e.message:String(e)}`)}}function Rs(e){const t=e.getFirstPropertyValue("sequence"),r="number"==typeof t?t+1:0;e.getFirstProperty("sequence")?e.updatePropertyWithValue("sequence",r):e.addPropertyWithValue("sequence",r)}function Ls(e){const t=Ns.Time.now();e.getFirstProperty("dtstamp")?e.updatePropertyWithValue("dtstamp",t):e.addPropertyWithValue("dtstamp",t)}function Ps(e,t){t.getAllProperties().forEach((t=>{const r=t.name;if(r.toLowerCase().startsWith("x-")){e.getAllProperties().find((e=>e.name.toLowerCase()===r.toLowerCase()))||e.addProperty(t)}}))}function Fs(e){const t=e.getFirstPropertyValue("sequence");return"number"==typeof t?t:0}function ks(e){const t=e.getFirstPropertyValue("dtstamp");return t?"object"==typeof t&&"toICALString"in t&&"function"==typeof t.toICALString?t.toICALString():t.toString():null}function Us(e){if(!e.getFirstPropertyValue("uid"))throw new Error("UID property is required and must not be removed")}const Bs={autoIncrementSequence:!0,autoUpdateDtstamp:!0,preserveUnknownFields:!0,preserveVendorExtensions:!0};function Ms(e,t,r){const n={...Bs,...r};if(!e.data)throw new Error("calendarObject.data is required");if(!t||0===Object.keys(t).length)throw new Error("At least one field must be specified for update");const i=[];let s=!1;try{const r=Is(e.data),a=r.getFirstSubcomponent("vevent");if(!a)throw new Error("VEVENT component not found in VCALENDAR");Us(a);const o=a.getFirstPropertyValue("uid"),u=new Ns.Component(a.toJSON());for(const[e,r]of Object.entries(t)){const t=e.toLowerCase();if(a.getFirstPropertyValue(t)!==r)if(s=!0,null==r||""===r){const r=a.getFirstProperty(t);r&&(a.removeProperty(r),i.push(`${e} removed (empty value provided)`))}else a.getFirstProperty(t)?a.updatePropertyWithValue(t,r):a.addPropertyWithValue(t,r)}s&&(n.autoIncrementSequence&&Rs(a),n.autoUpdateDtstamp&&Ls(a)),n.preserveVendorExtensions&&Ps(a,u);if(a.getFirstPropertyValue("uid")!==o)throw new Error("UID must not be modified");r.getAllSubcomponents("vtimezone").length;const c=Ys(r),l=Fs(a),h=ks(a),d=a.getAllProperties().filter((e=>e.name.toLowerCase().startsWith("x-"))).length;return d>0&&i.push(`Preserved ${d} vendor extension(s)`),{data:c,modified:s,warnings:i.length>0?i:void 0,metadata:{sequence:l,dtstamp:h||void 0,vendorExtensionsCount:d>0?d:void 0}}}catch(e){throw new Error(`Failed to update event fields: ${e instanceof Error?e.message:String(e)}`)}}function Vs(e){try{if(!e.data)return!1;const t=Is(e.data).getFirstSubcomponent("vevent");if(!t)return!1;return!!t.getFirstPropertyValue("uid")}catch(e){return!1}}function js(e){if(!e.data)throw new Error("calendarObject.data is required");try{const t=Is(e.data).getFirstSubcomponent("vevent");if(!t)throw new Error("VEVENT component not found in VCALENDAR");const r={},n=t.getFirstPropertyValue("summary");null!=n&&"string"==typeof n&&(r.SUMMARY=n);const i=t.getFirstPropertyValue("description");return null!=i&&"string"==typeof i&&(r.DESCRIPTION=i),r}catch(e){throw new Error(`Failed to extract event fields: ${e instanceof Error?e.message:String(e)}`)}}const zs={autoIncrementSequence:!1,autoUpdateDtstamp:!1,preserveUnknownFields:!0,preserveVendorExtensions:!0},Hs=new Set(["FN","N","EMAIL","TEL","ORG","NOTE","TITLE","URL"]);function $s(e,t,r){const n={...zs,...r};if(!e.data)throw new Error("vCard data is required");if("string"!=typeof e.data)throw new Error("vCard data must be a string");let i;try{i=Is(e.data)}catch(e){throw new Error(`Failed to parse vCard: ${e instanceof Error?e.message:String(e)}`)}let s=null;if("vcard"===i.name?s=i:"vcalendar"===i.name&&(s=i.getFirstSubcomponent("vcard")),!s)throw new Error("No VCARD component found in data");const a=s.toJSON();let o=!1;const u=[];if(!s.getFirstPropertyValue("uid"))throw new Error("vCard must have a UID property");const c=s.getFirstPropertyValue("fn");if(""===t.FN&&c)throw new Error("FN (Formatted Name) is a required field and cannot be removed");for(const[e,r]of Object.entries(t)){if(!Hs.has(e)){u.push(`Unknown field '${e}' - skipping`);continue}const t=e.toLowerCase(),n=s.getFirstPropertyValue(t);if(""===r){if(null!==n){const e=s.getFirstProperty(t);e&&(s.removeProperty(e),o=!0)}continue}if(n===r)continue;s.getFirstProperty(t)?s.updatePropertyWithValue(t,r):s.addPropertyWithValue(t,r),o=!0}if(o){const e=Ns.Time.now();s.getFirstProperty("rev")?s.updatePropertyWithValue("rev",e):s.addPropertyWithValue("rev",e)}let l,h=0;if(n.preserveVendorExtensions){Ps(s,new Ns.Component(a)),h=s.getAllProperties().filter((e=>e.name.toLowerCase().startsWith("x-"))).length,h>0&&u.push(`Preserved ${h} vendor extension${h>1?"s":""}`)}try{l=Ys(i)}catch(e){throw new Error(`Failed to serialize vCard: ${e instanceof Error?e.message:String(e)}`)}const d={data:l,modified:o};if(u.length>0&&(d.warnings=u),o){d.metadata={};const e=s.getFirstPropertyValue("rev");e&&("object"==typeof e&&"toICALString"in e&&"function"==typeof e.toICALString?d.metadata.dtstamp=e.toICALString():d.metadata.dtstamp=e.toString()),n.preserveVendorExtensions&&h>0&&(d.metadata.vendorExtensionsCount=h)}return d}function Ks(e){const t=[];if("FN"in e&&""===e.FN&&t.push("FN (Formatted Name) is required and cannot be empty"),e.N&&e.N.length>0&&(e.N.includes(";")||t.push("N (Structured Name) should be in format: Family;Given;Additional;Prefix;Suffix")),e.URL&&e.URL.length>0)try{new URL(e.URL)}catch(e){t.push("URL is not a valid URL format")}return t}function Ws(e){if(!e.data||"string"!=typeof e.data)throw new Error("Invalid vCard data");try{const t=Is(e.data);let r=null;if("vcard"===t.name?r=t:"vcalendar"===t.name&&(r=t.getFirstSubcomponent("vcard")),!r)throw new Error("No VCARD component found");const n={};for(const e of Hs){const t=r.getFirstPropertyValue(e.toLowerCase());null!=t&&(n[e]=String(t))}return n}catch(e){throw new Error(`Failed to extract vCard fields: ${e instanceof Error?e.message:String(e)}`)}}const qs={autoIncrementSequence:!0,autoUpdateDtstamp:!0,preserveUnknownFields:!0,preserveVendorExtensions:!0};function Gs(e,t,r){const n={...qs,...r};if(!e.data)throw new Error("calendarObject.data is required");if("string"!=typeof e.data)throw new Error("calendarObject.data must be a string (iCal format)");const i=Is(e.data),s=i.getFirstSubcomponent("vtodo");if(!s)throw new Error("VTODO component not found in calendar object");Us(s);const a=new Ns.Component(s.toJSON());let o=!1;const u=[];if(void 0!==t.SUMMARY){if(s.getFirstPropertyValue("summary")!==t.SUMMARY)if(null===t.SUMMARY||""===t.SUMMARY){const e=s.getFirstProperty("summary");e&&(s.removeProperty(e),o=!0)}else s.getFirstProperty("summary")?s.updatePropertyWithValue("summary",t.SUMMARY):s.addPropertyWithValue("summary",t.SUMMARY),o=!0}if(void 0!==t.DESCRIPTION){if(s.getFirstPropertyValue("description")!==t.DESCRIPTION)if(null===t.DESCRIPTION||""===t.DESCRIPTION){const e=s.getFirstProperty("description");e&&(s.removeProperty(e),o=!0)}else s.getFirstProperty("description")?s.updatePropertyWithValue("description",t.DESCRIPTION):s.addPropertyWithValue("description",t.DESCRIPTION),o=!0}let c,l;if(n.autoIncrementSequence&&o){const e=Fs(s);Rs(s),c=Fs(s),e===c&&u.push(`SEQUENCE already at value ${c}, not incremented`)}n.autoUpdateDtstamp&&o&&(Ls(s),l=ks(s)||void 0);let h=0;if(n.preserveVendorExtensions){h=a.getAllProperties().filter((e=>e.name.toLowerCase().startsWith("x-"))).length,Ps(s,a),h>0&&u.push(`Preserved ${h} vendor extension(s)`)}Us(s);return{data:Ys(i),modified:o,warnings:u.length>0?u:void 0,metadata:{sequence:c,dtstamp:l,vendorExtensionsCount:h>0?h:void 0}}}function Zs(e,t,r){return e.map((e=>Gs(e,t,r)))}function Js(e){try{if(!e.data||"string"!=typeof e.data)return!1;const t=Is(e.data);return null!==t.getFirstSubcomponent("vtodo")}catch(e){return!1}}function Qs(e){if(!e.data||"string"!=typeof e.data)throw new Error("calendarObject.data must be a string (iCal format)");const t=Is(e.data).getFirstSubcomponent("vtodo");if(!t)throw new Error("VTODO component not found in calendar object");const r={},n=t.getFirstPropertyValue("summary");null!==n&&"string"==typeof n&&(r.SUMMARY=n);const i=t.getFirstPropertyValue("description");return null!==i&&"string"==typeof i&&(r.DESCRIPTION=i),r}var Xs={DAVNamespace:B,DAVNamespaceShort:z,DAVAttributeMap:j,...ui,...Xr,...ln,...Un,...bn,...Yn,...qn,...si,...Kr};export{j as DAVAttributeMap,oi as DAVClient,B as DAVNamespace,z as DAVNamespaceShort,fn as addressBookMultiGet,dn as addressBookQuery,Zs as batchUpdateTodoFields,En as calendarMultiGet,Tn as calendarQuery,Vr as cleanupFalsy,nn as collectionQuery,kn as createAccount,Cn as createCalendarObject,ai as createDAVClient,Zr as createObject,Hn as createTodo,yn as createVCard,qr as davRequest,Xs as default,xn as deleteCalendarObject,Qr as deleteObject,Kn as deleteTodo,vn as deleteVCard,js as extractEventFields,Qs as extractTodoFields,Ws as extractVCardFields,pn as fetchAddressBooks,On as fetchCalendarObjects,wn as fetchCalendarUserAddresses,Dn as fetchCalendars,ri as fetchOauthTokens,zn as fetchTodos,mn as fetchVCards,In as freeBusyQuery,ti as getBasicAuthHeaders,Mr as getDAVAttribute,ii as getOauthHeaders,Vs as hasValidVEvent,on as isCollectionDirty,Js as isTodoObject,An as makeCalendar,Gr as propfind,ni as refreshAccessToken,cn as smartCollectionSync,an as supportedReportSet,Nn as syncCalendars,un as syncCollection,jn as todoMultiGet,Vn as todoQuery,Sn as updateCalendarObject,Ms as updateEventFields,Jr as updateObject,$n as updateTodo,Gs as updateTodoFields,gn as updateVCard,$s as updateVCardFields,Br as urlContains,Ur as urlEquals,Ks as validateVCardFields};
