"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("cross-fetch"),r=require("debug"),a=require("xml-js"),s=require("base-64");exports.DAVNamespace=void 0,(e=exports.DAVNamespace||(exports.DAVNamespace={})).CALENDAR_SERVER="http://calendarserver.org/ns/",e.CALDAV_APPLE="http://apple.com/ns/ical/",e.CALDAV="urn:ietf:params:xml:ns:caldav",e.CARDDAV="urn:ietf:params:xml:ns:carddav",e.DAV="DAV:";const o={[exports.DAVNamespace.CALDAV]:"xmlns:c",[exports.DAVNamespace.CARDDAV]:"xmlns:card",[exports.DAVNamespace.CALENDAR_SERVER]:"xmlns:cs",[exports.DAVNamespace.CALDAV_APPLE]:"xmlns:ca",[exports.DAVNamespace.DAV]:"xmlns:d"};var n,c;exports.DAVNamespaceShort=void 0,(n=exports.DAVNamespaceShort||(exports.DAVNamespaceShort={})).CALDAV="c",n.CARDDAV="card",n.CALENDAR_SERVER="cs",n.CALDAV_APPLE="ca",n.DAV="d",function(e){e.VEVENT="VEVENT",e.VTODO="VTODO",e.VJOURNAL="VJOURNAL",e.VFREEBUSY="VFREEBUSY",e.VTIMEZONE="VTIMEZONE",e.VALARM="VALARM"}(c||(c={}));const d=e=>{const t=Number(e);if(!Number.isNaN(t))return t;const r=e.toLowerCase();return"true"===r||"false"!==r&&e},l=(e,t)=>{if(!e&&!t)return!0;if(!e||!t)return!1;const r=e.trim(),a=t.trim();if(Math.abs(r.length-a.length)>1)return!1;const s="/"===r.slice(-1)?r.slice(0,-1):r,o="/"===a.slice(-1)?a.slice(0,-1):a;return e.includes(o)||t.includes(s)},i=(e,t)=>{if(!e&&!t)return!0;if(!e||!t)return!1;const r=e.trim(),a=t.trim(),s="/"===r.slice(-1)?r.slice(0,-1):r,o="/"===a.slice(-1)?a.slice(0,-1):a;return e.includes(o)||t.includes(s)},p=e=>e.reduce(((e,t)=>({...e,[o[t]]:t})),{}),h=e=>Object.entries(e).reduce(((e,[t,r])=>r?{...e,[t]:r}:e),{}),u=(e,t)=>t?{[e]:t}:{},f=(e,t)=>e?t&&0!==t.length?Object.fromEntries(Object.entries(e).filter((([e])=>!t.includes(e)))):e:{},m=e=>Boolean(null==e?void 0:e.includes(".ics")),A=(e,t)=>{const r=/^\d{4}(-\d\d(-\d\d(T\d\d:\d\d(:\d\d)?(\.\d+)?(([+-]\d\d:\d\d)|Z)?)?)?)?$/i,a=/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+)?(([+-]\d\d:\d\d)|Z)?$/i;if(!(r.test(e)&&r.test(t)||a.test(e)&&a.test(t)))throw new Error("invalid timeRange format, not in ISO8601")};var v=Object.freeze({__proto__:null,cleanupFalsy:h,conditionalParam:u,defaultIcsFilter:m,excludeHeaders:f,getDAVAttribute:p,urlContains:i,urlEquals:l,validateISO8601TimeRange:A});const D=r("tsdav:request"),O=async e=>{var r;const{url:s,init:o,convertIncoming:n=!0,parseOutgoing:c=!0,fetchOptions:l={}}=e,{headers:i={},body:p,namespace:u,method:f,attributes:m}=o,A=n?a.js2xml({_declaration:{_attributes:{version:"1.0",encoding:"utf-8"}},...p,_attributes:m},{compact:!0,spaces:2,elementNameFn:e=>u&&!/^.+:.+/.test(e)?`${u}:${e}`:e}):p,v={...l};delete v.headers;const O=await t.fetch(s,{headers:{"Content-Type":"text/xml;charset=UTF-8",...h(i),...l.headers||{}},body:A,method:f,...v}),y=await O.text();if(!O.ok||!(null===(r=O.headers.get("content-type"))||void 0===r?void 0:r.includes("xml"))||!c)return[{href:O.url,ok:O.ok,status:O.status,statusText:O.statusText,raw:y}];const V=a.xml2js(y,{compact:!0,trim:!0,textFn:(e,t)=>{try{const r=t._parent,a=Object.keys(r),s=a[a.length-1],o=r[s];if(o.length>0){o[o.length-1]=d(e)}else r[s]=d(e)}catch(e){D(e.stack)}},elementNameFn:e=>e.replace(/^.+:/,"").replace(/([-_]\w)/g,(e=>e[1].toUpperCase())),attributesFn:e=>{const t={...e};return delete t.xmlns,t},ignoreDeclaration:!0});return(Array.isArray(V.multistatus.response)?V.multistatus.response:[V.multistatus.response]).map((e=>{var t,r;if(!e)return{status:O.status,statusText:O.statusText,ok:O.ok};const a=/^\S+\s(?<status>\d+)\s(?<statusText>.+)$/.exec(e.status);return{raw:V,href:e.href,status:(null==a?void 0:a.groups)?Number.parseInt(null==a?void 0:a.groups.status,10):O.status,statusText:null!==(r=null===(t=null==a?void 0:a.groups)||void 0===t?void 0:t.statusText)&&void 0!==r?r:O.statusText,ok:!e.error,error:e.error,responsedescription:e.responsedescription,props:(Array.isArray(e.propstat)?e.propstat:[e.propstat]).reduce(((e,t)=>({...e,...null==t?void 0:t.prop})),{})}}))},y=async e=>{const{url:t,props:r,depth:a,headers:s,headersToExclude:o,fetchOptions:n={}}=e;return O({url:t,init:{method:"PROPFIND",headers:f(h({depth:a,...s}),o),namespace:exports.DAVNamespaceShort.DAV,body:{propfind:{_attributes:p([exports.DAVNamespace.CALDAV,exports.DAVNamespace.CALDAV_APPLE,exports.DAVNamespace.CALENDAR_SERVER,exports.DAVNamespace.CARDDAV,exports.DAVNamespace.DAV]),prop:r}}},fetchOptions:n})},V=async e=>{const{url:r,data:a,headers:s,headersToExclude:o,fetchOptions:n={}}=e;return t.fetch(r,{method:"PUT",body:a,headers:f(s,o),...n})},x=async e=>{const{url:r,data:a,etag:s,headers:o,headersToExclude:n,fetchOptions:c={}}=e;return t.fetch(r,{method:"PUT",body:a,headers:f(h({"If-Match":s,...o}),n),...c})},g=async e=>{const{url:r,headers:a,etag:s,headersToExclude:o,fetchOptions:n={}}=e;return t.fetch(r,{method:"DELETE",headers:f(h({"If-Match":s,...a}),o),...n})};var C=Object.freeze({__proto__:null,createObject:V,davRequest:O,deleteObject:g,propfind:y,updateObject:x});function b(e,t){const r=e=>t.every((t=>e[t]));return Array.isArray(e)?e.every((e=>r(e))):r(e)}const w=(e,t)=>t.reduce(((t,r)=>e[r]?t:`${t.length?`${t},`:""}${r.toString()}`),""),S=r("tsdav:collection"),N=async e=>{const{url:t,body:r,depth:a,defaultNamespace:s=exports.DAVNamespaceShort.DAV,headers:o,headersToExclude:n,fetchOptions:c={}}=e,d=await O({url:t,init:{method:"REPORT",headers:f(h({depth:a,...o}),n),namespace:s,body:r},fetchOptions:c});return 1!==d.length||d[0].raw?d:[]},$=async e=>{const{url:t,props:r,depth:a,headers:s,headersToExclude:o,fetchOptions:n={}}=e;return O({url:t,init:{method:"MKCOL",headers:f(h({depth:a,...s}),o),namespace:exports.DAVNamespaceShort.DAV,body:r?{mkcol:{set:{prop:r}}}:void 0},fetchOptions:n})},T=async e=>{var t,r,a,s,o;const{collection:n,headers:c,headersToExclude:d,fetchOptions:l={}}=e;return null!==(o=null===(s=null===(a=null===(r=null===(t=(await y({url:n.url,props:{[`${exports.DAVNamespaceShort.DAV}:supported-report-set`]:{}},depth:"0",headers:f(c,d),fetchOptions:l}))[0])||void 0===t?void 0:t.props)||void 0===r?void 0:r.supportedReportSet)||void 0===a?void 0:a.supportedReport)||void 0===s?void 0:s.map((e=>Object.keys(e.report)[0])))&&void 0!==o?o:[]},E=async e=>{var t,r,a;const{collection:s,headers:o,headersToExclude:n,fetchOptions:c={}}=e,d=(await y({url:s.url,props:{[`${exports.DAVNamespaceShort.CALENDAR_SERVER}:getctag`]:{}},depth:"0",headers:f(o,n),fetchOptions:c})).filter((e=>i(s.url,e.href)))[0];if(!d)throw new Error("Collection does not exist on server");return{isDirty:`${s.ctag}`!=`${null===(t=d.props)||void 0===t?void 0:t.getctag}`,newCtag:null===(a=null===(r=d.props)||void 0===r?void 0:r.getctag)||void 0===a?void 0:a.toString()}},k=e=>{const{url:t,props:r,headers:a,syncLevel:s,syncToken:o,headersToExclude:n,fetchOptions:c}=e;return O({url:t,init:{method:"REPORT",namespace:exports.DAVNamespaceShort.DAV,headers:f({...a},n),body:{"sync-collection":{_attributes:p([exports.DAVNamespace.CALDAV,exports.DAVNamespace.CARDDAV,exports.DAVNamespace.DAV]),"sync-level":s,"sync-token":o,[`${exports.DAVNamespaceShort.DAV}:prop`]:r}}},fetchOptions:c})},_=async e=>{var t,r,a,s,o,n,c,d,l,p,h;const{collection:u,method:m,headers:A,headersToExclude:v,account:D,detailedResult:O,fetchOptions:y={}}=e,V=["accountType","homeUrl"];if(!D||!b(D,V)){if(!D)throw new Error("no account for smartCollectionSync");throw new Error(`account must have ${w(D,V)} before smartCollectionSync`)}const x=null!=m?m:(null===(t=u.reports)||void 0===t?void 0:t.includes("syncCollection"))?"webdav":"basic";if(S(`smart collection sync with type ${D.accountType} and method ${x}`),"webdav"===x){const e=await k({url:u.url,props:{[`${exports.DAVNamespaceShort.DAV}:getetag`]:{},[`${"caldav"===D.accountType?exports.DAVNamespaceShort.CALDAV:exports.DAVNamespaceShort.CARDDAV}:${"caldav"===D.accountType?"calendar-data":"address-data"}`]:{},[`${exports.DAVNamespaceShort.DAV}:displayname`]:{}},syncLevel:1,syncToken:u.syncToken,headers:f(A,v),fetchOptions:y}),t=e.filter((e=>{var t;const r="caldav"===D.accountType?".ics":".vcf";return(null===(t=e.href)||void 0===t?void 0:t.slice(-4))===r})),l=t.filter((e=>404!==e.status)).map((e=>e.href)),p=t.filter((e=>404===e.status)).map((e=>e.href)),h=(l.length&&null!==(a=await(null===(r=null==u?void 0:u.objectMultiGet)||void 0===r?void 0:r.call(u,{url:u.url,props:{[`${exports.DAVNamespaceShort.DAV}:getetag`]:{},[`${"caldav"===D.accountType?exports.DAVNamespaceShort.CALDAV:exports.DAVNamespaceShort.CARDDAV}:${"caldav"===D.accountType?"calendar-data":"address-data"}`]:{}},objectUrls:l,depth:"1",headers:f(A,v),fetchOptions:y})))&&void 0!==a?a:[]).map((e=>{var t,r,a,s,o,n,c,d,l,i;return{url:null!==(t=e.href)&&void 0!==t?t:"",etag:null===(r=e.props)||void 0===r?void 0:r.getetag,data:"caldav"===(null==D?void 0:D.accountType)?null!==(o=null===(s=null===(a=e.props)||void 0===a?void 0:a.calendarData)||void 0===s?void 0:s._cdata)&&void 0!==o?o:null===(n=e.props)||void 0===n?void 0:n.calendarData:null!==(l=null===(d=null===(c=e.props)||void 0===c?void 0:c.addressData)||void 0===d?void 0:d._cdata)&&void 0!==l?l:null===(i=e.props)||void 0===i?void 0:i.addressData}})),m=null!==(s=u.objects)&&void 0!==s?s:[],V=h.filter((e=>m.every((t=>!i(t.url,e.url))))),x=m.reduce(((e,t)=>{const r=h.find((e=>i(e.url,t.url)));return r&&r.etag&&r.etag!==t.etag?[...e,r]:e}),[]),g=p.map((e=>({url:e,etag:""}))),C=m.filter((e=>h.some((t=>i(e.url,t.url)&&t.etag===e.etag))));return{...u,objects:O?{created:V,updated:x,deleted:g}:[...C,...V,...x],syncToken:null!==(d=null===(c=null===(n=null===(o=e[0])||void 0===o?void 0:o.raw)||void 0===n?void 0:n.multistatus)||void 0===c?void 0:c.syncToken)&&void 0!==d?d:u.syncToken}}if("basic"===x){const{isDirty:e,newCtag:t}=await E({collection:u,headers:f(A,v),fetchOptions:y}),r=null!==(l=u.objects)&&void 0!==l?l:[],a=null!==(h=await(null===(p=u.fetchObjects)||void 0===p?void 0:p.call(u,{collection:u,headers:f(A,v),fetchOptions:y})))&&void 0!==h?h:[],s=a.filter((e=>r.every((t=>!i(t.url,e.url))))),o=r.reduce(((e,t)=>{const r=a.find((e=>i(e.url,t.url)));return r&&r.etag&&r.etag!==t.etag?[...e,r]:e}),[]),n=r.filter((e=>a.every((t=>!i(t.url,e.url))))),c=r.filter((e=>a.some((t=>i(e.url,t.url)&&t.etag===e.etag))));if(e)return{...u,objects:O?{created:s,updated:o,deleted:n}:[...c,...s,...o],ctag:t}}return O?{...u,objects:{created:[],updated:[],deleted:[]}}:u};var U=Object.freeze({__proto__:null,collectionQuery:N,isCollectionDirty:E,makeCollection:$,smartCollectionSync:_,supportedReportSet:T,syncCollection:k});const R=r("tsdav:addressBook"),L=async e=>{const{url:t,props:r,filters:a,depth:s,headers:o,headersToExclude:n,fetchOptions:c={}}=e;return N({url:t,body:{"addressbook-query":h({_attributes:p([exports.DAVNamespace.CARDDAV,exports.DAVNamespace.DAV]),[`${exports.DAVNamespaceShort.DAV}:prop`]:r,filter:null!=a?a:{"prop-filter":{_attributes:{name:"FN"}}}})},defaultNamespace:exports.DAVNamespaceShort.CARDDAV,depth:s,headers:f(o,n),fetchOptions:c})},j=async e=>{const{url:t,props:r,objectUrls:a,depth:s,headers:o,headersToExclude:n,fetchOptions:c={}}=e;return N({url:t,body:{"addressbook-multiget":h({_attributes:p([exports.DAVNamespace.DAV,exports.DAVNamespace.CARDDAV]),[`${exports.DAVNamespaceShort.DAV}:prop`]:r,[`${exports.DAVNamespaceShort.DAV}:href`]:a})},defaultNamespace:exports.DAVNamespaceShort.CARDDAV,depth:s,headers:f(o,n),fetchOptions:c})},H=async e=>{const{account:t,headers:r,props:a,headersToExclude:s,fetchOptions:o={}}=null!=e?e:{},n=["homeUrl","rootUrl"];if(!t||!b(t,n)){if(!t)throw new Error("no account for fetchAddressBooks");throw new Error(`account must have ${w(t,n)} before fetchAddressBooks`)}const c=await y({url:t.homeUrl,props:null!=a?a:{[`${exports.DAVNamespaceShort.DAV}:displayname`]:{},[`${exports.DAVNamespaceShort.CALENDAR_SERVER}:getctag`]:{},[`${exports.DAVNamespaceShort.DAV}:resourcetype`]:{},[`${exports.DAVNamespaceShort.DAV}:sync-token`]:{}},depth:"1",headers:f(r,s),fetchOptions:o});return Promise.all(c.filter((e=>{var t,r;return Object.keys(null!==(r=null===(t=e.props)||void 0===t?void 0:t.resourcetype)&&void 0!==r?r:{}).includes("addressbook")})).map((e=>{var r,a,s,o,n,c,d,l,i;const p=null!==(s=null===(a=null===(r=e.props)||void 0===r?void 0:r.displayname)||void 0===a?void 0:a._cdata)&&void 0!==s?s:null===(o=e.props)||void 0===o?void 0:o.displayname;return R(`Found address book named ${"string"==typeof p?p:""},\n             props: ${JSON.stringify(e.props)}`),{url:new URL(null!==(n=e.href)&&void 0!==n?n:"",null!==(c=t.rootUrl)&&void 0!==c?c:"").href,ctag:null===(d=e.props)||void 0===d?void 0:d.getctag,displayName:"string"==typeof p?p:"",resourcetype:Object.keys(null===(l=e.props)||void 0===l?void 0:l.resourcetype),syncToken:null===(i=e.props)||void 0===i?void 0:i.syncToken}})).map((async e=>({...e,reports:await T({collection:e,headers:f(r,s),fetchOptions:o})}))))},P=async e=>{const{addressBook:t,headers:r,objectUrls:a,headersToExclude:s,urlFilter:o=e=>e,useMultiGet:n=!0,fetchOptions:c={}}=e;R(`Fetching vcards from ${null==t?void 0:t.url}`);const d=["url"];if(!t||!b(t,d)){if(!t)throw new Error("cannot fetchVCards for undefined addressBook");throw new Error(`addressBook must have ${w(t,d)} before fetchVCards`)}const l=(null!=a?a:(await L({url:t.url,props:{[`${exports.DAVNamespaceShort.DAV}:getetag`]:{}},depth:"1",headers:f(r,s),fetchOptions:c})).map((e=>{var t;return e.ok&&null!==(t=e.href)&&void 0!==t?t:""}))).map((e=>e.startsWith("http")||!e?e:new URL(e,t.url).href)).filter(o).map((e=>new URL(e).pathname));let i=[];return l.length>0&&(i=n?await j({url:t.url,props:{[`${exports.DAVNamespaceShort.DAV}:getetag`]:{},[`${exports.DAVNamespaceShort.CARDDAV}:address-data`]:{}},objectUrls:l,depth:"1",headers:f(r,s),fetchOptions:c}):await L({url:t.url,props:{[`${exports.DAVNamespaceShort.DAV}:getetag`]:{},[`${exports.DAVNamespaceShort.CARDDAV}:address-data`]:{}},depth:"1",headers:f(r,s),fetchOptions:c})),i.map((e=>{var r,a,s,o,n,c;return{url:new URL(null!==(r=e.href)&&void 0!==r?r:"",t.url).href,etag:null===(a=e.props)||void 0===a?void 0:a.getetag,data:null!==(n=null===(o=null===(s=e.props)||void 0===s?void 0:s.addressData)||void 0===o?void 0:o._cdata)&&void 0!==n?n:null===(c=e.props)||void 0===c?void 0:c.addressData}}))},B=async e=>{const{addressBook:t,vCardString:r,filename:a,headers:s,headersToExclude:o,fetchOptions:n={}}=e;return V({url:new URL(a,t.url).href,data:r,headers:f({"content-type":"text/vcard; charset=utf-8","If-None-Match":"*",...s},o),fetchOptions:n})},I=async e=>{const{vCard:t,headers:r,headersToExclude:a,fetchOptions:s={}}=e;return x({url:t.url,data:t.data,etag:t.etag,headers:f({"content-type":"text/vcard; charset=utf-8",...r},a),fetchOptions:s})},M=async e=>{const{vCard:t,headers:r,headersToExclude:a,fetchOptions:s={}}=e;return g({url:t.url,etag:t.etag,headers:f(r,a),fetchOptions:s})};var F=Object.freeze({__proto__:null,addressBookMultiGet:j,addressBookQuery:L,createVCard:B,deleteVCard:M,fetchAddressBooks:H,fetchVCards:P,updateVCard:I});const z=r("tsdav:calendar"),Q=async e=>{var t,r,a;const{account:s,headers:o,headersToExclude:n,fetchOptions:c={}}=e,d=["principalUrl","rootUrl"];if(!b(s,d))throw new Error(`account must have ${w(s,d)} before fetchUserAddresses`);z(`Fetch user addresses from ${s.principalUrl}`);const l=(await y({url:s.principalUrl,props:{[`${exports.DAVNamespaceShort.CALDAV}:calendar-user-address-set`]:{}},depth:"0",headers:f(o,n),fetchOptions:c})).find((e=>i(s.principalUrl,e.href)));if(!l||!l.ok)throw new Error("cannot find calendarUserAddresses");const p=(null===(a=null===(r=null===(t=null==l?void 0:l.props)||void 0===t?void 0:t.calendarUserAddressSet)||void 0===r?void 0:r.href)||void 0===a?void 0:a.filter(Boolean))||[];return z(`Fetched calendar user addresses ${p}`),p},Z=async e=>{const{url:t,props:r,filters:a,timezone:s,depth:o,headers:n,headersToExclude:c,fetchOptions:d={}}=e;return N({url:t,body:{"calendar-query":h({_attributes:p([exports.DAVNamespace.CALDAV,exports.DAVNamespace.CALENDAR_SERVER,exports.DAVNamespace.CALDAV_APPLE,exports.DAVNamespace.DAV]),[`${exports.DAVNamespaceShort.DAV}:prop`]:r,filter:a,timezone:s})},defaultNamespace:exports.DAVNamespaceShort.CALDAV,depth:o,headers:f(n,c),fetchOptions:d})},G=async e=>{const{url:t,props:r,objectUrls:a,filters:s,timezone:o,depth:n,headers:c,headersToExclude:d,fetchOptions:l={}}=e;return N({url:t,body:{"calendar-multiget":h({_attributes:p([exports.DAVNamespace.DAV,exports.DAVNamespace.CALDAV]),[`${exports.DAVNamespaceShort.DAV}:prop`]:r,[`${exports.DAVNamespaceShort.DAV}:href`]:a,filter:s,timezone:o})},defaultNamespace:exports.DAVNamespaceShort.CALDAV,depth:n,headers:f(c,d),fetchOptions:l})},q=async e=>{const{url:t,props:r,depth:a,headers:s,headersToExclude:o,fetchOptions:n={}}=e;return O({url:t,init:{method:"MKCALENDAR",headers:f(h({depth:a,...s}),o),namespace:exports.DAVNamespaceShort.DAV,body:{[`${exports.DAVNamespaceShort.CALDAV}:mkcalendar`]:{_attributes:p([exports.DAVNamespace.DAV,exports.DAVNamespace.CALDAV,exports.DAVNamespace.CALDAV_APPLE]),set:{prop:r}}}},fetchOptions:n})},J=async e=>{const{headers:t,account:r,props:a,projectedProps:s,headersToExclude:o,fetchOptions:n={}}=null!=e?e:{},d=["homeUrl","rootUrl"];if(!r||!b(r,d)){if(!r)throw new Error("no account for fetchCalendars");throw new Error(`account must have ${w(r,d)} before fetchCalendars`)}const l=await y({url:r.homeUrl,props:null!=a?a:{[`${exports.DAVNamespaceShort.CALDAV}:calendar-description`]:{},[`${exports.DAVNamespaceShort.CALDAV}:calendar-timezone`]:{},[`${exports.DAVNamespaceShort.DAV}:displayname`]:{},[`${exports.DAVNamespaceShort.CALDAV_APPLE}:calendar-color`]:{},[`${exports.DAVNamespaceShort.CALENDAR_SERVER}:getctag`]:{},[`${exports.DAVNamespaceShort.DAV}:resourcetype`]:{},[`${exports.DAVNamespaceShort.CALDAV}:supported-calendar-component-set`]:{},[`${exports.DAVNamespaceShort.DAV}:sync-token`]:{}},depth:"1",headers:f(t,o),fetchOptions:n});return Promise.all(l.filter((e=>{var t,r;return Object.keys(null!==(r=null===(t=e.props)||void 0===t?void 0:t.resourcetype)&&void 0!==r?r:{}).includes("calendar")})).filter((e=>{var t,r,a,s,o,n;return(Array.isArray(null===(r=null===(t=e.props)||void 0===t?void 0:t.supportedCalendarComponentSet)||void 0===r?void 0:r.comp)?null===(a=e.props)||void 0===a?void 0:a.supportedCalendarComponentSet.comp.map((e=>e._attributes.name)):[null===(n=null===(o=null===(s=e.props)||void 0===s?void 0:s.supportedCalendarComponentSet)||void 0===o?void 0:o.comp)||void 0===n?void 0:n._attributes.name]).some((e=>Object.values(c).includes(e)))})).map((e=>{var t,a,o,n,c,d,l,i,p,h,f,m,A,v,D,O;const y=null===(t=e.props)||void 0===t?void 0:t.calendarDescription,V=null===(a=e.props)||void 0===a?void 0:a.calendarTimezone;return{description:"string"==typeof y?y:"",timezone:"string"==typeof V?V:"",url:new URL(null!==(o=e.href)&&void 0!==o?o:"",null!==(n=r.rootUrl)&&void 0!==n?n:"").href,ctag:null===(c=e.props)||void 0===c?void 0:c.getctag,calendarColor:null===(d=e.props)||void 0===d?void 0:d.calendarColor,displayName:null!==(i=null===(l=e.props)||void 0===l?void 0:l.displayname._cdata)&&void 0!==i?i:null===(p=e.props)||void 0===p?void 0:p.displayname,components:Array.isArray(null===(h=e.props)||void 0===h?void 0:h.supportedCalendarComponentSet.comp)?null===(f=e.props)||void 0===f?void 0:f.supportedCalendarComponentSet.comp.map((e=>e._attributes.name)):[null===(A=null===(m=e.props)||void 0===m?void 0:m.supportedCalendarComponentSet.comp)||void 0===A?void 0:A._attributes.name],resourcetype:Object.keys(null===(v=e.props)||void 0===v?void 0:v.resourcetype),syncToken:null===(D=e.props)||void 0===D?void 0:D.syncToken,...u("projectedProps",Object.fromEntries(Object.entries(null!==(O=e.props)&&void 0!==O?O:{}).filter((([e])=>null==s?void 0:s[e]))))}})).map((async e=>({...e,reports:await T({collection:e,headers:f(t,o),fetchOptions:n})}))))},W=async e=>{const{calendar:t,objectUrls:r,filters:a,timeRange:s,headers:o,expand:n,urlFilter:c=m,useMultiGet:d=!0,headersToExclude:l,fetchOptions:i={}}=e;s&&A(s.start,s.end),z(`Fetching calendar objects from ${null==t?void 0:t.url}`);const p=["url"];if(!t||!b(t,p)){if(!t)throw new Error("cannot fetchCalendarObjects for undefined calendar");throw new Error(`calendar must have ${w(t,p)} before fetchCalendarObjects`)}const h=null!=a?a:[{"comp-filter":{_attributes:{name:"VCALENDAR"},"comp-filter":{_attributes:{name:"VEVENT"},...s?{"time-range":{_attributes:{start:`${new Date(s.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(s.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}}:{}}}}],u=(null!=r?r:(await Z({url:t.url,props:{[`${exports.DAVNamespaceShort.DAV}:getetag`]:{...n&&s?{[`${exports.DAVNamespaceShort.CALDAV}:expand`]:{_attributes:{start:`${new Date(s.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(s.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}}:{}}},filters:h,depth:"1",headers:f(o,l),fetchOptions:i})).map((e=>{var t;return null!==(t=e.href)&&void 0!==t?t:""}))).map((e=>e.startsWith("http")||!e?e:new URL(e,t.url).href)).filter(c).map((e=>new URL(e).pathname));let v=[];return u.length>0&&(v=!d||n?await Z({url:t.url,props:{[`${exports.DAVNamespaceShort.DAV}:getetag`]:{},[`${exports.DAVNamespaceShort.CALDAV}:calendar-data`]:{...n&&s?{[`${exports.DAVNamespaceShort.CALDAV}:expand`]:{_attributes:{start:`${new Date(s.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(s.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}}:{}}},filters:h,depth:"1",headers:f(o,l),fetchOptions:i}):await G({url:t.url,props:{[`${exports.DAVNamespaceShort.DAV}:getetag`]:{},[`${exports.DAVNamespaceShort.CALDAV}:calendar-data`]:{...n&&s?{[`${exports.DAVNamespaceShort.CALDAV}:expand`]:{_attributes:{start:`${new Date(s.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(s.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}}:{}}},objectUrls:u,depth:"1",headers:f(o,l),fetchOptions:i})),v.map((e=>{var r,a,s,o,n,c;return{url:new URL(null!==(r=e.href)&&void 0!==r?r:"",t.url).href,etag:`${null===(a=e.props)||void 0===a?void 0:a.getetag}`,data:null!==(n=null===(o=null===(s=e.props)||void 0===s?void 0:s.calendarData)||void 0===o?void 0:o._cdata)&&void 0!==n?n:null===(c=e.props)||void 0===c?void 0:c.calendarData}}))},K=async e=>{const{calendar:t,iCalString:r,filename:a,headers:s,headersToExclude:o,fetchOptions:n={}}=e;return V({url:new URL(a,t.url).href,data:r,headers:f({"content-type":"text/calendar; charset=utf-8","If-None-Match":"*",...s},o),fetchOptions:n})},Y=async e=>{const{calendarObject:t,headers:r,headersToExclude:a,fetchOptions:s={}}=e;return x({url:t.url,data:t.data,etag:t.etag,headers:f({"content-type":"text/calendar; charset=utf-8",...r},a),fetchOptions:s})},X=async e=>{const{calendarObject:t,headers:r,headersToExclude:a,fetchOptions:s={}}=e;return g({url:t.url,etag:t.etag,headers:f(r,a),fetchOptions:s})},ee=async e=>{var t;const{oldCalendars:r,account:a,detailedResult:s,headers:o,headersToExclude:n,fetchOptions:c={}}=e;if(!a)throw new Error("Must have account before syncCalendars");const d=null!==(t=null!=r?r:a.calendars)&&void 0!==t?t:[],l=await J({account:a,headers:f(o,n),fetchOptions:c}),p=l.filter((e=>d.every((t=>!i(t.url,e.url)))));z(`new calendars: ${p.map((e=>e.displayName))}`);const h=d.reduce(((e,t)=>{const r=l.find((e=>i(e.url,t.url)));return r&&(r.syncToken&&`${r.syncToken}`!=`${t.syncToken}`||r.ctag&&`${r.ctag}`!=`${t.ctag}`)?[...e,r]:e}),[]);z(`updated calendars: ${h.map((e=>e.displayName))}`);const u=await Promise.all(h.map((async e=>await _({collection:{...e,objectMultiGet:G},method:"webdav",headers:f(o,n),account:a,fetchOptions:c})))),m=d.filter((e=>l.every((t=>!i(t.url,e.url)))));z(`deleted calendars: ${m.map((e=>e.displayName))}`);const A=d.filter((e=>l.some((t=>i(t.url,e.url)&&(t.syncToken&&`${t.syncToken}`!=`${e.syncToken}`||t.ctag&&`${t.ctag}`!=`${e.ctag}`)))));return s?{created:p,updated:h,deleted:m}:[...A,...p,...u]},te=async e=>{const{url:t,timeRange:r,depth:a,headers:s,headersToExclude:o,fetchOptions:n={}}=e;if(!r)throw new Error("timeRange is required");A(r.start,r.end);return(await N({url:t,body:{"free-busy-query":h({_attributes:p([exports.DAVNamespace.CALDAV]),[`${exports.DAVNamespaceShort.CALDAV}:time-range`]:{_attributes:{start:`${new Date(r.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(r.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}})},defaultNamespace:exports.DAVNamespaceShort.CALDAV,depth:a,headers:f(s,o),fetchOptions:n}))[0]};var re=Object.freeze({__proto__:null,calendarMultiGet:G,calendarQuery:Z,createCalendarObject:K,deleteCalendarObject:X,fetchCalendarObjects:W,fetchCalendarUserAddresses:Q,fetchCalendars:J,freeBusyQuery:te,makeCalendar:q,syncCalendars:ee,updateCalendarObject:Y});const ae=r("tsdav:account"),se=async e=>{var r,a;ae("Service discovery...");const{account:s,headers:o,headersToExclude:n,fetchOptions:c={}}=e,d=new URL(s.serverUrl),l=new URL(`/.well-known/${s.accountType}`,d);l.protocol=null!==(r=d.protocol)&&void 0!==r?r:"http";try{const e=await t.fetch(l.href,{headers:f(o,n),method:"PROPFIND",redirect:"manual",...c});if(e.status>=300&&e.status<400){const t=e.headers.get("Location");if("string"==typeof t&&t.length){ae(`Service discovery redirected to ${t}`);const e=new URL(t,d);return e.hostname===l.hostname&&l.port&&!e.port&&(e.port=l.port),e.protocol=null!==(a=d.protocol)&&void 0!==a?a:"http",e.href}}}catch(e){ae(`Service discovery failed: ${e.stack}`)}return d.href},oe=async e=>{var t,r,a,s,o;const{account:n,headers:c,headersToExclude:d,fetchOptions:l={}}=e,i=["rootUrl"];if(!b(n,i))throw new Error(`account must have ${w(n,i)} before fetchPrincipalUrl`);ae(`Fetching principal url from path ${n.rootUrl}`);const[p]=await y({url:n.rootUrl,props:{[`${exports.DAVNamespaceShort.DAV}:current-user-principal`]:{}},depth:"0",headers:f(c,d),fetchOptions:l});if(!p.ok&&(ae(`Fetch principal url failed: ${p.statusText}`),401===p.status))throw new Error("Invalid credentials");return ae(`Fetched principal url ${null===(r=null===(t=p.props)||void 0===t?void 0:t.currentUserPrincipal)||void 0===r?void 0:r.href}`),new URL(null!==(o=null===(s=null===(a=p.props)||void 0===a?void 0:a.currentUserPrincipal)||void 0===s?void 0:s.href)&&void 0!==o?o:"",n.rootUrl).href},ne=async e=>{var t,r;const{account:a,headers:s,headersToExclude:o,fetchOptions:n={}}=e,c=["principalUrl","rootUrl"];if(!b(a,c))throw new Error(`account must have ${w(a,c)} before fetchHomeUrl`);ae(`Fetch home url from ${a.principalUrl}`);const d=await y({url:a.principalUrl,props:"caldav"===a.accountType?{[`${exports.DAVNamespaceShort.CALDAV}:calendar-home-set`]:{}}:{[`${exports.DAVNamespaceShort.CARDDAV}:addressbook-home-set`]:{}},depth:"0",headers:f(s,o),fetchOptions:n}),l=d.find((e=>i(a.principalUrl,e.href)));if(!l||!l.ok)throw ae(`Fetch home url failed with status ${null==l?void 0:l.statusText} and error ${JSON.stringify(d.map((e=>e.error)))}`),new Error("cannot find homeUrl");const p=new URL("caldav"===a.accountType?null===(t=null==l?void 0:l.props)||void 0===t?void 0:t.calendarHomeSet.href:null===(r=null==l?void 0:l.props)||void 0===r?void 0:r.addressbookHomeSet.href,a.rootUrl).href;return ae(`Fetched home url ${p}`),p},ce=async e=>{const{account:t,headers:r,loadCollections:a=!1,loadObjects:s=!1,headersToExclude:o,fetchOptions:n={}}=e,c={...t};return c.rootUrl=await se({account:t,headers:f(r,o),fetchOptions:n}),c.principalUrl=await oe({account:c,headers:f(r,o),fetchOptions:n}),c.homeUrl=await ne({account:c,headers:f(r,o),fetchOptions:n}),(a||s)&&("caldav"===t.accountType?c.calendars=await J({headers:f(r,o),account:c,fetchOptions:n}):"carddav"===t.accountType&&(c.addressBooks=await H({headers:f(r,o),account:c,fetchOptions:n}))),s&&("caldav"===t.accountType&&c.calendars?c.calendars=await Promise.all(c.calendars.map((async e=>({...e,objects:await W({calendar:e,headers:f(r,o),fetchOptions:n})})))):"carddav"===t.accountType&&c.addressBooks&&(c.addressBooks=await Promise.all(c.addressBooks.map((async e=>({...e,objects:await P({addressBook:e,headers:f(r,o),fetchOptions:n})})))))),c};var de=Object.freeze({__proto__:null,createAccount:ce,fetchHomeUrl:ne,fetchPrincipalUrl:oe,serviceDiscovery:se});const le=r("tsdav:todo"),ie=e=>({[`${exports.DAVNamespaceShort.CALDAV}:expand`]:{_attributes:{start:`${new Date(e.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(e.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}}),pe=async e=>{const{url:t,props:r,filters:a,timezone:s,depth:o,headers:n,headersToExclude:c,fetchOptions:d={}}=e;return N({url:t,body:{"calendar-query":h({_attributes:p([exports.DAVNamespace.CALDAV,exports.DAVNamespace.CALENDAR_SERVER,exports.DAVNamespace.CALDAV_APPLE,exports.DAVNamespace.DAV]),[`${exports.DAVNamespaceShort.DAV}:prop`]:r,filter:a,timezone:s})},defaultNamespace:exports.DAVNamespaceShort.CALDAV,depth:o,headers:f(n,c),fetchOptions:d})},he=async e=>{const{url:t,props:r,objectUrls:a,filters:s,timezone:o,depth:n,headers:c,headersToExclude:d,fetchOptions:l={}}=e;return N({url:t,body:{"calendar-multiget":h({_attributes:p([exports.DAVNamespace.DAV,exports.DAVNamespace.CALDAV]),[`${exports.DAVNamespaceShort.DAV}:prop`]:r,[`${exports.DAVNamespaceShort.DAV}:href`]:a,filter:s,timezone:o})},defaultNamespace:exports.DAVNamespaceShort.CALDAV,depth:n,headers:f(c,d),fetchOptions:l})},ue=async e=>{const{calendar:t,objectUrls:r,filters:a,timeRange:s,headers:o,expand:n,urlFilter:c=m,useMultiGet:d=!0,headersToExclude:l,fetchOptions:i={}}=e;s&&A(s.start,s.end),le(`Fetching todo objects from ${null==t?void 0:t.url}`);const p=["url"];if(!t||!b(t,p)){if(!t)throw new Error("cannot fetchTodos for undefined calendar");throw new Error(`calendar must have ${w(t,p)} before fetchTodos`)}const h=null!=a?a:[{"comp-filter":{_attributes:{name:"VCALENDAR"},"comp-filter":{_attributes:{name:"VTODO"},...s?{"time-range":{_attributes:{start:`${new Date(s.start).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`,end:`${new Date(s.end).toISOString().slice(0,19).replace(/[-:.]/g,"")}Z`}}}:{}}}}],u=(null!=r?r:(await pe({url:t.url,props:{[`${exports.DAVNamespaceShort.DAV}:getetag`]:{...n&&s?ie(s):{}}},filters:h,depth:"1",headers:f(o,l),fetchOptions:i})).map((e=>{var t;return null!==(t=e.href)&&void 0!==t?t:""}))).map((e=>e.startsWith("http")||!e?e:new URL(e,t.url).href)).filter(c).map((e=>new URL(e).pathname));let v=[];return u.length>0&&(v=!d||n?await pe({url:t.url,props:{[`${exports.DAVNamespaceShort.DAV}:getetag`]:{},[`${exports.DAVNamespaceShort.CALDAV}:calendar-data`]:{...n&&s?ie(s):{}}},filters:h,depth:"1",headers:f(o,l),fetchOptions:i}):await he({url:t.url,props:{[`${exports.DAVNamespaceShort.DAV}:getetag`]:{},[`${exports.DAVNamespaceShort.CALDAV}:calendar-data`]:{...n&&s?ie(s):{}}},objectUrls:u,depth:"1",headers:f(o,l),fetchOptions:i})),v.map((e=>{var r,a,s,o,n,c;return{url:new URL(null!==(r=e.href)&&void 0!==r?r:"",t.url).href,etag:`${null===(a=e.props)||void 0===a?void 0:a.getetag}`,data:null!==(n=null===(o=null===(s=e.props)||void 0===s?void 0:s.calendarData)||void 0===o?void 0:o._cdata)&&void 0!==n?n:null===(c=e.props)||void 0===c?void 0:c.calendarData}}))},fe=async e=>{const{calendar:t,iCalString:r,filename:a,headers:s,headersToExclude:o,fetchOptions:n={}}=e;if(!r.includes("UID:"))throw new Error("iCalString must contain a UID");return V({url:new URL(a,t.url).href,data:r,headers:f({"content-type":"text/calendar; charset=utf-8","If-None-Match":"*",...s},o),fetchOptions:n})},me=async e=>{const{calendarObject:t,headers:r,headersToExclude:a,fetchOptions:s={}}=e;if(!t.etag)throw new Error("calendarObject must have etag for update - fetch todo first");return x({url:t.url,data:t.data,etag:t.etag,headers:f({"content-type":"text/calendar; charset=utf-8",...r},a),fetchOptions:s})},Ae=async e=>{const{calendarObject:t,headers:r,headersToExclude:a,fetchOptions:s={}}=e;return g({url:t.url,etag:t.etag,headers:f(r,a),fetchOptions:s})};var ve=Object.freeze({__proto__:null,createTodo:fe,deleteTodo:Ae,fetchTodos:ue,todoMultiGet:he,todoQuery:pe,updateTodo:me});const De=r("tsdav:authHelper"),Oe=(e,t)=>(...r)=>e({...t,...r[0]}),ye=e=>(De(`Basic auth token generated: ${s.encode(`${e.username}:${e.password}`)}`),{authorization:`Basic ${s.encode(`${e.username}:${e.password}`)}`}),Ve=async(e,r)=>{const a=["authorizationCode","redirectUrl","clientId","clientSecret","tokenUrl"];if(!b(e,a))throw new Error(`Oauth credentials missing: ${w(e,a)}`);const s=new URLSearchParams({grant_type:"authorization_code",code:e.authorizationCode,redirect_uri:e.redirectUrl,client_id:e.clientId,client_secret:e.clientSecret});De(e.tokenUrl),De(s.toString());const o=await t.fetch(e.tokenUrl,{method:"POST",body:s.toString(),headers:{"content-length":`${s.toString().length}`,"content-type":"application/x-www-form-urlencoded"},...null!=r?r:{}});if(o.ok){return await o.json()}return De(`Fetch Oauth tokens failed: ${await o.text()}`),{}},xe=async(e,r)=>{const a=["refreshToken","clientId","clientSecret","tokenUrl"];if(!b(e,a))throw new Error(`Oauth credentials missing: ${w(e,a)}`);const s=new URLSearchParams({client_id:e.clientId,client_secret:e.clientSecret,refresh_token:e.refreshToken,grant_type:"refresh_token"}),o=await t.fetch(e.tokenUrl,{method:"POST",body:s.toString(),headers:{"Content-Type":"application/x-www-form-urlencoded"},...null!=r?r:{}});if(o.ok){return await o.json()}return De(`Refresh access token failed: ${await o.text()}`),{}},ge=async(e,t)=>{var r;De("Fetching oauth headers");let a={};return e.refreshToken?(e.refreshToken&&!e.accessToken||Date.now()>(null!==(r=e.expiration)&&void 0!==r?r:0))&&(a=await xe(e,t)):a=await Ve(e,t),De(`Oauth tokens fetched: ${a.access_token}`),{tokens:a,headers:{authorization:`Bearer ${a.access_token}`}}};var Ce=Object.freeze({__proto__:null,defaultParam:Oe,fetchOauthTokens:Ve,getBasicAuthHeaders:ye,getOauthHeaders:ge,refreshAccessToken:xe});const be=async e=>{var t;const{serverUrl:r,credentials:a,authMethod:s,defaultAccountType:o,authFunction:n}=e;let c={};switch(s){case"Basic":c=ye(a);break;case"Oauth":c=(await ge(a)).headers;break;case"Digest":c={Authorization:`Digest ${a.digestString}`};break;case"Custom":c=null!==(t=await(null==n?void 0:n(a)))&&void 0!==t?t:{};break;default:throw new Error("Invalid auth method")}const d=o?await ce({account:{serverUrl:r,credentials:a,accountType:o},headers:c}):void 0,l=Oe(V,{url:r,headers:c}),i=Oe(x,{headers:c,url:r}),p=Oe(g,{headers:c,url:r}),h=Oe(y,{headers:c}),u=Oe(N,{headers:c}),f=Oe($,{headers:c}),m=Oe(k,{headers:c}),A=Oe(T,{headers:c}),v=Oe(E,{headers:c}),D=Oe(_,{headers:c,account:d}),C=Oe(Z,{headers:c}),b=Oe(G,{headers:c}),w=Oe(q,{headers:c}),S=Oe(J,{headers:c,account:d}),U=Oe(Q,{headers:c,account:d}),R=Oe(W,{headers:c}),F=Oe(K,{headers:c}),z=Oe(Y,{headers:c}),te=Oe(X,{headers:c}),re=Oe(ee,{account:d,headers:c}),ae=Oe(L,{headers:c}),se=Oe(j,{headers:c});return{davRequest:async e=>{const{init:t,...r}=e,{headers:a,...s}=t;return O({...r,init:{...s,headers:{...c,...a}}})},propfind:h,createAccount:async e=>{const{account:t,headers:s,loadCollections:o,loadObjects:n}=e;return ce({account:{serverUrl:r,credentials:a,...t},headers:{...c,...s},loadCollections:o,loadObjects:n})},createObject:l,updateObject:i,deleteObject:p,calendarQuery:C,addressBookQuery:ae,collectionQuery:u,makeCollection:f,calendarMultiGet:b,makeCalendar:w,syncCollection:m,supportedReportSet:A,isCollectionDirty:v,smartCollectionSync:D,fetchCalendars:S,fetchCalendarUserAddresses:U,fetchCalendarObjects:R,createCalendarObject:F,updateCalendarObject:z,deleteCalendarObject:te,syncCalendars:re,fetchAddressBooks:Oe(H,{account:d,headers:c}),addressBookMultiGet:se,fetchVCards:Oe(P,{headers:c}),createVCard:Oe(B,{headers:c}),updateVCard:Oe(I,{headers:c}),deleteVCard:Oe(M,{headers:c}),todoQuery:Oe(pe,{headers:c}),todoMultiGet:Oe(he,{headers:c}),fetchTodos:Oe(ue,{headers:c}),createTodo:Oe(fe,{headers:c}),updateTodo:Oe(me,{headers:c}),deleteTodo:Oe(Ae,{headers:c})}};class we{constructor(e){var t,r,a;this.serverUrl=e.serverUrl,this.credentials=e.credentials,this.authMethod=null!==(t=e.authMethod)&&void 0!==t?t:"Basic",this.accountType=null!==(r=e.defaultAccountType)&&void 0!==r?r:"caldav",this.authFunction=e.authFunction,this.fetchOptions=null!==(a=e.fetchOptions)&&void 0!==a?a:{}}async login(){var e;switch(this.authMethod){case"Basic":this.authHeaders=ye(this.credentials);break;case"Oauth":this.authHeaders=(await ge(this.credentials,this.fetchOptions)).headers;break;case"Digest":this.authHeaders={Authorization:`Digest ${this.credentials.digestString}`};break;case"Custom":this.authHeaders=await(null===(e=this.authFunction)||void 0===e?void 0:e.call(this,this.credentials));break;default:throw new Error("Invalid auth method")}this.account=this.accountType?await ce({account:{serverUrl:this.serverUrl,credentials:this.credentials,accountType:this.accountType},headers:this.authHeaders,fetchOptions:this.fetchOptions}):void 0}async davRequest(e){const{init:t,...r}=e,{headers:a,...s}=t;return O({...r,init:{...s,headers:{...this.authHeaders,...a}},fetchOptions:this.fetchOptions})}async createObject(...e){return Oe(V,{url:this.serverUrl,headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async updateObject(...e){return Oe(x,{url:this.serverUrl,headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async deleteObject(...e){return Oe(g,{url:this.serverUrl,headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async propfind(...e){return Oe(y,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async createAccount(e){const{account:t,headers:r,loadCollections:a,loadObjects:s,fetchOptions:o}=e;return ce({account:{serverUrl:this.serverUrl,credentials:this.credentials,...t},headers:{...this.authHeaders,...r},loadCollections:a,loadObjects:s,fetchOptions:null!=o?o:this.fetchOptions})}async collectionQuery(...e){return Oe(N,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async makeCollection(...e){return Oe($,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async syncCollection(...e){return Oe(k,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async supportedReportSet(...e){return Oe(T,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async isCollectionDirty(...e){return Oe(E,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async smartCollectionSync(...e){return Oe(_,{headers:this.authHeaders,fetchOptions:this.fetchOptions,account:this.account})(e[0])}async calendarQuery(...e){return Oe(Z,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async makeCalendar(...e){return Oe(q,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async calendarMultiGet(...e){return Oe(G,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async fetchCalendars(...e){return Oe(J,{headers:this.authHeaders,account:this.account,fetchOptions:this.fetchOptions})(null==e?void 0:e[0])}async fetchCalendarUserAddresses(...e){return Oe(Q,{headers:this.authHeaders,account:this.account,fetchOptions:this.fetchOptions})(null==e?void 0:e[0])}async fetchCalendarObjects(...e){return Oe(W,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async createCalendarObject(...e){return Oe(K,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async updateCalendarObject(...e){return Oe(Y,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async deleteCalendarObject(...e){return Oe(X,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async syncCalendars(...e){return Oe(ee,{headers:this.authHeaders,account:this.account,fetchOptions:this.fetchOptions})(e[0])}async addressBookQuery(...e){return Oe(L,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async addressBookMultiGet(...e){return Oe(j,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async fetchAddressBooks(...e){return Oe(H,{headers:this.authHeaders,account:this.account,fetchOptions:this.fetchOptions})(null==e?void 0:e[0])}async fetchVCards(...e){return Oe(P,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async createVCard(...e){return Oe(B,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async updateVCard(...e){return Oe(I,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async deleteVCard(...e){return Oe(M,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async todoQuery(...e){return Oe(pe,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async todoMultiGet(...e){return Oe(he,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async fetchTodos(...e){return Oe(ue,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async createTodo(...e){return Oe(fe,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async updateTodo(...e){return Oe(me,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}async deleteTodo(...e){return Oe(Ae,{headers:this.authHeaders,fetchOptions:this.fetchOptions})(e[0])}}var Se=Object.freeze({__proto__:null,DAVClient:we,createDAVClient:be}),Ne={DAVNamespace:exports.DAVNamespace,DAVNamespaceShort:exports.DAVNamespaceShort,DAVAttributeMap:o,...Se,...C,...U,...de,...F,...re,...ve,...Ce,...v};exports.DAVAttributeMap=o,exports.DAVClient=we,exports.addressBookMultiGet=j,exports.addressBookQuery=L,exports.calendarMultiGet=G,exports.calendarQuery=Z,exports.cleanupFalsy=h,exports.collectionQuery=N,exports.createAccount=ce,exports.createCalendarObject=K,exports.createDAVClient=be,exports.createObject=V,exports.createTodo=fe,exports.createVCard=B,exports.davRequest=O,exports.default=Ne,exports.deleteCalendarObject=X,exports.deleteObject=g,exports.deleteTodo=Ae,exports.deleteVCard=M,exports.fetchAddressBooks=H,exports.fetchCalendarObjects=W,exports.fetchCalendarUserAddresses=Q,exports.fetchCalendars=J,exports.fetchOauthTokens=Ve,exports.fetchTodos=ue,exports.fetchVCards=P,exports.freeBusyQuery=te,exports.getBasicAuthHeaders=ye,exports.getDAVAttribute=p,exports.getOauthHeaders=ge,exports.isCollectionDirty=E,exports.makeCalendar=q,exports.propfind=y,exports.refreshAccessToken=xe,exports.smartCollectionSync=_,exports.supportedReportSet=T,exports.syncCalendars=ee,exports.syncCollection=k,exports.todoMultiGet=he,exports.todoQuery=pe,exports.updateCalendarObject=Y,exports.updateObject=x,exports.updateTodo=me,exports.updateVCard=I,exports.urlContains=i,exports.urlEquals=l;
